import{j as ae,k as le,n as l,q as ie,E as ce,r as f,o as n,c as a,w as c,T as q,s as G,g as u,a as s,t as i,b as k,z as O,u as r,x as J,G as K,e as g,f as F,h as Q,F as b,H as re,C as de,D as ue}from"./index.4e4dba9e.js";import{T as W,d as X}from"./dayjs.min.619852d9.js";import{_ as d}from"./SvgIcon.b6c5ed79.js";import{_ as ve}from"./plugin-vueexport-helper.2444895f.js";const pe=C=>(de("data-v-1d691416"),C=C(),ue(),C),fe={class:"text"},ge={class:"item-left"},he={class:"left-content"},ye={class:"bottom-text"},_e={class:"item-right"},ke={key:0,class:"bottom-text"},me=["onClick"],xe={key:1,class:"bottom-text"},Ce=["onClick"],we={class:"text"},$e={class:"item-left"},be={class:"left-content"},Le={class:"bottom-text"},Ie={class:"item-right"},Ae={class:"status-icon"},He={class:"content"},Te={class:"bottom-text"},Ue=pe(()=>s("span",null,"/",-1)),Se={__name:"History",setup(C){const L=ae(),m=le(),h=l(0),w=l(20),y=l([]),I=l(1),A=l(!1),Y=l(!1),x=l([]),H=l(1),T=l(!1),M=l(!1),v=l(!1),p=l(!1),U=l(!1),S=l([{name:"\u7EE7\u7EED\u8F6C\u53D1",value:"0",color:"#3F80F7"},{name:"\u67E5\u770B\u624B\u6C14",value:"1"}]),_=ie({creatorAddress:"",showLuckUrl:"",redPacketUrl:""});ce(()=>m.walletAddress,async(t,o)=>{console.log("newVal:"+t),D()});function Z(t){U.value=!0,t.refundTx==""&&t.unlockTx==""?S.value=[{name:"\u7EE7\u7EED\u8F6C\u53D1",value:"0",color:"#3F80F7"},{name:"\u67E5\u770B\u624B\u6C14",value:"1"}]:S.value=[{name:"\u67E5\u770B\u624B\u6C14",value:"1"}],_.creatorAddress=F(t.creatorAddress)+"\u53D1\u51FA\u7684\u7EA2\u5305",_.showLuckUrl="/redpacket/"+t.uuid+"/showLuck",_.redPacketUrl="/redpacket/"+t.uuid}function ee(t){t.value==0?L.push(_.redPacketUrl):t.value==1&&L.push(_.showLuckUrl)}function te(t){window.open("https://testnet.bscscan.com/tx/"+t,"_blank")}function oe(){D()}function P(){h.value==0?(I.value=1,y.value=[],R()):h.value==1&&(H.value=1,x.value=[],V())}function D(){console.log(111),h.value==0?R():h.value==1&&V()}async function R(){v.value=!0;let t=q.loading({message:"Loading...",forbidClick:!0,duration:0});try{const o=await G.redPacket.getReceiveHistory(m.walletAddress,w.value,I.value);console.log(o),o.status==1?(console.log(y),y.value=y.value.concat(o.data.list),o.data.list.length<w.value?Y.value=!0:I.value++):(console.log("fail"),p.value=!0)}catch(o){console.log(o),p.value=!0}finally{t.clear(),A.value=!1,v.value=!1}}async function V(){v.value=!0;let t=q.loading({message:"Loading...",forbidClick:!0,duration:0});try{const o=await G.redPacket.getSendHistory(m.walletAddress,w.value,H.value);console.log(o),o.status==1?(x.value=x.value.concat(o.data.list),o.data.list.length<w.value?M.value=!0:H.value++):(console.log("fail"),p.value=!0)}catch(o){console.log(o),p.value=!1}finally{t.clear(),T.value=!1,v.value=!1}}return(t,o)=>{const N=f("van-empty"),B=f("van-cell"),E=f("van-list"),j=f("van-pull-refresh"),z=f("van-tab"),ne=f("van-action-sheet"),se=f("van-tabs");return n(),a(se,{class:"history",active:h.value,"onUpdate:active":o[7]||(o[7]=e=>h.value=e),onRendered:oe},{default:c(()=>[u(z,{class:"tab-top",title:t.$t("ireceived")},{default:c(()=>[u(j,{modelValue:A.value,"onUpdate:modelValue":o[2]||(o[2]=e=>A.value=e),"pulling-text":t.$t("pulling"),"loosing-text":t.$t("loosing"),"loading-text":t.$t("loading"),onRefresh:P},{default:c(()=>[y.value.length==0?(n(),a(N,{key:0,class:"empty-box"},{image:c(()=>[u(d,{class:"icon",name:"emptyHistory"}),s("div",fe,i(t.$t("noRecord")),1)]),_:1})):(n(),a(E,{key:1,loading:v.value,"onUpdate:loading":o[0]||(o[0]=e=>v.value=e),"loading-text":t.$t("loading"),finished:Y.value,"finished-text":t.$t("noMore"),error:p.value,"onUpdate:error":o[1]||(o[1]=e=>p.value=e),"error-text":t.$t("errorText"),onLoad:R},{default:c(()=>[(n(!0),k(b,null,O(y.value,e=>(n(),a(B,{class:"receive-item item",key:e},{title:c(()=>[s("div",ge,[u(W,{chainIcon:r(J)(e.contractChain),tokenIcon:r(K)(e.contractChain.toLowerCase(),e.contractAddress.toLowerCase())},null,8,["chainIcon","tokenIcon"]),s("div",he,[s("div",null,[g(i(r(F)(e.userAddress)),1),u(d,{class:"copy-icon",name:"copy",onClick:$=>r(Q)(e.userAddress)},null,8,["onClick"])]),s("div",ye,[e.type==0?(n(),a(d,{key:0,class:"type-icon",name:"pin"})):(n(),a(d,{key:1,class:"type-icon",name:"pu"})),g(" "+i(r(X).unix(e.time).format("YYYY-MM-DD HH:mm")),1)])])])]),value:c(()=>[s("div",_e,[s("div",null,i(e.amount)+" "+i(e.symbol),1),e.tx?(n(),k("div",ke,[s("span",{onClick:$=>te(e.tx)},[g(i(t.$t("blockChainBrowser")),1),u(d,{class:"share-icon",name:"share"})],8,me)])):(n(),k("div",xe,[s("span",{onClick:$=>r(L).push(`/redpacket/${e.uuid}/showLuck`)},i(t.$t("seeLuck")),9,Ce)]))])]),_:2},1024))),128))]),_:1},8,["loading","loading-text","finished","finished-text","error","error-text"]))]),_:1},8,["modelValue","pulling-text","loosing-text","loading-text"])]),_:1},8,["title"]),u(z,{title:t.$t("isend")},{default:c(()=>[u(j,{modelValue:T.value,"onUpdate:modelValue":o[5]||(o[5]=e=>T.value=e),"pulling-text":t.$t("pulling"),"loosing-text":t.$t("loosing"),"loading-text":t.$t("loading"),onRefresh:P},{default:c(()=>[x.value.length==0?(n(),a(N,{key:0,class:"empty-box"},{image:c(()=>[u(d,{class:"icon",name:"emptyHistory"}),s("div",we,i(t.$t("noRecord")),1)]),_:1})):(n(),a(E,{key:1,loading:v.value,"onUpdate:loading":o[3]||(o[3]=e=>v.value=e),"loading-text":t.$t("loading"),finished:M.value,"finished-text":t.$t("noMore"),error:p.value,"onUpdate:error":o[4]||(o[4]=e=>p.value=e),"error-text":t.$t("errorText"),onLoad:V},{default:c(()=>[(n(!0),k(b,null,O(x.value,e=>(n(),a(B,{class:"send-item item",key:e,onClick:$=>Z(e)},{title:c(()=>[s("div",$e,[u(W,{chainIcon:r(J)(e.contractChain),tokenIcon:r(K)(e.contractChain.toLowerCase(),e.contractAddress.toLowerCase())},null,8,["chainIcon","tokenIcon"]),s("div",be,[s("div",null,[g(i(r(F)(e.creatorAddress)),1),u(d,{class:"copy-icon",name:"copy",onClick:re($=>r(Q)(e.creatorAddress),["stop"])},null,8,["onClick"])]),s("div",Le,[e.type==0?(n(),a(d,{key:0,class:"type-icon",name:"pin"})):(n(),a(d,{key:1,class:"type-icon",name:"pu"})),g(" "+i(r(X)(e.createTime).format("YYYY-MM-DD HH:mm")),1)])])])]),value:c(()=>[s("div",Ie,[s("div",Ae,[e.refundTx!=""||e.unlockTx!=""?(n(),k(b,{key:0},[r(m).language=="en"?(n(),a(d,{key:0,class:"type-icon",name:"endEn"})):(n(),a(d,{key:1,class:"type-icon",name:"endCn"}))],64)):(n(),k(b,{key:1},[r(m).language=="en"?(n(),a(d,{key:0,class:"type-icon",name:"goingEn"})):(n(),a(d,{key:1,class:"type-icon",name:"goingCn"}))],64))]),s("div",He,[s("div",null,i(e.totalAmount+" "+e.symbol),1),s("div",Te,[g(i(t.$t("received"))+" "+i(e.receivedCount),1),Ue,g(i(e.count),1)])])])]),_:2},1032,["onClick"]))),128))]),_:1},8,["loading","loading-text","finished","finished-text","error","error-text"]))]),_:1},8,["modelValue","pulling-text","loosing-text","loading-text"])]),_:1},8,["title"]),u(ne,{show:U.value,"onUpdate:show":o[6]||(o[6]=e=>U.value=e),actions:S.value,"cancel-text":"\u53D6\u6D88",description:_.creatorAddress,"close-on-click-action":"",onSelect:ee},null,8,["show","actions","description"])]),_:1},8,["active"])}}},Me=ve(Se,[["__scopeId","data-v-1d691416"]]);export{Me as default};
