import{T as B}from"./TokenIcon.a0687b33.js";import{_ as V}from"./SvgIcon.ed6a2a27.js";import{_ as q,k as G,j as J,l as K,n as u,q as W,R as X,s as Q,P as ee,S as te,r as b,o,b as i,a,u as s,O as I,t as d,d as c,c as D,g as h,e as P,F as se,J as ae,w as de,U as oe,V as R,W as ie,T as $,v as le,K as N,X as ne,f as ce,H as ve,I as re}from"./index.85e97609.js";import{u as ue}from"./redPacketStore.b6aa6049.js";import{d as H}from"./dayjs.min.ca26a367.js";const ye=k=>(ve("data-v-89d24d1c"),k=k(),re(),k),fe={class:"body"},pe={class:"top"},_e=oe('<div class="background" data-v-89d24d1c><div style="--i:1;" data-v-89d24d1c></div><div style="--i:2;" data-v-89d24d1c></div><div style="--i:3;" data-v-89d24d1c></div><div style="--i:4;" data-v-89d24d1c></div><div style="--i:5;" data-v-89d24d1c></div><div style="--i:6;" data-v-89d24d1c></div><div style="--i:7;" data-v-89d24d1c></div><div style="--i:8;" data-v-89d24d1c></div><div style="--i:9;" data-v-89d24d1c></div><div style="--i:10;" data-v-89d24d1c></div><div style="--i:11;" data-v-89d24d1c></div><div style="--i:12;" data-v-89d24d1c></div><div style="--i:13;" data-v-89d24d1c></div><div style="--i:14;" data-v-89d24d1c></div><div style="--i:15;" data-v-89d24d1c></div><div style="--i:16;" data-v-89d24d1c></div><div style="--i:17;" data-v-89d24d1c></div><div style="--i:18;" data-v-89d24d1c></div><div style="--i:19;" data-v-89d24d1c></div><div style="--i:20;" data-v-89d24d1c></div><div style="--i:21;" data-v-89d24d1c></div><div style="--i:22;" data-v-89d24d1c></div><div style="--i:23;" data-v-89d24d1c></div><div style="--i:24;" data-v-89d24d1c></div><div style="--i:25;" data-v-89d24d1c></div><div style="--i:26;" data-v-89d24d1c></div><div style="--i:27;" data-v-89d24d1c></div><div style="--i:28;" data-v-89d24d1c></div><div style="--i:29;" data-v-89d24d1c></div><div style="--i:30;" data-v-89d24d1c></div><div style="--i:31;" data-v-89d24d1c></div><div style="--i:32;" data-v-89d24d1c></div><div style="--i:33;" data-v-89d24d1c></div><div style="--i:34;" data-v-89d24d1c></div><div style="--i:35;" data-v-89d24d1c></div><div style="--i:36;" data-v-89d24d1c></div></div>',1),me={key:0,class:"info-box"},he={key:0,class:"fold-operate-fixed"},ke=ye(()=>a("span",{class:"dot"},"...",-1)),ge={class:"fold-text"},we={class:"red-packet"},Ce={class:"circle-big"},be={class:"circle-small"},Ie={key:0,class:"card"},Pe={class:"from"},Re={class:"amount"},$e={class:"congratulation"},He={class:"text"},Se={key:0,class:"logo"},Ae={key:1},Te={class:"text-top"},Le={class:"from"},xe={class:"congratulation"},Me={key:0,class:"front-cover"},Be={class:"packer-btn packer-btn-behind",style:{transform:"translateZ(-4px)"}},Ve={class:"packer-btn packer-btn-front"},We={class:"text-middle"},De={key:0},Ne={key:1},Oe={class:"text-bottom"},Ye={key:0,class:"award-time"},ze={key:1,class:"award-time"},Ee={class:"bottom"},Fe={class:"logo"},je={__name:"ReceiveRedPacket",setup(k){const e=ue(),r=G(),S=J(),{t:y}=K(),A=u(!1),f=u(!0),p=u(null),_=u(null),m=u(!1),l=u(0),g=u("--"),w=u(0),v=W(()=>w.value?e.sendTime+e.lockTime-w.value:0);X(()=>e.title,async(t,n)=>{T()});async function T(){if(!e.title)return;await R();let t=_.value.scrollHeight,n=_.value.offsetHeight;console.log(_.value.scrollHeight),console.log(_.value.offsetHeight),t>n&&(A.value=!0),document.body.style.setProperty("--top-height",p.value.scrollHeight-10+"px"),window.onresize=()=>(console.log("\u9AD8\u5EA6"),(()=>{document.body.style.setProperty("--top-height",p.value.scrollHeight-10+"px")})())}async function O(){f.value=!1,await R(),document.body.style.setProperty("--top-height",p.value.scrollHeight-10+"px")}async function Y(){f.value=!0,await R(),document.body.style.setProperty("--top-height",p.value.scrollHeight-10+"px")}async function z(){ie([e.coverImage])}async function E(){console.log("openClick");let t;if(r.walletAddress?t=$.loading():t=$.fail(y("connectWalletWarn")),!m.value){m.value=!0;try{await F()}catch(n){console.log(n)}finally{t.clear(),m.value=!1}}}async function F(){if(!r.isConnectWallet){if(await r.connectWallet(),!r.isConnectWallet)return;await e.getRedPacketDetail(e.uuid,r.walletAddress)}if(e.isReceived){const t=e.receiveList.find(n=>n.userAddress==r.walletAddress);g.value=t.amount,l.value=1;return}if(console.log(e.status),e.status==3||e.status==2){if(e.status==2&&v.value>0){let t="";v.value<60?t=y("unlockSecondsPlease",{seconds:v.value}):t=y("unlockHoursPlease",{hours:Math.floor(v.value/3600),minutes:Math.floor((v.value-Math.floor(v.value/3600)*3600)/60)}),$({message:t,position:"top"});return}try{const t=await le.redPacket.receive(r.walletAddress,e.uuid);console.log(t),t.status==1&&t.data.status==3&&(e.isReceived=!0,g.value=t.data.receiveResult.amount,l.value=1,e.receiveList.push({transferTime:H().unix(),amount:t.data.receiveResult.amount,userAddress:t.data.receiveResult.userAddress}))}catch(t){console.log(t),l.value=2}}else e.count==e.receiveList.length?l.value=2:l.value=3}const L=W(()=>e.creatorAddress?e.creatorAddress.substr(-4).toLowerCase():"--");let C=null;return Q(()=>{const n=ee().params.uuid;e.uuid=n,e.getRedPacketDetail(),C=setInterval(()=>{w.value=H().unix()},1e3),T()}),te(()=>{C&&clearInterval(C)}),(t,n)=>{const j=b("van-image"),U=b("van-icon"),Z=b("van-button");return o(),i("div",fe,[a("div",pe,[_e,a("div",{class:"content",ref_key:"content",ref:p},[s(e).title?(o(),i("div",me,[a("div",{class:I(["info",{fold:f.value}]),ref_key:"info",ref:_},[A.value&&f.value?(o(),i("div",he,[ke,a("span",{class:"fold-operate",onClick:O},d(t.$t("expand")),1)])):c("",!0),a("span",ge,d(s(e).title),1),f.value?c("",!0):(o(),i("span",{key:1,class:"fold-operate",onClick:Y},d(t.$t("putAway")),1))],2)])):c("",!0),a("div",we,[a("div",Ce,[a("div",be,[l.value==1?(o(),i("div",Ie,[a("div",Pe,[s(e).contractChain?(o(),D(B,{key:0,class:"token-icon",tokenIcon:s(N)(s(e).contractChain.toLowerCase(),s(e).contractAddress.toLowerCase())},null,8,["tokenIcon"])):c("",!0),a("span",null,d(t.$t("redPacketBelong",{user:s(L)})),1)]),a("div",Re,d(g.value+" "+s(e).symbol),1),a("div",$e,d(s(e).remark),1)])):c("",!0)])]),a("div",He,[l.value!=1?(o(),i("div",Se,[h(V,{class:"icon",name:"logo"})])):c("",!0),l.value!=1?(o(),i("div",Ae,[a("div",Te,[a("div",Le,[s(e).contractChain?(o(),D(B,{key:0,class:"token-icon",tokenIcon:s(N)(s(e).contractChain.toLowerCase(),s(e).contractAddress.toLowerCase())},null,8,["tokenIcon"])):c("",!0),P(d()+" ",1),a("span",null,"*"+d(t.$t("redPacketBelong",{user:s(L)})),1)]),a("div",xe,d(s(e).remark),1)]),l.value==0&&s(e).coverImage?(o(),i("div",Me,[h(j,{class:"img",fit:"contain",src:s(e).coverImage,onClick:z},null,8,["src"])])):c("",!0),l.value==0&&!m.value?(o(),i("div",{key:1,class:I(["open",s(r).language=="en"?"open-en":""]),onClick:E},d(t.$t("open")),3)):l.value==0&&m.value?(o(),i("div",{key:2,class:I(["anim-rotate packer-btn-pos",s(r).language=="en"?"open-en":""])},[a("div",Be,d(t.$t("open")),1),(o(),i(se,null,ae(7,(x,M)=>a("div",{class:"packer-btn-middle",key:M,style:ne({transform:`translateZ(${M-3}px)`})},null,4)),64)),a("div",Ve,d(t.$t("open")),1)],2)):c("",!0),a("div",We,[l.value==2?(o(),i("div",De,[a("div",null,d(t.$t("handSlow")),1),a("div",null,d(t.$t("redPackIsGone")),1)])):c("",!0),l.value==3?(o(),i("div",Ne,[a("div",null,d(t.$t("handSlow")),1),a("div",null,d(t.$t("redPackIsExpired")),1)])):c("",!0)])])):c("",!0),a("div",Oe,[l.value==1?(o(),i("div",Ye,d(t.$t("distributeTime",{date:s(H).unix(s(e).sendTime+s(e).lockTime+s(e).endTime).format("YYYY-MM-DD HH:mm"),address:s(ce)(s(r).walletAddress)})),1)):s(e).status==2&&s(v)>0?(o(),i("div",ze,d(s(v)<60?s(y)("unlockSeconds",{seconds:s(v)}):s(y)("unlockHours",{hours:Math.floor(s(v)/3600),minutes:Math.floor((s(v)-Math.floor(s(v)/3600)*3600)/60)})),1)):c("",!0),a("div",{class:"show-luck",onClick:n[0]||(n[0]=x=>s(S).push(`/redpacket/${s(e).uuid}/showLuck`))},[P(d(t.$t("seeLuckEveryone"))+" ",1),h(U,{name:"arrow"})])])])])],512)]),a("div",Ee,[h(Z,{class:"send-red-packet",onClick:n[1]||(n[1]=x=>s(S).push("/"))},{default:de(()=>[P(d(t.$t("giveOutRedPacket")),1)]),_:1}),a("div",Fe,[h(V,{class:"icon",name:"logo"})])])])}}},Ke=q(je,[["__scopeId","data-v-89d24d1c"]]);export{Ke as default};
