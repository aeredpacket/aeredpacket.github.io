import{j as ae,k as ne,n as c,q as le,r as f,o as s,c as n,w as r,T as q,s as z,g as u,a,t as l,b as m,y as G,u as i,D as O,E as J,e as _,f as V,h as K,F as I,G as ce,A as re,C as ie}from"./index.c0ffb222.js";import{T as Q,d as W}from"./dayjs.min.d93f8c3d.js";import{_ as d}from"./SvgIcon.462370a3.js";import{_ as de}from"./plugin-vueexport-helper.2444895f.js";const ue=C=>(re("data-v-3d46a245"),C=C(),ie(),C),ve={class:"text"},pe={class:"item-left"},fe={class:"left-content"},_e={class:"bottom-text"},ye={class:"item-right"},he={key:0,class:"bottom-text"},ke=["onClick"],ge={key:1,class:"bottom-text"},me=["onClick"],Ce={class:"text"},we={class:"item-left"},be={class:"left-content"},xe=["onClick"],Le={class:"bottom-text"},$e={class:"item-right"},Ie={class:"status-icon"},Ae={class:"content"},He={class:"bottom-text"},Te=ue(()=>a("span",null,"/",-1)),Ue={__name:"History",setup(C){const A=ae(),w=ne(),y=c(0),b=c(20),h=c([]),H=c(1),T=c(!1),k=c([]),F=c(1),x=c(!1),p=c(!1),L=c(!1),v=c(!1),U=c(!1),S=c([{name:"\u7EE7\u7EED\u8F6C\u53D1",value:"0",color:"#3F80F7"},{name:"\u67E5\u770B\u624B\u6C14",value:"1"}]),g=le({creatorAddress:"",showLuckUrl:"",redPacketUrl:""});function X(t){U.value=!0,t.refundTx==""&&t.unlockTx==""?S.value=[{name:"\u7EE7\u7EED\u8F6C\u53D1",value:"0",color:"#3F80F7"},{name:"\u67E5\u770B\u624B\u6C14",value:"1"}]:S.value=[{name:"\u67E5\u770B\u624B\u6C14",value:"1"}],g.creatorAddress=V(t.creatorAddress)+"\u53D1\u51FA\u7684\u7EA2\u5305",g.showLuckUrl="/redpacket/"+t.uuid+"/showLuck",g.redPacketUrl="/redpacket/"+t.uuid}function Z(t){t.value==0?A.push(g.redPacketUrl):t.value==1&&A.push(g.showLuckUrl)}function ee(t){window.open("https://testnet.bscscan.com/tx/"+t,"_blank")}function oe(){R()}function Y(){y.value==0?(H.value=1,h.value=[],M()):y.value==1&&(x.value=!1,k.value=[],P())}function R(){y.value==0?M():y.value==1&&P()}async function M(){p.value=!0;let t=q.loading({message:"Loading...",forbidClick:!0,duration:0});try{const o=await z.redPacket.getReceiveHistory(w.walletAddress,b.value,H.value);console.log(o),o.status==1?(console.log(h),h.value=h.value.concat(o.data.list),o.data.list.length<b.value?L.value=!0:H.value++):(console.log("fail"),v.value=!0)}catch(o){console.log(o),v.value=!0}finally{console.log(v.value),t.clear(),T.value=!1,p.value=!1}}async function P(){p.value=!0;let t=q.loading({message:"Loading...",forbidClick:!0,duration:0});try{const o=await z.redPacket.getSendHistory(w.walletAddress,b.value,F.value);console.log(o),o.status==1?(console.log(k),k.value=k.value.concat(o.data.list),o.data.list.length<b.value?L.value=!0:F.value++):(console.log("fail"),v.value=!0)}catch(o){console.log(o),v.value=!1}finally{console.log(v.value),t.clear(),x.value=!1,p.value=!1}}return(t,o)=>{const D=f("van-empty"),N=f("van-cell"),B=f("van-list"),E=f("van-pull-refresh"),j=f("van-tab"),te=f("van-action-sheet"),se=f("van-tabs");return s(),n(se,{class:"history",active:y.value,"onUpdate:active":o[7]||(o[7]=e=>y.value=e),onRendered:oe},{default:r(()=>[u(j,{class:"tab-top",title:t.$t("ireceived")},{default:r(()=>[u(E,{modelValue:T.value,"onUpdate:modelValue":o[2]||(o[2]=e=>T.value=e),onRefresh:Y},{default:r(()=>[h.value.length==0?(s(),n(D,{key:0,class:"empty-box"},{image:r(()=>[u(d,{class:"icon",name:"emptyHistory"}),a("div",ve,l(t.$t("noRecord")),1)]),_:1})):(s(),n(B,{key:1,loading:p.value,"onUpdate:loading":o[0]||(o[0]=e=>p.value=e),finished:L.value,"finished-text":t.$t("noMore"),error:v.value,"onUpdate:error":o[1]||(o[1]=e=>v.value=e),"error-text":t.$t("errorText"),onLoad:R},{default:r(()=>[(s(!0),m(I,null,G(h.value,e=>(s(),n(N,{class:"receive-item item",key:e},{title:r(()=>[a("div",pe,[u(Q,{chainIcon:i(O)(e.contractChain),tokenIcon:i(J)(e.contractChain.toLowerCase(),e.contractAddress.toLowerCase())},null,8,["chainIcon","tokenIcon"]),a("div",fe,[a("div",null,[_(l(i(V)(e.userAddress)),1),u(d,{class:"copy-icon",name:"copy",onClick:$=>i(K)(e.userAddress)},null,8,["onClick"])]),a("div",_e,[e.type==0?(s(),n(d,{key:0,class:"type-icon",name:"pin"})):(s(),n(d,{key:1,class:"type-icon",name:"pu"})),_(" "+l(i(W).unix(e.time).format("YYYY-MM-DD HH:mm")),1)])])])]),value:r(()=>[a("div",ye,[a("div",null,l(e.amount)+" "+l(e.symbol),1),e.tx?(s(),m("div",he,[a("span",{onClick:$=>ee(e.tx)},[_(l(t.$t("Blockchain browser")),1),u(d,{class:"share-icon",name:"share"})],8,ke)])):(s(),m("div",ge,[a("span",{onClick:$=>i(A).push(`/redpacket/${e.uuid}/showLuck`)},l(t.$t("seeLuck")),9,me)]))])]),_:2},1024))),128))]),_:1},8,["loading","finished","finished-text","error","error-text"]))]),_:1},8,["modelValue"])]),_:1},8,["title"]),u(j,{title:t.$t("isend")},{default:r(()=>[u(E,{modelValue:x.value,"onUpdate:modelValue":o[5]||(o[5]=e=>x.value=e),onRefresh:Y},{default:r(()=>[k.value.length==0?(s(),n(D,{key:0,class:"empty-box"},{image:r(()=>[u(d,{class:"icon",name:"emptyHistory"}),a("div",Ce,l(t.$t("noRecord")),1)]),_:1})):(s(),n(B,{key:1,loading:p.value,"onUpdate:loading":o[3]||(o[3]=e=>p.value=e),finished:L.value,"finished-text":t.$t("noMore"),error:v.value,"onUpdate:error":o[4]||(o[4]=e=>v.value=e),"error-text":t.$t("errorText"),onLoad:R},{default:r(()=>[(s(!0),m(I,null,G(k.value,e=>(s(),n(N,{class:"send-item item",key:e,onClick:$=>X(e)},{title:r(()=>[a("div",we,[u(Q,{chainIcon:i(O)(e.contractChain),tokenIcon:i(J)(e.contractChain.toLowerCase(),e.contractAddress.toLowerCase())},null,8,["chainIcon","tokenIcon"]),a("div",be,[a("div",{onClick:ce($=>i(K)(e.creatorAddress),["stop"])},[_(l(i(V)(e.creatorAddress)),1),u(d,{class:"copy-icon",name:"copy"})],8,xe),a("div",Le,[e.type==0?(s(),n(d,{key:0,class:"type-icon",name:"pin"})):(s(),n(d,{key:1,class:"type-icon",name:"pu"})),_(" "+l(i(W)(e.createTime).format("YYYY-MM-DD HH:mm")),1)])])])]),value:r(()=>[a("div",$e,[a("div",Ie,[e.refundTx!=""||e.unlockTx!=""?(s(),m(I,{key:0},[i(w).language=="en"?(s(),n(d,{key:0,class:"type-icon",name:"endEn"})):(s(),n(d,{key:1,class:"type-icon",name:"endCn"}))],64)):(s(),m(I,{key:1},[i(w).language=="en"?(s(),n(d,{key:0,class:"type-icon",name:"goingEn"})):(s(),n(d,{key:1,class:"type-icon",name:"goingCn"}))],64))]),a("div",Ae,[a("div",null,l(e.totalAmount+" "+e.symbol),1),a("div",He,[_(l(t.$t("received"))+" "+l(e.receivedCount),1),Te,_(l(e.count),1)])])])]),_:2},1032,["onClick"]))),128))]),_:1},8,["loading","finished","finished-text","error","error-text"]))]),_:1},8,["modelValue"])]),_:1},8,["title"]),u(te,{show:U.value,"onUpdate:show":o[6]||(o[6]=e=>U.value=e),actions:S.value,"cancel-text":"\u53D6\u6D88",description:g.creatorAddress,"close-on-click-action":"",onSelect:Z},null,8,["show","actions","description"])]),_:1},8,["active"])}}},Ye=de(Ue,[["__scopeId","data-v-3d46a245"]]);export{Ye as default};
