import{j as le,k as ie,l as ce,n as l,q as re,E as de,r as f,o as n,c as a,w as c,T as G,s as O,g as u,a as s,t as i,b as _,z as J,u as r,x as K,G as Q,e as g,f as P,h as W,F as L,H as ue,C as ve,D as pe}from"./index.30f68317.js";import{T as X,d as Z}from"./dayjs.min.72396b32.js";import{_ as d}from"./SvgIcon.35a27e4d.js";import{_ as fe}from"./plugin-vueexport-helper.2444895f.js";const ge=C=>(ve("data-v-5034011a"),C=C(),pe(),C),he={class:"text"},ye={class:"item-left"},ke={class:"left-content"},_e={class:"bottom-text"},me={class:"item-right"},xe={key:0,class:"bottom-text"},Ce=["onClick"],we={key:1,class:"bottom-text"},$e=["onClick"],be={class:"text"},Le={class:"item-left"},Ie={class:"left-content"},Ae={class:"bottom-text"},He={class:"item-right"},Se={class:"status-icon"},Te={class:"content"},Ue={class:"bottom-text"},Re=ge(()=>s("span",null,"/",-1)),Ve={__name:"History",setup(C){const I=le(),m=ie(),{t:w}=ce(),h=l(0),$=l(20),y=l([]),A=l(1),H=l(!1),Y=l(!1),x=l([]),S=l(1),T=l(!1),M=l(!1),v=l(!1),p=l(!1),U=l(!1),R=l([]),k=re({creatorAddress:"",showLuckUrl:"",redPacketUrl:""});de(()=>m.walletAddress,async(t,o)=>{console.log("newVal:"+t),N()});function ee(t){U.value=!0,t.refundTx==""&&t.unlockTx==""?R.value=[{name:w("continueShare"),value:"0",color:"#3F80F7"},{name:w("seeLuck"),value:"1"}]:R.value=[{name:w("seeLuck"),value:"1"}],k.creatorAddress=w("redPacketSend",{user:P(t.creatorAddress)}),k.showLuckUrl="/redpacket/"+t.uuid+"/showLuck",k.redPacketUrl="/redpacket/"+t.uuid}function te(t){t.value==0?I.push(k.redPacketUrl):t.value==1&&I.push(k.showLuckUrl)}function oe(t){window.open("https://testnet.bscscan.com/tx/"+t,"_blank")}function ne(){N()}function D(){h.value==0?(A.value=1,y.value=[],V()):h.value==1&&(S.value=1,x.value=[],F())}function N(){console.log(111),h.value==0?V():h.value==1&&F()}async function V(){v.value=!0;let t=G.loading({message:"Loading...",forbidClick:!0,duration:0});try{const o=await O.redPacket.getReceiveHistory(m.walletAddress,$.value,A.value);console.log(o),o.status==1?(console.log(y),y.value=y.value.concat(o.data.list),o.data.list.length<$.value?Y.value=!0:A.value++):(console.log("fail"),p.value=!0)}catch(o){console.log(o),p.value=!0}finally{t.clear(),H.value=!1,v.value=!1}}async function F(){v.value=!0;let t=G.loading({message:"Loading...",forbidClick:!0,duration:0});try{const o=await O.redPacket.getSendHistory(m.walletAddress,$.value,S.value);console.log(o),o.status==1?(x.value=x.value.concat(o.data.list),o.data.list.length<$.value?M.value=!0:S.value++):(console.log("fail"),p.value=!0)}catch(o){console.log(o),p.value=!1}finally{t.clear(),T.value=!1,v.value=!1}}return(t,o)=>{const B=f("van-empty"),E=f("van-cell"),j=f("van-list"),z=f("van-pull-refresh"),q=f("van-tab"),se=f("van-action-sheet"),ae=f("van-tabs");return n(),a(ae,{class:"history",active:h.value,"onUpdate:active":o[7]||(o[7]=e=>h.value=e),onRendered:ne},{default:c(()=>[u(q,{class:"tab-top",title:t.$t("ireceived")},{default:c(()=>[u(z,{modelValue:H.value,"onUpdate:modelValue":o[2]||(o[2]=e=>H.value=e),"pulling-text":t.$t("pulling"),"loosing-text":t.$t("loosing"),"loading-text":t.$t("loading"),onRefresh:D},{default:c(()=>[y.value.length==0?(n(),a(B,{key:0,class:"empty-box"},{image:c(()=>[u(d,{class:"icon",name:"emptyHistory"}),s("div",he,i(t.$t("noRecord")),1)]),_:1})):(n(),a(j,{key:1,loading:v.value,"onUpdate:loading":o[0]||(o[0]=e=>v.value=e),"loading-text":t.$t("loading"),finished:Y.value,"finished-text":t.$t("noMore"),error:p.value,"onUpdate:error":o[1]||(o[1]=e=>p.value=e),"error-text":t.$t("errorText"),onLoad:V},{default:c(()=>[(n(!0),_(L,null,J(y.value,e=>(n(),a(E,{class:"receive-item item",key:e},{title:c(()=>[s("div",ye,[u(X,{chainIcon:r(K)(e.contractChain),tokenIcon:r(Q)(e.contractChain.toLowerCase(),e.contractAddress.toLowerCase())},null,8,["chainIcon","tokenIcon"]),s("div",ke,[s("div",null,[g(i(r(P)(e.userAddress)),1),u(d,{class:"copy-icon",name:"copy",onClick:b=>r(W)(e.userAddress)},null,8,["onClick"])]),s("div",_e,[e.type==0?(n(),a(d,{key:0,class:"type-icon",name:"pin"})):(n(),a(d,{key:1,class:"type-icon",name:"pu"})),g(" "+i(r(Z).unix(e.time).format("YYYY-MM-DD HH:mm")),1)])])])]),value:c(()=>[s("div",me,[s("div",null,i(e.amount)+" "+i(e.symbol),1),e.tx?(n(),_("div",xe,[s("span",{onClick:b=>oe(e.tx)},[g(i(t.$t("blockChainBrowser")),1),u(d,{class:"share-icon",name:"share"})],8,Ce)])):(n(),_("div",we,[s("span",{onClick:b=>r(I).push(`/redpacket/${e.uuid}/showLuck`)},i(t.$t("seeLuck")),9,$e)]))])]),_:2},1024))),128))]),_:1},8,["loading","loading-text","finished","finished-text","error","error-text"]))]),_:1},8,["modelValue","pulling-text","loosing-text","loading-text"])]),_:1},8,["title"]),u(q,{title:t.$t("isend")},{default:c(()=>[u(z,{modelValue:T.value,"onUpdate:modelValue":o[5]||(o[5]=e=>T.value=e),"pulling-text":t.$t("pulling"),"loosing-text":t.$t("loosing"),"loading-text":t.$t("loading"),onRefresh:D},{default:c(()=>[x.value.length==0?(n(),a(B,{key:0,class:"empty-box"},{image:c(()=>[u(d,{class:"icon",name:"emptyHistory"}),s("div",be,i(t.$t("noRecord")),1)]),_:1})):(n(),a(j,{key:1,loading:v.value,"onUpdate:loading":o[3]||(o[3]=e=>v.value=e),"loading-text":t.$t("loading"),finished:M.value,"finished-text":t.$t("noMore"),error:p.value,"onUpdate:error":o[4]||(o[4]=e=>p.value=e),"error-text":t.$t("errorText"),onLoad:F},{default:c(()=>[(n(!0),_(L,null,J(x.value,e=>(n(),a(E,{class:"send-item item",key:e,onClick:b=>ee(e)},{title:c(()=>[s("div",Le,[u(X,{chainIcon:r(K)(e.contractChain),tokenIcon:r(Q)(e.contractChain.toLowerCase(),e.contractAddress.toLowerCase())},null,8,["chainIcon","tokenIcon"]),s("div",Ie,[s("div",null,[g(i(r(P)(e.creatorAddress)),1),u(d,{class:"copy-icon",name:"copy",onClick:ue(b=>r(W)(e.creatorAddress),["stop"])},null,8,["onClick"])]),s("div",Ae,[e.type==0?(n(),a(d,{key:0,class:"type-icon",name:"pin"})):(n(),a(d,{key:1,class:"type-icon",name:"pu"})),g(" "+i(r(Z)(e.createTime).format("YYYY-MM-DD HH:mm")),1)])])])]),value:c(()=>[s("div",He,[s("div",Se,[e.refundTx!=""||e.unlockTx!=""?(n(),_(L,{key:0},[r(m).language=="en"?(n(),a(d,{key:0,class:"type-icon",name:"endEn"})):(n(),a(d,{key:1,class:"type-icon",name:"endCn"}))],64)):(n(),_(L,{key:1},[r(m).language=="en"?(n(),a(d,{key:0,class:"type-icon",name:"goingEn"})):(n(),a(d,{key:1,class:"type-icon",name:"goingCn"}))],64))]),s("div",Te,[s("div",null,i(e.totalAmount+" "+e.symbol),1),s("div",Ue,[g(i(t.$t("received"))+" "+i(e.receivedCount),1),Re,g(i(e.count),1)])])])]),_:2},1032,["onClick"]))),128))]),_:1},8,["loading","loading-text","finished","finished-text","error","error-text"]))]),_:1},8,["modelValue","pulling-text","loosing-text","loading-text"])]),_:1},8,["title"]),u(se,{show:U.value,"onUpdate:show":o[6]||(o[6]=e=>U.value=e),actions:R.value,"cancel-text":t.$t("cancel"),description:k.creatorAddress,"close-on-click-action":"",onSelect:te},null,8,["show","actions","cancel-text","description"])]),_:1},8,["active"])}}},De=fe(Ve,[["__scopeId","data-v-5034011a"]]);export{De as default};
