import{_ as re,p as de,k as ue,j as ve,q as pe,l as d,s as fe,r as p,o as s,c,w as a,u as l,T as M,y as K,g as r,a as n,t as i,b as y,m as G,I as J,O as Q,e as _,f as D,h as B,F as I,P as ge,K as _e,L as he}from"./index.037e7445.js";import{T as W}from"./TokenIcon.0a09a583.js";import{_ as u,d as X}from"./dayjs.min.c216f496.js";const ke=x=>(_e("data-v-37f62262"),x=x(),he(),x),ye={class:"text"},me={class:"item-left"},we={class:"left-content"},Ce={class:"bottom-text"},xe={class:"item-right"},$e={key:0,class:"bottom-text"},be=["onClick"],Le={key:1,class:"bottom-text"},Ie=["onClick"],Se={class:"text"},Ue={class:"item-left"},Ae={class:"left-content"},He={class:"bottom-text"},Te={class:"item-right"},Re={class:"status-icon"},Pe={class:"content"},Ve={class:"bottom-text"},Fe=ke(()=>n("span",null,"/",-1)),Ne={class:"content"},Ye={class:"success-icon"},Me={class:"text"},De={class:"btn"},Be={__name:"History",setup(x){const j=de(),v=ue(),{t:m}=ve(),Z=pe("global"),$=d(20),h=d([]),S=d(1),U=d(!1),A=d(!1),w=d([]),H=d(1),T=d(!1),R=d(!1),f=d(!1),g=d(!1),P=d(!1),V=d([]),F=d(!1),k=fe({creatorAddress:"",showLuckUrl:"",redPacketUrl:""});function ee(t){P.value=!0,t.refundTx==""&&t.unlockTx==""?V.value=[{name:m("continueShare"),value:"0",color:"#3F80F7"},{name:m("seeLuck"),value:"1"}]:V.value=[{name:m("seeLuck"),value:"1"}],k.creatorAddress=m("redPacketSend",{user:D(t.creatorAddress)}),k.showLuckUrl="/redpacket/"+t.uuid+"/showLuck",k.redPacketUrl=window.location.origin+"/#/redpacket/"+t.uuid}function te(t){t.value==0?F.value=!0:t.value==1&&j.push(k.showLuckUrl)}function oe(t,o){let C=Z.cfg.allowChainList.find(b=>b.chain==t);C?window.open(C.txNetwork+o,"_blank"):M(m("unsupportedNetwork"))}function ne(){se()}function E(){v.active==0?(S.value=1,h.value=[],A.value=!1,N()):v.active==1&&(H.value=1,w.value=[],R.value=!1,Y())}function se(){console.log(111),v.active==0?N():v.active==1&&Y()}async function N(){f.value=!0;let t=M.loading({message:"Loading...",forbidClick:!0,duration:0});try{const o=await K.redPacket.getReceiveHistory(v.walletAddress,$.value,S.value);console.log(o),o.status==1?(console.log(h),h.value=h.value.concat(o.data.list),o.data.list.length<$.value?A.value=!0:S.value++):(console.log("fail"),g.value=!0)}catch(o){console.log(o),g.value=!0}finally{t.clear(),U.value=!1,f.value=!1}}async function Y(){f.value=!0;let t=M.loading({message:"Loading...",forbidClick:!0,duration:0});try{const o=await K.redPacket.getSendHistory(v.walletAddress,$.value,H.value);console.log(o),o.status==1?(w.value=w.value.concat(o.data.list),o.data.list.length<$.value?R.value=!0:H.value++):(console.log("fail"),g.value=!0)}catch(o){console.log(o),g.value=!1}finally{t.clear(),T.value=!1,f.value=!1}}return(t,o)=>{const C=p("van-empty"),b=p("van-cell"),O=p("van-list"),q=p("van-pull-refresh"),z=p("van-tab"),ae=p("van-action-sheet"),le=p("van-button"),ie=p("van-dialog"),ce=p("van-tabs");return s(),c(ce,{class:"history",active:l(v).active,"onUpdate:active":o[9]||(o[9]=e=>l(v).active=e),onRendered:ne},{default:a(()=>[r(z,{class:"tab-top",title:t.$t("ireceived")},{default:a(()=>[r(q,{modelValue:U.value,"onUpdate:modelValue":o[2]||(o[2]=e=>U.value=e),"pulling-text":t.$t("pulling"),"loosing-text":t.$t("loosing"),"loading-text":t.$t("loading"),onRefresh:E},{default:a(()=>[h.value.length==0?(s(),c(C,{key:0,class:"empty-box"},{image:a(()=>[r(u,{class:"icon",name:"emptyHistory"}),n("div",ye,i(t.$t("noRecord")),1)]),_:1})):(s(),c(O,{key:1,loading:f.value,"onUpdate:loading":o[0]||(o[0]=e=>f.value=e),"loading-text":t.$t("loading"),finished:A.value,"finished-text":t.$t("noMore"),error:g.value,"onUpdate:error":o[1]||(o[1]=e=>g.value=e),"error-text":t.$t("errorText"),onLoad:N},{default:a(()=>[(s(!0),y(I,null,G(h.value,e=>(s(),c(b,{class:"receive-item item",key:e},{title:a(()=>[n("div",me,[r(W,{chainIcon:l(J)(e.contractChain),tokenIcon:l(Q)(e.contractChain.toLowerCase(),e.contractAddress.toLowerCase())},null,8,["chainIcon","tokenIcon"]),n("div",we,[n("div",null,[_(i(l(D)(e.userAddress)),1),r(u,{class:"copy-icon",name:"copy",onClick:L=>l(B)(e.userAddress)},null,8,["onClick"])]),n("div",Ce,[e.type==0?(s(),c(u,{key:0,class:"type-icon",name:"pin"})):(s(),c(u,{key:1,class:"type-icon",name:"pu"})),_(" "+i(l(X).unix(e.time).format("YYYY-MM-DD HH:mm")),1)])])])]),value:a(()=>[n("div",xe,[n("div",null,i(e.amount)+" "+i(e.symbol),1),e.tx?(s(),y("div",$e,[n("span",{onClick:L=>oe(e.contractChain,e.tx)},[_(i(t.$t("blockChainBrowser")),1),r(u,{class:"share-icon",name:"share"})],8,be)])):(s(),y("div",Le,[n("span",{onClick:L=>l(j).push(`/redpacket/${e.uuid}/showLuck`)},i(t.$t("seeLuck")),9,Ie)]))])]),_:2},1024))),128))]),_:1},8,["loading","loading-text","finished","finished-text","error","error-text"]))]),_:1},8,["modelValue","pulling-text","loosing-text","loading-text"])]),_:1},8,["title"]),r(z,{title:t.$t("isend")},{default:a(()=>[r(q,{modelValue:T.value,"onUpdate:modelValue":o[5]||(o[5]=e=>T.value=e),"pulling-text":t.$t("pulling"),"loosing-text":t.$t("loosing"),"loading-text":t.$t("loading"),onRefresh:E},{default:a(()=>[w.value.length==0?(s(),c(C,{key:0,class:"empty-box"},{image:a(()=>[r(u,{class:"icon",name:"emptyHistory"}),n("div",Se,i(t.$t("noRecord")),1)]),_:1})):(s(),c(O,{key:1,loading:f.value,"onUpdate:loading":o[3]||(o[3]=e=>f.value=e),"loading-text":t.$t("loading"),finished:R.value,"finished-text":t.$t("noMore"),error:g.value,"onUpdate:error":o[4]||(o[4]=e=>g.value=e),"error-text":t.$t("errorText"),onLoad:Y},{default:a(()=>[(s(!0),y(I,null,G(w.value,e=>(s(),c(b,{class:"send-item item",key:e,onClick:L=>ee(e)},{title:a(()=>[n("div",Ue,[r(W,{chainIcon:l(J)(e.contractChain),tokenIcon:l(Q)(e.contractChain.toLowerCase(),e.contractAddress.toLowerCase())},null,8,["chainIcon","tokenIcon"]),n("div",Ae,[n("div",null,[_(i(l(D)(e.creatorAddress)),1),r(u,{class:"copy-icon",name:"copy",onClick:ge(L=>l(B)(e.creatorAddress),["stop"])},null,8,["onClick"])]),n("div",He,[e.type==0?(s(),c(u,{key:0,class:"type-icon",name:"pin"})):(s(),c(u,{key:1,class:"type-icon",name:"pu"})),_(" "+i(l(X)(e.createTime).format("YYYY-MM-DD HH:mm")),1)])])])]),value:a(()=>[n("div",Te,[n("div",Re,[e.refundTx!=""||e.unlockTx!=""?(s(),y(I,{key:0},[l(v).language=="en"?(s(),c(u,{key:0,class:"type-icon",name:"endEn"})):(s(),c(u,{key:1,class:"type-icon",name:"endCn"}))],64)):(s(),y(I,{key:1},[l(v).language=="en"?(s(),c(u,{key:0,class:"type-icon",name:"goingEn"})):(s(),c(u,{key:1,class:"type-icon",name:"goingCn"}))],64))]),n("div",Pe,[n("div",null,i(e.totalAmount+" "+e.symbol),1),n("div",Ve,[_(i(t.$t("received"))+" "+i(e.receivedCount),1),Fe,_(i(e.count),1)])])])]),_:2},1032,["onClick"]))),128))]),_:1},8,["loading","loading-text","finished","finished-text","error","error-text"]))]),_:1},8,["modelValue","pulling-text","loosing-text","loading-text"])]),_:1},8,["title"]),r(ae,{show:P.value,"onUpdate:show":o[6]||(o[6]=e=>P.value=e),actions:V.value,"cancel-text":t.$t("cancel"),description:k.creatorAddress,"close-on-click-action":"",onSelect:te},null,8,["show","actions","cancel-text","description"]),r(ie,{class:"create-success-dialog",show:F.value,"onUpdate:show":o[8]||(o[8]=e=>F.value=e),"close-on-click-overlay":""},{footer:a(()=>[n("div",De,[r(le,{class:"copy-btn",type:"primary",onClick:o[7]||(o[7]=e=>l(B)(k.redPacketUrl))},{default:a(()=>[_(i(t.$t("copyLink")),1)]),_:1})])]),default:a(()=>[n("div",Ne,[n("div",Ye,[r(u,{name:"createSuccess"})]),n("div",Me,i(t.$t("shareLink")),1)])]),_:1},8,["show"])]),_:1},8,["active"])}}},qe=re(Be,[["__scopeId","data-v-37f62262"]]);export{qe as default};
