import{_ as de,j as ue,k as ve,l as pe,m as fe,n as i,E as ge,r as v,o as s,c,w as a,T as Y,s as J,g as r,a as n,t as l,b as y,G as K,u as d,x as Q,H as W,e as g,f as D,h as M,F as H,z as _e,C as he,D as ke}from"./index.7b1279d5.js";import{T as X}from"./TokenIcon.74cd753f.js";import{_ as u}from"./SvgIcon.c937bd7f.js";import{d as Z}from"./dayjs.min.52b6b34e.js";const ye=b=>(he("data-v-3b5c0115"),b=b(),ke(),b),me={class:"text"},we={class:"item-left"},Ce={class:"left-content"},be={class:"bottom-text"},xe={class:"item-right"},$e={key:0,class:"bottom-text"},Le=["onClick"],Ie={key:1,class:"bottom-text"},He=["onClick"],Se={class:"text"},Ue={class:"item-left"},Ae={class:"left-content"},Te={class:"bottom-text"},Re={class:"item-right"},Ve={class:"status-icon"},Fe={class:"content"},Ne={class:"bottom-text"},Pe=ye(()=>n("span",null,"/",-1)),Ye={class:"content"},De={class:"success-icon"},Me={class:"text"},Be={class:"btn"},Ee={__name:"History",setup(b){const B=ue(),x=ve(),{t:m}=pe(),ee=fe("global"),_=i(0),$=i(20),h=i([]),S=i(1),U=i(!1),E=i(!1),w=i([]),A=i(1),T=i(!1),j=i(!1),p=i(!1),f=i(!1),R=i(!1),V=i([]),F=i(!1),k=ge({creatorAddress:"",showLuckUrl:"",redPacketUrl:""});function te(t){R.value=!0,t.refundTx==""&&t.unlockTx==""?V.value=[{name:m("continueShare"),value:"0",color:"#3F80F7"},{name:m("seeLuck"),value:"1"}]:V.value=[{name:m("seeLuck"),value:"1"}],k.creatorAddress=m("redPacketSend",{user:D(t.creatorAddress)}),k.showLuckUrl="/redpacket/"+t.uuid+"/showLuck",k.redPacketUrl=window.location.origin+"/#/redpacket/"+t.uuid}function oe(t){t.value==0?F.value=!0:t.value==1&&B.push(k.showLuckUrl)}function ne(t,o){let C=ee.cfg.allowChainList.find(L=>L.chain==t);C?window.open(C.txNetwork+o,"_blank"):Y(m("unsupportedNetwork"))}function se(){ae()}function z(){_.value==0?(S.value=1,h.value=[],N()):_.value==1&&(A.value=1,w.value=[],P())}function ae(){console.log(111),_.value==0?N():_.value==1&&P()}async function N(){p.value=!0;let t=Y.loading({message:"Loading...",forbidClick:!0,duration:0});try{const o=await J.redPacket.getReceiveHistory(x.walletAddress,$.value,S.value);console.log(o),o.status==1?(console.log(h),h.value=h.value.concat(o.data.list),o.data.list.length<$.value?E.value=!0:S.value++):(console.log("fail"),f.value=!0)}catch(o){console.log(o),f.value=!0}finally{t.clear(),U.value=!1,p.value=!1}}async function P(){p.value=!0;let t=Y.loading({message:"Loading...",forbidClick:!0,duration:0});try{const o=await J.redPacket.getSendHistory(x.walletAddress,$.value,A.value);console.log(o),o.status==1?(w.value=w.value.concat(o.data.list),o.data.list.length<$.value?j.value=!0:A.value++):(console.log("fail"),f.value=!0)}catch(o){console.log(o),f.value=!1}finally{t.clear(),T.value=!1,p.value=!1}}return(t,o)=>{const C=v("van-empty"),L=v("van-cell"),G=v("van-list"),O=v("van-pull-refresh"),q=v("van-tab"),le=v("van-action-sheet"),ie=v("van-button"),ce=v("van-dialog"),re=v("van-tabs");return s(),c(re,{class:"history",active:_.value,"onUpdate:active":o[9]||(o[9]=e=>_.value=e),onRendered:se},{default:a(()=>[r(q,{class:"tab-top",title:t.$t("ireceived")},{default:a(()=>[r(O,{modelValue:U.value,"onUpdate:modelValue":o[2]||(o[2]=e=>U.value=e),"pulling-text":t.$t("pulling"),"loosing-text":t.$t("loosing"),"loading-text":t.$t("loading"),onRefresh:z},{default:a(()=>[h.value.length==0?(s(),c(C,{key:0,class:"empty-box"},{image:a(()=>[r(u,{class:"icon",name:"emptyHistory"}),n("div",me,l(t.$t("noRecord")),1)]),_:1})):(s(),c(G,{key:1,loading:p.value,"onUpdate:loading":o[0]||(o[0]=e=>p.value=e),"loading-text":t.$t("loading"),finished:E.value,"finished-text":t.$t("noMore"),error:f.value,"onUpdate:error":o[1]||(o[1]=e=>f.value=e),"error-text":t.$t("errorText"),onLoad:N},{default:a(()=>[(s(!0),y(H,null,K(h.value,e=>(s(),c(L,{class:"receive-item item",key:e},{title:a(()=>[n("div",we,[r(X,{chainIcon:d(Q)(e.contractChain),tokenIcon:d(W)(e.contractChain.toLowerCase(),e.contractAddress.toLowerCase())},null,8,["chainIcon","tokenIcon"]),n("div",Ce,[n("div",null,[g(l(d(D)(e.userAddress)),1),r(u,{class:"copy-icon",name:"copy",onClick:I=>d(M)(e.userAddress)},null,8,["onClick"])]),n("div",be,[e.type==0?(s(),c(u,{key:0,class:"type-icon",name:"pin"})):(s(),c(u,{key:1,class:"type-icon",name:"pu"})),g(" "+l(d(Z).unix(e.time).format("YYYY-MM-DD HH:mm")),1)])])])]),value:a(()=>[n("div",xe,[n("div",null,l(e.amount)+" "+l(e.symbol),1),e.tx?(s(),y("div",$e,[n("span",{onClick:I=>ne(e.contractChain,e.tx)},[g(l(t.$t("blockChainBrowser")),1),r(u,{class:"share-icon",name:"share"})],8,Le)])):(s(),y("div",Ie,[n("span",{onClick:I=>d(B).push(`/redpacket/${e.uuid}/showLuck`)},l(t.$t("seeLuck")),9,He)]))])]),_:2},1024))),128))]),_:1},8,["loading","loading-text","finished","finished-text","error","error-text"]))]),_:1},8,["modelValue","pulling-text","loosing-text","loading-text"])]),_:1},8,["title"]),r(q,{title:t.$t("isend")},{default:a(()=>[r(O,{modelValue:T.value,"onUpdate:modelValue":o[5]||(o[5]=e=>T.value=e),"pulling-text":t.$t("pulling"),"loosing-text":t.$t("loosing"),"loading-text":t.$t("loading"),onRefresh:z},{default:a(()=>[w.value.length==0?(s(),c(C,{key:0,class:"empty-box"},{image:a(()=>[r(u,{class:"icon",name:"emptyHistory"}),n("div",Se,l(t.$t("noRecord")),1)]),_:1})):(s(),c(G,{key:1,loading:p.value,"onUpdate:loading":o[3]||(o[3]=e=>p.value=e),"loading-text":t.$t("loading"),finished:j.value,"finished-text":t.$t("noMore"),error:f.value,"onUpdate:error":o[4]||(o[4]=e=>f.value=e),"error-text":t.$t("errorText"),onLoad:P},{default:a(()=>[(s(!0),y(H,null,K(w.value,e=>(s(),c(L,{class:"send-item item",key:e,onClick:I=>te(e)},{title:a(()=>[n("div",Ue,[r(X,{chainIcon:d(Q)(e.contractChain),tokenIcon:d(W)(e.contractChain.toLowerCase(),e.contractAddress.toLowerCase())},null,8,["chainIcon","tokenIcon"]),n("div",Ae,[n("div",null,[g(l(d(D)(e.creatorAddress)),1),r(u,{class:"copy-icon",name:"copy",onClick:_e(I=>d(M)(e.creatorAddress),["stop"])},null,8,["onClick"])]),n("div",Te,[e.type==0?(s(),c(u,{key:0,class:"type-icon",name:"pin"})):(s(),c(u,{key:1,class:"type-icon",name:"pu"})),g(" "+l(d(Z)(e.createTime).format("YYYY-MM-DD HH:mm")),1)])])])]),value:a(()=>[n("div",Re,[n("div",Ve,[e.refundTx!=""||e.unlockTx!=""?(s(),y(H,{key:0},[d(x).language=="en"?(s(),c(u,{key:0,class:"type-icon",name:"endEn"})):(s(),c(u,{key:1,class:"type-icon",name:"endCn"}))],64)):(s(),y(H,{key:1},[d(x).language=="en"?(s(),c(u,{key:0,class:"type-icon",name:"goingEn"})):(s(),c(u,{key:1,class:"type-icon",name:"goingCn"}))],64))]),n("div",Fe,[n("div",null,l(e.totalAmount+" "+e.symbol),1),n("div",Ne,[g(l(t.$t("received"))+" "+l(e.receivedCount),1),Pe,g(l(e.count),1)])])])]),_:2},1032,["onClick"]))),128))]),_:1},8,["loading","loading-text","finished","finished-text","error","error-text"]))]),_:1},8,["modelValue","pulling-text","loosing-text","loading-text"])]),_:1},8,["title"]),r(le,{show:R.value,"onUpdate:show":o[6]||(o[6]=e=>R.value=e),actions:V.value,"cancel-text":t.$t("cancel"),description:k.creatorAddress,"close-on-click-action":"",onSelect:oe},null,8,["show","actions","cancel-text","description"]),r(ce,{class:"create-success-dialog",show:F.value,"onUpdate:show":o[8]||(o[8]=e=>F.value=e),"close-on-click-overlay":""},{footer:a(()=>[n("div",Be,[r(ie,{class:"copy-btn",type:"primary",onClick:o[7]||(o[7]=e=>d(M)(k.redPacketUrl))},{default:a(()=>[g(l(t.$t("copyLink")),1)]),_:1})])]),default:a(()=>[n("div",Ye,[n("div",De,[r(u,{name:"createSuccess"})]),n("div",Me,l(t.$t("shareLink")),1)])]),_:1},8,["show"])]),_:1},8,["active"])}}},qe=de(Ee,[["__scopeId","data-v-3b5c0115"]]);export{qe as default};
