import{T as B}from"./TokenIcon.e218f518.js";import{d as I,_ as V}from"./dayjs.min.42dc7e94.js";import{_ as Z,k as q,j as J,l as K,n as u,q as W,S as Q,s as X,Q as ee,U as te,r as P,o as i,b as d,a,u as s,P as R,t as o,d as n,c as D,g as m,e as $,F as se,v as ae,w as oe,V as ie,G as A,W as de,T as g,x as ce,M as N,X as le,f as ne,J as ve,K as re}from"./index.40bf1fc0.js";import{u as ue}from"./redPacketStore.8ac49ee6.js";const fe=k=>(ve("data-v-f0dc503c"),k=k(),re(),k),ye={class:"body"},pe={class:"top"},_e=ie('<div class="background" data-v-f0dc503c><div style="--i:1;" data-v-f0dc503c></div><div style="--i:2;" data-v-f0dc503c></div><div style="--i:3;" data-v-f0dc503c></div><div style="--i:4;" data-v-f0dc503c></div><div style="--i:5;" data-v-f0dc503c></div><div style="--i:6;" data-v-f0dc503c></div><div style="--i:7;" data-v-f0dc503c></div><div style="--i:8;" data-v-f0dc503c></div><div style="--i:9;" data-v-f0dc503c></div><div style="--i:10;" data-v-f0dc503c></div><div style="--i:11;" data-v-f0dc503c></div><div style="--i:12;" data-v-f0dc503c></div><div style="--i:13;" data-v-f0dc503c></div><div style="--i:14;" data-v-f0dc503c></div><div style="--i:15;" data-v-f0dc503c></div><div style="--i:16;" data-v-f0dc503c></div><div style="--i:17;" data-v-f0dc503c></div><div style="--i:18;" data-v-f0dc503c></div><div style="--i:19;" data-v-f0dc503c></div><div style="--i:20;" data-v-f0dc503c></div><div style="--i:21;" data-v-f0dc503c></div><div style="--i:22;" data-v-f0dc503c></div><div style="--i:23;" data-v-f0dc503c></div><div style="--i:24;" data-v-f0dc503c></div><div style="--i:25;" data-v-f0dc503c></div><div style="--i:26;" data-v-f0dc503c></div><div style="--i:27;" data-v-f0dc503c></div><div style="--i:28;" data-v-f0dc503c></div><div style="--i:29;" data-v-f0dc503c></div><div style="--i:30;" data-v-f0dc503c></div><div style="--i:31;" data-v-f0dc503c></div><div style="--i:32;" data-v-f0dc503c></div><div style="--i:33;" data-v-f0dc503c></div><div style="--i:34;" data-v-f0dc503c></div><div style="--i:35;" data-v-f0dc503c></div><div style="--i:36;" data-v-f0dc503c></div></div>',1),he={key:0,class:"info-box"},me={key:0,class:"fold-operate-fixed"},ke=fe(()=>a("span",{class:"dot"},"...",-1)),ge={class:"fold-text"},we={class:"red-packet"},Ce={class:"circle-big"},be={class:"circle-small"},Ie={key:0,class:"card"},Pe={class:"from"},Re={class:"amount"},$e={class:"congratulation"},Ae={class:"text"},Se={key:0,class:"logo"},He={key:1},Le={class:"text-top"},Te={class:"from"},xe={class:"congratulation"},Me={key:0,class:"front-cover"},Be={class:"packer-btn packer-btn-behind",style:{transform:"translateZ(-4px)"}},Ve={class:"packer-btn packer-btn-front"},We={class:"text-middle"},De={key:0},Ne={key:1},Ye={class:"text-bottom"},ze={key:0,class:"award-time"},Ee={key:1,class:"award-time"},Fe={class:"bottom"},Oe={class:"logo"},je={__name:"ReceiveRedPacket",setup(k){const e=ue(),r=q(),S=J(),{t:f}=K(),H=u(!1),y=u(!0),p=u(null),_=u(null),h=u(!1),c=u(0),w=u("--"),C=u(0),v=W(()=>C.value?e.startTime-C.value:0);Q(()=>e.title,async(t,l)=>{L()});async function L(){if(!e.title)return;await A();let t=_.value.scrollHeight,l=_.value.offsetHeight;console.log(_.value.scrollHeight),console.log(_.value.offsetHeight),t>l&&(H.value=!0),document.body.style.setProperty("--top-height",p.value.scrollHeight-10+"px"),window.onresize=()=>(console.log("\u9AD8\u5EA6"),(()=>{document.body.style.setProperty("--top-height",p.value.scrollHeight-10+"px")})())}async function Y(){y.value=!1,await A(),document.body.style.setProperty("--top-height",p.value.scrollHeight-10+"px")}async function z(){y.value=!0,await A(),document.body.style.setProperty("--top-height",p.value.scrollHeight-10+"px")}async function E(){de([e.coverImage])}async function F(){console.log("openClick");let t;if(r.walletAddress?t=g.loading():t=g.fail(f("connectWalletWarn")),!h.value){h.value=!0;try{await O()}catch(l){console.log(l)}finally{t.clear(),h.value=!1}}}async function O(){if(!r.isConnectWallet){if(await r.connectWallet(),!r.isConnectWallet)return;await e.getRedPacketDetail(e.uuid,r.walletAddress)}if(e.isReceived){const t=e.receiveList.find(l=>l.userAddress==r.walletAddress);w.value=t.amount,c.value=1;return}if(e.whiteList.length>0&&!e.whiteList.includes(r.walletAddress)){g({message:f("exclusiveRedPacket"),position:"top"});return}if(console.log(e.status),e.status==3||e.status==2){if(e.status==2&&v.value>0){let t="";v.value<60?t=f("unlockSecondsPlease",{seconds:v.value}):t=f("unlockHoursPlease",{hours:Math.floor(v.value/3600),minutes:Math.floor((v.value-Math.floor(v.value/3600)*3600)/60)}),g({message:t,position:"top"});return}try{const t=await ce.redPacket.receive(r.walletAddress,e.uuid);console.log(t),t.status==1&&t.data.status==3&&(e.isReceived=!0,w.value=t.data.receiveResult.amount,c.value=1,e.receiveList.push({transferTime:I().unix(),amount:t.data.receiveResult.amount,userAddress:t.data.receiveResult.userAddress}))}catch(t){console.log(t),c.value=2}}else e.count==e.receiveList.length?c.value=2:c.value=3}const T=W(()=>e.creatorAddress?e.creatorAddress.substr(-4).toLowerCase():"--");let b=null;return X(()=>{const l=ee().params.uuid;e.uuid=l,e.getRedPacketDetail(),b=setInterval(()=>{C.value=I().unix()},1e3),L()}),te(()=>{b&&clearInterval(b)}),(t,l)=>{const j=P("van-image"),G=P("van-icon"),U=P("van-button");return i(),d("div",ye,[a("div",pe,[_e,a("div",{class:"content",ref_key:"content",ref:p},[s(e).title?(i(),d("div",he,[a("div",{class:R(["info",{fold:y.value}]),ref_key:"info",ref:_},[H.value&&y.value?(i(),d("div",me,[ke,a("span",{class:"fold-operate",onClick:Y},o(t.$t("expand")),1)])):n("",!0),a("span",ge,o(s(e).title),1),y.value?n("",!0):(i(),d("span",{key:1,class:"fold-operate",onClick:z},o(t.$t("putAway")),1))],2)])):n("",!0),a("div",we,[a("div",Ce,[a("div",be,[c.value==1?(i(),d("div",Ie,[a("div",Pe,[s(e).contractChain?(i(),D(B,{key:0,class:"token-icon",tokenIcon:s(N)(s(e).contractChain.toLowerCase(),s(e).contractAddress.toLowerCase())},null,8,["tokenIcon"])):n("",!0),a("span",null,o(t.$t("redPacketBelong",{user:s(T)})),1)]),a("div",Re,o(w.value+" "+s(e).symbol),1),a("div",$e,o(s(e).remark),1)])):n("",!0)])]),a("div",Ae,[c.value!=1?(i(),d("div",Se,[m(V,{class:"icon",name:"logo"})])):n("",!0),c.value!=1?(i(),d("div",He,[a("div",Le,[a("div",Te,[s(e).contractChain?(i(),D(B,{key:0,class:"token-icon",tokenIcon:s(N)(s(e).contractChain.toLowerCase(),s(e).contractAddress.toLowerCase())},null,8,["tokenIcon"])):n("",!0),$(o()+" ",1),a("span",null,"*"+o(t.$t("redPacketBelong",{user:s(T)})),1)]),a("div",xe,o(s(e).remark),1)]),c.value==0&&s(e).coverImage?(i(),d("div",Me,[m(j,{class:"img",fit:"contain",src:s(e).coverImage,onClick:E},null,8,["src"])])):n("",!0),c.value==0&&!h.value?(i(),d("div",{key:1,class:R(["open",s(r).language=="en"?"open-en":""]),onClick:F},o(t.$t("open")),3)):c.value==0&&h.value?(i(),d("div",{key:2,class:R(["anim-rotate packer-btn-pos",s(r).language=="en"?"open-en":""])},[a("div",Be,o(t.$t("open")),1),(i(),d(se,null,ae(7,(x,M)=>a("div",{class:"packer-btn-middle",key:M,style:le({transform:`translateZ(${M-3}px)`})},null,4)),64)),a("div",Ve,o(t.$t("open")),1)],2)):n("",!0),a("div",We,[c.value==2?(i(),d("div",De,[a("div",null,o(t.$t("handSlow")),1),a("div",null,o(t.$t("redPackIsGone")),1)])):n("",!0),c.value==3?(i(),d("div",Ne,[a("div",null,o(t.$t("handSlow")),1),a("div",null,o(t.$t("redPackIsExpired")),1)])):n("",!0)])])):n("",!0),a("div",Ye,[c.value==1?(i(),d("div",ze,o(t.$t("distributeTime",{date:s(I).unix(s(e).sendTime+s(e).endTime).format("YYYY-MM-DD HH:mm"),address:s(ne)(s(r).walletAddress)})),1)):s(e).status==2&&s(v)>0?(i(),d("div",Ee,o(s(v)<60?s(f)("unlockSeconds",{seconds:s(v)}):s(f)("unlockHours",{hours:Math.floor(s(v)/3600),minutes:Math.floor((s(v)-Math.floor(s(v)/3600)*3600)/60)})),1)):n("",!0),a("div",{class:"show-luck",onClick:l[0]||(l[0]=x=>s(S).push(`/redpacket/${s(e).uuid}/showLuck`))},[$(o(t.$t("seeLuckEveryone"))+" ",1),m(G,{name:"arrow"})])])])])],512)]),a("div",Fe,[m(U,{class:"send-red-packet",onClick:l[1]||(l[1]=x=>s(S).push("/"))},{default:oe(()=>[$(o(t.$t("giveOutRedPacket")),1)]),_:1}),a("div",Oe,[m(V,{class:"icon",name:"logo"})])])])}}},Je=Z(je,[["__scopeId","data-v-f0dc503c"]]);export{Je as default};
