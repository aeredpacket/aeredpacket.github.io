import{T as W}from"./TokenIcon.0a09a583.js";import{d as P,_ as D}from"./dayjs.min.c216f496.js";import{_ as X,k as q,p as J,j as Q,l as u,v as N,U as ee,x as te,R as se,V as ae,r as R,o as i,b as c,a as e,u as a,n as L,t as o,d as l,c as Y,g as m,e as A,F as oe,m as ie,w as ce,W as de,H as S,X as ne,T as w,y as le,O,Y as ve,f as re,K as ue,L as fe}from"./index.037e7445.js";import{u as _e}from"./redPacketStore.c09b9662.js";const C=p=>(ue("data-v-40fa1cc4"),p=p(),fe(),p),he={class:"body"},ye={class:"top"},me=de('<div class="background" data-v-40fa1cc4><div style="--i:1;" data-v-40fa1cc4></div><div style="--i:2;" data-v-40fa1cc4></div><div style="--i:3;" data-v-40fa1cc4></div><div style="--i:4;" data-v-40fa1cc4></div><div style="--i:5;" data-v-40fa1cc4></div><div style="--i:6;" data-v-40fa1cc4></div><div style="--i:7;" data-v-40fa1cc4></div><div style="--i:8;" data-v-40fa1cc4></div><div style="--i:9;" data-v-40fa1cc4></div><div style="--i:10;" data-v-40fa1cc4></div><div style="--i:11;" data-v-40fa1cc4></div><div style="--i:12;" data-v-40fa1cc4></div><div style="--i:13;" data-v-40fa1cc4></div><div style="--i:14;" data-v-40fa1cc4></div><div style="--i:15;" data-v-40fa1cc4></div><div style="--i:16;" data-v-40fa1cc4></div><div style="--i:17;" data-v-40fa1cc4></div><div style="--i:18;" data-v-40fa1cc4></div><div style="--i:19;" data-v-40fa1cc4></div><div style="--i:20;" data-v-40fa1cc4></div><div style="--i:21;" data-v-40fa1cc4></div><div style="--i:22;" data-v-40fa1cc4></div><div style="--i:23;" data-v-40fa1cc4></div><div style="--i:24;" data-v-40fa1cc4></div><div style="--i:25;" data-v-40fa1cc4></div><div style="--i:26;" data-v-40fa1cc4></div><div style="--i:27;" data-v-40fa1cc4></div><div style="--i:28;" data-v-40fa1cc4></div><div style="--i:29;" data-v-40fa1cc4></div><div style="--i:30;" data-v-40fa1cc4></div><div style="--i:31;" data-v-40fa1cc4></div><div style="--i:32;" data-v-40fa1cc4></div><div style="--i:33;" data-v-40fa1cc4></div><div style="--i:34;" data-v-40fa1cc4></div><div style="--i:35;" data-v-40fa1cc4></div><div style="--i:36;" data-v-40fa1cc4></div></div>',1),pe={key:0,class:"info-box"},ke={key:0,class:"fold-operate-fixed"},ge=C(()=>e("span",{class:"dot"},"...",-1)),we={class:"fold-text"},Ce={class:"red-packet"},be={class:"circle-big"},$e={class:"circle-small"},Ie={key:0,class:"card"},Pe={class:"from"},Re={class:"amount"},Le={class:"congratulation"},Ae={class:"text"},Se={key:0,class:"logo"},He={key:1},Te={class:"text-top"},Me={class:"from"},xe={class:"congratulation"},Be={key:0,class:"count-down"},Ve={class:"clock-text"},We={class:"clock"},De={class:"time"},Ne={class:"number"},Ye={class:"unit"},Oe=C(()=>e("div",{class:"split"},":",-1)),ze={class:"time"},Ee={class:"number"},Fe={class:"unit"},je=C(()=>e("div",{class:"split"},":",-1)),Ue={class:"time"},Ze={class:"number"},Ge={class:"unit"},Ke=C(()=>e("div",{class:"split"},":",-1)),Xe={class:"time"},qe={class:"number"},Je={class:"unit"},Qe={key:1,class:"front-cover"},et={class:"packer-btn packer-btn-behind",style:{transform:"translateZ(-4px)"}},tt={class:"packer-btn packer-btn-front"},st={class:"text-middle"},at={key:0},ot={key:1},it={class:"text-bottom"},ct={key:0,class:"award-time"},dt={key:1,class:"award-time"},nt={class:"bottom"},lt={class:"logo"},vt={__name:"ReceiveRedPacket",setup(p){const s=_e(),r=q(),H=J(),{t:k}=Q(),T=u(!1),f=u(!0),_=u(null),h=u(null),y=u(!1),d=u(0),b=u("--"),$=u(0),v=N(()=>$.value?s.startTime-$.value:0);ee(()=>s.title,async(t,n)=>{M()});async function M(){if(!s.title)return;await S();let t=h.value.scrollHeight,n=h.value.offsetHeight;console.log(h.value.scrollHeight),console.log(h.value.offsetHeight),t>n&&(T.value=!0),document.body.style.setProperty("--top-height",_.value.scrollHeight-10+"px"),window.onresize=()=>(console.log("\u9AD8\u5EA6"),(()=>{document.body.style.setProperty("--top-height",_.value.scrollHeight-10+"px")})())}async function z(){f.value=!1,await S(),document.body.style.setProperty("--top-height",_.value.scrollHeight-10+"px")}async function E(){f.value=!0,await S(),document.body.style.setProperty("--top-height",_.value.scrollHeight-10+"px")}async function F(){ne([s.coverImage])}async function j(){console.log("openClick");let t;if(r.walletAddress?t=w.loading():t=w.fail(k("connectWalletWarn")),!y.value){y.value=!0;try{await U()}catch(n){console.log(n)}finally{t.clear(),y.value=!1}}}async function U(){if(!r.isConnectWallet){if(await r.connectWallet(),!r.isConnectWallet)return;await s.getRedPacketDetail(s.uuid,r.walletAddress)}if(s.isReceived){const t=s.receiveList.find(n=>n.userAddress.toLowerCase()==r.walletAddress.toLowerCase());b.value=t.amount,d.value=1;return}if(s.whiteList.length>0&&!s.whiteList.includes(r.walletAddress.toLowerCase())){w({message:k("exclusiveRedPacket"),position:"top"});return}if(console.log(s.status),s.status==3||s.status==2){if(s.status==2&&v.value>0){let t="";v.value<60?t=k("unlockSecondsPlease",{seconds:v.value}):t=k("unlockHoursPlease",{hours:Math.floor(v.value/3600),minutes:Math.floor((v.value-Math.floor(v.value/3600)*3600)/60)}),w({message:t,position:"top"});return}try{const t=await le.redPacket.receive(r.walletAddress,s.uuid);console.log(t),t.status==1&&t.data.status==3&&(s.isReceived=!0,b.value=t.data.receiveResult.amount,d.value=1,s.receiveList.push({transferTime:P().unix(),amount:t.data.receiveResult.amount,userAddress:t.data.receiveResult.userAddress}))}catch(t){console.log(t),d.value=2}}else s.count==s.receiveList.length?d.value=2:d.value=3}const x=N(()=>s.creatorAddress?s.creatorAddress.substr(-4).toLowerCase():"--");let I=null;function g(t){return t<10?"0"+t.toString():t.toString()}return te(()=>{const n=se().params.uuid;s.uuid=n,s.getRedPacketDetail(),I=setInterval(()=>{$.value=P().unix()},1e3),M()}),ae(()=>{I&&clearInterval(I)}),(t,n)=>{const Z=R("van-image"),G=R("van-icon"),K=R("van-button");return i(),c("div",he,[e("div",ye,[me,e("div",{class:"content",ref_key:"content",ref:_},[a(s).title?(i(),c("div",pe,[e("div",{class:L(["info",{fold:f.value}]),ref_key:"info",ref:h},[T.value&&f.value?(i(),c("div",ke,[ge,e("span",{class:"fold-operate",onClick:z},o(t.$t("expand")),1)])):l("",!0),e("span",we,o(a(s).title),1),f.value?l("",!0):(i(),c("span",{key:1,class:"fold-operate",onClick:E},o(t.$t("putAway")),1))],2)])):l("",!0),e("div",Ce,[e("div",be,[e("div",$e,[d.value==1?(i(),c("div",Ie,[e("div",Pe,[a(s).contractChain?(i(),Y(W,{key:0,class:"token-icon",tokenIcon:a(O)(a(s).contractChain.toLowerCase(),a(s).contractAddress.toLowerCase())},null,8,["tokenIcon"])):l("",!0),e("span",null,o(t.$t("redPacketBelong",{user:a(x)})),1)]),e("div",Re,o(b.value+" "+a(s).symbol),1),e("div",Le,o(a(s).remark),1)])):l("",!0)])]),e("div",Ae,[d.value!=1?(i(),c("div",Se,[m(D,{class:"icon",name:"logo"})])):l("",!0),d.value!=1?(i(),c("div",He,[e("div",Te,[e("div",Me,[a(s).contractChain?(i(),Y(W,{key:0,class:"token-icon",tokenIcon:a(O)(a(s).contractChain.toLowerCase(),a(s).contractAddress.toLowerCase())},null,8,["tokenIcon"])):l("",!0),A(o()+" ",1),e("span",null,"*"+o(t.$t("redPacketBelong",{user:a(x)})),1)]),e("div",xe,o(a(s).remark),1)]),d.value!=1&&a(s).status==2&&a(v)>0?(i(),c("div",Be,[e("div",Ve,o(t.$t("countdown")),1),e("div",We,[e("div",De,[e("div",Ne,o(g(Math.floor(a(v)/86400))),1),e("div",Ye,o(t.$t("day")),1)]),Oe,e("div",ze,[e("div",Ee,o(g(Math.floor(a(v)%86400/3600))),1),e("div",Fe,o(t.$t("hour")),1)]),je,e("div",Ue,[e("div",Ze,o(g(Math.floor(a(v)%3600/60))),1),e("div",Ge,o(t.$t("minute")),1)]),Ke,e("div",Xe,[e("div",qe,o(g(a(v)%60)),1),e("div",Je,o(t.$t("second")),1)])])])):d.value==0&&a(s).coverImage?(i(),c("div",Qe,[m(Z,{class:"img",fit:"contain",src:a(s).coverImage,onClick:F},null,8,["src"])])):l("",!0),d.value==0&&!y.value?(i(),c("div",{key:2,class:L(["open",a(r).language=="en"?"open-en":""]),onClick:j},o(t.$t("open")),3)):d.value==0&&y.value?(i(),c("div",{key:3,class:L(["anim-rotate packer-btn-pos",a(r).language=="en"?"open-en":""])},[e("div",et,o(t.$t("open")),1),(i(),c(oe,null,ie(7,(B,V)=>e("div",{class:"packer-btn-middle",key:V,style:ve({transform:`translateZ(${V-3}px)`})},null,4)),64)),e("div",tt,o(t.$t("open")),1)],2)):l("",!0),e("div",st,[d.value==2?(i(),c("div",at,[e("div",null,o(t.$t("handSlow")),1),e("div",null,o(t.$t("redPackIsGone")),1)])):l("",!0),d.value==3?(i(),c("div",ot,[e("div",null,o(t.$t("handSlow")),1),e("div",null,o(t.$t("redPackIsExpired")),1)])):l("",!0)])])):l("",!0),e("div",it,[d.value==1?(i(),c("div",ct,o(t.$t("distributeTime",{date:a(P).unix(a(s).sendTime+a(s).endTime).format("YYYY-MM-DD HH:mm"),address:a(re)(a(r).walletAddress)})),1)):a(s).status==2&&a(v)>0?(i(),c("div",dt)):l("",!0),e("div",{class:"show-luck",onClick:n[0]||(n[0]=B=>a(H).push(`/redpacket/${a(s).uuid}/showLuck`))},[A(o(t.$t("seeLuckEveryone"))+" ",1),m(G,{name:"arrow"})])])])])],512)]),e("div",nt,[m(K,{class:"send-red-packet",onClick:n[1]||(n[1]=B=>a(H).push("/"))},{default:ce(()=>[A(o(t.$t("giveOutRedPacket")),1)]),_:1}),e("div",lt,[m(D,{class:"icon",name:"logo"})])])])}}},ht=X(vt,[["__scopeId","data-v-40fa1cc4"]]);export{ht as default};
