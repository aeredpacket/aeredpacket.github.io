import{r as f,o as d,c as _,w as i,a as o,t as l,b as k,d as M,F as ne,e as y,u,f as de,g as n,h as ce,i as re,j as Le,k as Ie,l as Te,m as De,n as r,p as W,q as Pe,s as j,v as q,T as V,B as ae,x as Ne,y as ue,z as Be,A as Ue,C as ze}from"./index.049785be.js";import{_ as S}from"./SvgIcon.21ada9f9.js";import{_ as ve}from"./plugin-vueexport-helper.2444895f.js";const He={class:"title"},Fe={class:"body"},Ee={class:"status-text"},Re={key:0},xe={key:1},We={key:2},je={key:3},qe={class:"status-icon"},Me={class:"tx"},Qe={key:1,class:"trade-hash"},Ge={__name:"ChainTrade",props:{tradeVisable:{type:Boolean,default:!1},status:{type:Number,default:0},tradeHash:{type:String,default:""}},emits:["update:tradeVisable"],setup(v,{emit:Q}){return(a,c)=>{const D=f("van-loading"),P=f("van-icon"),z=f("van-popup");return d(),_(z,{class:"dialog",show:v.tradeVisable,"onUpdate:show":c[1]||(c[1]=C=>re(tradeVisable)?tradeVisable.value=C:null),round:"","close-on-click-overlay":!1},{default:i(()=>[o("div",He,l(a.$t("transactionDetails")),1),o("div",Fe,[o("div",Ee,[v.status!=0?(d(),k(ne,{key:0},[v.status==1?(d(),k("div",Re,l(a.$t("sendingTransactionToBlockchain")),1)):v.status==2?(d(),k("div",xe,l(a.$t("waitingForServiceSyncronizing")),1)):v.status==-1?(d(),k("div",We,l(a.$t("sendTransactionToBlockchainFailed")),1)):v.status==-2?(d(),k("div",je,l(a.$t("servicesyncronizingTimeout")),1)):M("",!0)],64)):M("",!0)]),o("div",qe,[v.status==1||v.status==2?(d(),_(D,{key:0,type:"spinner",size:"48px"})):v.status==0?(d(),_(P,{key:1,color:"#07c160",size:"40px",name:"checked"})):v.status==-1||v.status==-2?(d(),_(P,{key:2,color:"#FA5151",size:"40px",name:"clear"})):M("",!0)]),v.tradeHash?(d(),k("div",{key:0,class:"trade-hash",onClick:c[0]||(c[0]=C=>u(ce)(v.tradeHash))},[y(l(a.$t("txHash"))+": ",1),o("span",Me,l(u(de)(v.tradeHash)),1),n(S,{name:"copy"})])):(d(),k("div",Qe,l(a.$t("txHash"))+": N/A",1))])]),_:1},8,["show"])}}},Je=ve(Ge,[["__scopeId","data-v-1c06e15b"]]);const Ke=v=>(Ue("data-v-9389c19f"),v=v(),ze(),v),Oe={class:"body"},Xe={class:"tools-bar"},Ye={key:0,class:"address"},Ze={class:"address-text"},et={style:{"margin-left":"4px"}},tt={class:"tools"},at={key:2,class:"amount"},nt={style:{"margin-left":"4px"}},lt=Ke(()=>o("svg",{class:"icon","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-redPacket"})],-1)),ot={key:0},st={key:1,class:"image-box"},it={class:"form-item total-amount"},ut={class:"form-item create"},dt={class:"content"},ct={class:"content"},rt={class:"success-icon"},vt={class:"title"},mt={class:"text"},ft={class:"btn"},pt={class:"content"},ht={__name:"Index",setup(v){const Q=Le(),a=Ie(),{t:c}=Te(),D=De("global"),P=r(!1),z=r(!1),C=r(!1),L=r(0),N=r(""),B=r(""),I=r("");r("");const G=r(""),J=r(""),le=r(null),H=r("");console.log(a.chainId);const me=W(()=>L.value==0?N.value?N.value:"0.00":B.value&&I.value?ae(Number(B.value)).multipliedBy(Number(I.value)).toNumber().toString():"0.00"),w=r(!1),b=r(0),U=r(""),K=r(!1),E=r(!1),O=r(""),X=r(!1),fe=W(()=>[{name:c("languages.zh-cn"),value:"zh-cn",color:a.language==="zh-cn"?"#9505F9":"#323233"},{name:c("languages.en"),value:"en",color:a.language==="en"?"#9505F9":"#323233"}]);function pe(e){a.setLanguage(e.value)}const F=r(!1),he=W(()=>[{text:c("deadlineList.300"),value:300},{text:c("deadlineList.600"),value:600},{text:c("deadlineList.1800"),value:1800},{text:c("deadlineList.3600"),value:3600},{text:c("deadlineList.43200"),value:43200},{text:c("deadlineList.86400"),value:86400}]),R=r(300),Y=W(()=>c("deadlineList."+R.value));function ke(e){R.value=e.value,F.value=!1}function ge(e,t){console.log(e),ye(e)}function ye(e,t){let g=new FileReader;g.readAsDataURL(e),g.onloadend=function(h){let m=h.target.result,$=new Image;$.src=m,$.onload=function(){let p=Be($,e.name,e.type);console.log(p),J.value=p.base64Data,le.value=p.fileData}}}async function oe(){await a.connectWallet()}function _e(){return D.cfg.allowChainList.map(t=>t.chainId).includes(a.chainId)?!0:(X.value=!0,!1)}async function we(){w.value=!1,U.value="",b.value=1,w.value=!0;try{let e=await j.wallet.approveMaxAmount(a.token.address,a.redPacketContractAddress);console.log(e),C.value=!1,U.value=e.hash,b.value=0}catch{b.value=-1,await q(2e3)}finally{w.value=!1}}async function be(){await j.wallet.isAllowanceEnough(a.redPacketContractAddress,a.token.address,a.walletAddress)?C.value=!1:C.value=!0}async function $e(){K.value=!0,await Ce(),K.value=!1}async function Ce(){if(console.log("createRedPacket"),w.value=!1,U.value="",E.value=!1,O.value="",!a.token){V.fail(c("pleaseSelectToken"));return}if(L.value==0){if(!N.value){V.fail(c("pleaseEnterTotalAmount"));return}}else if(!B.value){V.fail(c("pleaseEnterSingleAmount"));return}if(!I.value){V.fail(c("pleaseEnterQuantity"));return}let e;if(L.value==0?e=ae(Number(N.value)).toNumber():e=ae(Number(B.value)).multipliedBy(Number(I.value)).toNumber(),H.value||(H.value=c("bestWishes")),await a.connectWallet(),!_e())return;let g=D.cfg.allowChainList.find(m=>m.chain==a.token.chain);if(!g){V.fail(c("tokenChainNotSupport"));return}if(a.chainId!=g.chainId){V.fail(c("switchTokenChain"));return}if(e>a.token.amount){V.fail(c("blanceSlow"));return}if(await be(),C.value){V.fail(c("approveFirst"));return}b.value=1,w.value=!0;let h;try{let m=await j.wallet.sendRedPacket(a.redPacketContractAddress,a.token.address,L.value,e.toString(),I.value,R.value);console.dir(m),U.value=m.hash,h=await m.wait(),console.dir(h),U.value=h.transactionHash}catch(m){console.log(m),b.value=-1,await q(1e3),w.value=!1;return}b.value=2;try{let m=h==null?void 0:h.events,$={};for(let T=m.length-1;T>=0;T--){let Z=m[T].topics.some(ee=>ee==="0x694af1cc8727cdd0afbdd53d9b87b69248bd490224e9dd090e788546506e076f");if(m[T].address==a.redPacketContractAddress&&Z){$=m[T];break}}let p=await j.redPacket.send(a.token.address,a.token.chain,$.topics[1],h.transactionHash,R.value,le.value,H.value,a.token.symbol,G.value);console.dir(p),b.value=0,await q(500),w.value=!1;const A=p.data.uuid;E.value=!0,O.value=window.location.origin+"/#/redpacket/"+A}catch(m){console.log(m),b.value=-1,await q(1e3),w.value=!1}}const se=D.cfg.allowChainList.map(e=>e.chainShow);function ie(e){const t=D.cfg.allowChainList.find(h=>h.chainId==e);let g;return t?g=t.chain:g=null,g}function Ae(){Q.push("/selectToken")}return Pe(()=>{console.log("onMounted")}),(e,t)=>{const g=f("van-icon"),h=f("van-radio"),m=f("van-radio-group"),$=f("van-cell"),p=f("van-cell-group"),A=f("van-field"),T=f("van-picker"),Z=f("van-popup"),ee=f("van-image"),Ve=f("van-uploader"),x=f("van-button"),te=f("van-dialog"),Se=f("van-action-sheet");return d(),k(ne,null,[o("div",Oe,[o("div",Xe,[u(a).isConnectWallet?(d(),k("div",Ye,[ie(u(a).chainId)?(d(),_(g,{key:0,class:"chain-icon",name:u(Ne)(ie(u(a).chainId))},null,8,["name"])):(d(),_(S,{key:1,class:"chain-icon",name:"wallet"})),o("div",Ze,l(u(de)(u(a).walletAddress)),1)])):(d(),k("div",{key:1,class:"address",onClick:oe},[n(S,{name:"wallet"}),o("div",et,l(e.$t("pleaseConnectWallet")),1)])),o("div",tt,[n(S,{name:"language",onClick:t[0]||(t[0]=s=>z.value=!0)}),n(S,{name:"help",onClick:t[1]||(t[1]=s=>P.value=!0)})])]),n(m,{modelValue:L.value,"onUpdate:modelValue":t[2]||(t[2]=s=>L.value=s),direction:"horizontal",class:"type form-item"},{default:i(()=>[n(h,{name:0,"checked-color":"#ED4A4A","icon-size":"16px"},{default:i(()=>[y(l(e.$t("randomAmount")),1)]),_:1}),n(h,{name:1,"checked-color":"#ED4A4A","icon-size":"16px"},{default:i(()=>[y(l(e.$t("identicalAmount")),1)]),_:1})]),_:1},8,["modelValue"]),n(p,{inset:"",class:"form-item form-normal"},{default:i(()=>[n($,{title:e.$t("token"),"is-link":"",onClick:Ae},ue({_:2},[u(a).token?{name:"value",fn:i(()=>[o("div",null,[n(g,{name:u(a).token.icon},null,8,["name"]),y(" "+l(u(a).token.symbol),1)])]),key:"0"}:void 0]),1032,["title"])]),_:1}),L.value==0?(d(),_(p,{key:0,inset:"",class:"form-item form-normal"},{default:i(()=>[n(A,{label:e.$t("totalAmount"),"input-align":"right",placeholder:e.$t("enterAmount"),type:"number",modelValue:N.value,"onUpdate:modelValue":t[3]||(t[3]=s=>N.value=s)},{"left-icon":i(()=>[n(S,{name:"pin"})]),_:1},8,["label","placeholder","modelValue"])]),_:1})):(d(),_(p,{key:1,inset:"",class:"form-item form-normal"},{default:i(()=>[n(A,{label:e.$t("singleAmount"),"input-align":"right",placeholder:e.$t("enterAmount"),type:"number",modelValue:B.value,"onUpdate:modelValue":t[4]||(t[4]=s=>B.value=s)},{"left-icon":i(()=>[n(S,{name:"pu"})]),_:1},8,["label","placeholder","modelValue"])]),_:1})),u(a).token?(d(),k("div",at,[y(l(e.$t("availableBalance")),1),o("span",nt,l(u(a).token.amount+" "+u(a).token.symbol),1)])):M("",!0),n(p,{inset:"",class:"form-item form-normal"},{default:i(()=>[n(A,{label:e.$t("quantity"),"input-align":"right",placeholder:e.$t("enterNumber"),type:"digit",modelValue:I.value,"onUpdate:modelValue":t[5]||(t[5]=s=>I.value=s)},ue({"left-icon":i(()=>[lt]),_:2},[u(a).language=="zh-cn"?{name:"right-icon",fn:i(()=>[y("\u4E2A")]),key:"0"}:void 0]),1032,["label","placeholder","modelValue"])]),_:1}),n(p,{inset:"",class:"form-item form-normal"},{default:i(()=>[n(A,{modelValue:u(Y),"onUpdate:modelValue":t[6]||(t[6]=s=>re(Y)?Y.value=s:null),"is-link":"",readonly:"",name:"picker",label:e.$t("deadline"),onClick:t[7]||(t[7]=s=>F.value=!0),"input-align":"right"},null,8,["modelValue","label"]),n(Z,{show:F.value,"onUpdate:show":t[9]||(t[9]=s=>F.value=s),position:"bottom"},{default:i(()=>[n(T,{columns:u(he),onCancel:t[8]||(t[8]=s=>F.value=!1),onConfirm:ke,title:e.$t("settingDeadline"),"confirm-button-text":e.$t("confirm"),"cancel-button-text":e.$t("cancel")},null,8,["columns","title","confirm-button-text","cancel-button-text"])]),_:1},8,["show"])]),_:1}),n(p,{inset:"",class:"form-item form-normal"},{default:i(()=>[n(Ve,{class:"uploader-box","before-read":ge,"max-size":1024*1024,"preview-image":!1,accept:"image/*"},{default:i(()=>[n($,{class:"uploader-content","is-link":"",title:e.$t("redPacketCover")},{value:i(()=>[J.value?(d(),k("div",st,[n(ee,{class:"image",fit:"contain",src:J.value},null,8,["src"])])):(d(),k("div",ot,l(e.$t("selectPicture")),1))]),_:1},8,["title"])]),_:1})]),_:1}),n(p,{inset:"",class:"form-item"},{default:i(()=>[n(A,{modelValue:H.value,"onUpdate:modelValue":t[10]||(t[10]=s=>H.value=s),rows:"1",autosize:"",type:"textarea",maxlength:"20",placeholder:e.$t("bestWishes"),"show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1}),n(p,{inset:"",class:"form-item"},{default:i(()=>[n(A,{modelValue:G.value,"onUpdate:modelValue":t[11]||(t[11]=s=>G.value=s),rows:"2",autosize:"",type:"textarea",maxlength:"500",placeholder:e.$t("ActivityDescription")},null,8,["modelValue","placeholder"])]),_:1}),o("div",it,[y(l(e.$t("redPacketTotalAmount")),1),o("span",null,l(u(me)),1),y(l(u(a).token?u(a).token.symbol:""),1)]),o("div",ut,[u(a).isConnectWallet?(d(),k(ne,{key:0},[C.value?(d(),_(x,{key:0,class:"create-btn",type:"danger",onClick:we},{default:i(()=>[y(l(e.$t("approve")),1)]),_:1})):(d(),_(x,{key:1,class:"create-btn",type:"danger",onClick:$e,loading:K.value},{default:i(()=>[y(l(e.$t("createRedPacketBtn")),1)]),_:1},8,["loading"]))],64)):(d(),_(x,{key:1,class:"create-btn",type:"primary",onClick:oe},{default:i(()=>[y(l(e.$t("connectWallet")),1)]),_:1}))]),o("div",{class:"form-item history",onClick:t[12]||(t[12]=s=>u(Q).push("/history"))},l(e.$t("redPacketHistory")),1)]),n(te,{class:"help-dialog",show:P.value,"onUpdate:show":t[13]||(t[13]=s=>P.value=s),title:e.$t("rulesDescription"),"confirm-button-text":e.$t("understand"),"close-on-click-overlay":""},{default:i(()=>[o("div",dt,[o("div",null,l(e.$t("rulesDescription1")),1),o("div",null,l(e.$t("rulesDescription2")),1),o("div",null,l(e.$t("rulesDescription3")),1),o("div",null,l(e.$t("rulesDescription4")),1),o("div",null,l(e.$t("rulesDescription5",{chains:u(se).join("/")})),1)])]),_:1},8,["show","title","confirm-button-text"]),n(te,{class:"create-success-dialog",show:E.value,"onUpdate:show":t[15]||(t[15]=s=>E.value=s),"close-on-click-overlay":""},{footer:i(()=>[o("div",ft,[n(x,{class:"copy-btn",type:"primary",onClick:t[14]||(t[14]=s=>u(ce)(O.value))},{default:i(()=>[y(l(e.$t("copyLink")),1)]),_:1})])]),default:i(()=>[o("div",ct,[o("div",rt,[n(S,{name:"createSuccess"})]),o("div",vt,l(e.$t("createRedPacketSuccess")),1),o("div",mt,l(e.$t("shareLink")),1)])]),_:1},8,["show"]),n(Se,{show:z.value,"onUpdate:show":t[16]||(t[16]=s=>z.value=s),title:e.$t("switchLang"),actions:u(fe),closeable:!1,"cancel-text":e.$t("cancel"),"close-on-click-action":"",onSelect:pe},null,8,["show","title","actions","cancel-text"]),n(Je,{tradeVisable:w.value,"onUpdate:tradeVisable":t[17]||(t[17]=s=>w.value=s),status:b.value,tradeHash:U.value},null,8,["tradeVisable","status","tradeHash"]),n(te,{class:"chain-err-dialog",confirmButtonText:e.$t("understand"),confirmButtonColor:"#3F80F7",show:X.value,"onUpdate:show":t[18]||(t[18]=s=>X.value=s)},{default:i(()=>[o("div",pt,[o("div",null,l(e.$t("notSupportedChain")),1),o("div",null,l(e.$t("pleaseSwitchTo",{chains:u(se).join("\u3001")})),1)])]),_:1},8,["confirmButtonText","show"])],64)}}},_t=ve(ht,[["__scopeId","data-v-9389c19f"]]);export{_t as default};
