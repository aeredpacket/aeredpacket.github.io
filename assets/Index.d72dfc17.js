import{_ as de,r as f,o as c,c as w,w as i,a as s,t as l,b as h,d as D,F as le,e as y,u,f as ve,g as n,h as me,i as fe,j as Te,k as De,l as Pe,m as Ne,n as d,p as M,q as Be,s as q,v as Q,T as S,B as ne,x as Ue,y as re,z as ze,A as Fe,C as xe,D as He}from"./index.7b1279d5.js";import{_ as I}from"./SvgIcon.c937bd7f.js";const Ee={class:"title"},Re={class:"body"},We={class:"status-text"},je={key:0},Me={key:1},qe={key:2},Qe={key:3},Ge={class:"status-icon"},Je={class:"tx"},Ke={key:1,class:"trade-hash"},Oe={__name:"ChainTrade",props:{tradeVisable:{type:Boolean,default:!1},status:{type:Number,default:0},tradeHash:{type:String,default:""}},emits:["update:tradeVisable"],setup(v,{emit:G}){return(a,r)=>{const P=f("van-loading"),N=f("van-icon"),F=f("van-popup");return c(),w(F,{class:"dialog",show:v.tradeVisable,"onUpdate:show":r[1]||(r[1]=V=>fe(tradeVisable)?tradeVisable.value=V:null),round:"","close-on-click-overlay":!1},{default:i(()=>[s("div",Ee,l(a.$t("transactionDetails")),1),s("div",Re,[s("div",We,[v.status!=0?(c(),h(le,{key:0},[v.status==1?(c(),h("div",je,l(a.$t("sendingTransactionToBlockchain")),1)):v.status==2?(c(),h("div",Me,l(a.$t("waitingForServiceSyncronizing")),1)):v.status==-1?(c(),h("div",qe,l(a.$t("sendTransactionToBlockchainFailed")),1)):v.status==-2?(c(),h("div",Qe,l(a.$t("servicesyncronizingTimeout")),1)):D("",!0)],64)):D("",!0)]),s("div",Ge,[v.status==1||v.status==2?(c(),w(P,{key:0,type:"spinner",size:"48px"})):v.status==0?(c(),w(N,{key:1,color:"#07c160",size:"40px",name:"checked"})):v.status==-1||v.status==-2?(c(),w(N,{key:2,color:"#FA5151",size:"40px",name:"clear"})):D("",!0)]),v.tradeHash?(c(),h("div",{key:0,class:"trade-hash",onClick:r[0]||(r[0]=V=>u(me)(v.tradeHash))},[y(l(a.$t("txHash"))+": ",1),s("span",Je,l(u(ve)(v.tradeHash)),1),n(I,{name:"copy"})])):(c(),h("div",Ke,l(a.$t("txHash"))+": N/A",1))])]),_:1},8,["show"])}}},Xe=de(Oe,[["__scopeId","data-v-1c06e15b"]]);const Ye=v=>(xe("data-v-533d815c"),v=v(),He(),v),Ze={class:"body"},et={class:"tools-bar"},tt={key:0,class:"address"},at={class:"address-text"},nt={style:{"margin-left":"4px"}},lt={class:"tools"},ot={class:"token-box"},st={key:2,class:"amount"},it={style:{"margin-left":"4px"}},ut=Ye(()=>s("svg",{class:"icon","aria-hidden":"true"},[s("use",{"xlink:href":"#icon-redPacket"})],-1)),ct={key:0,class:"image-box"},rt={key:0},dt={class:"form-item total-amount"},vt={class:"form-item create"},mt={class:"content"},ft={class:"content"},pt={class:"success-icon"},ht={class:"title"},gt={class:"text"},kt={class:"btn"},yt={class:"content"},wt={__name:"Index",setup(v){const G=Te(),a=De(),{t:r}=Pe(),P=Ne("global"),N=d(!1),F=d(!1),V=d(!1),L=d(0),B=d(""),U=d(""),T=d("");d("");const J=d(""),x=d(""),K=d(null),H=d("");console.log(a.chainId);const pe=M(()=>L.value==0?B.value?B.value:"0.00":U.value&&T.value?ne(Number(U.value)).multipliedBy(Number(T.value)).toNumber().toString():"0.00"),_=d(!1),$=d(0),z=d(""),O=d(!1),R=d(!1),X=d(""),Y=d(!1),he=M(()=>[{name:r("languages.zh-cn"),value:"zh-cn",color:a.language==="zh-cn"?"#3F80F7":"#323233"},{name:r("languages.en"),value:"en",color:a.language==="en"?"#3F80F7":"#323233"}]);function ge(e){a.setLanguage(e.value)}const E=d(!1),ke=M(()=>[{text:r("deadlineList.300"),value:300},{text:r("deadlineList.600"),value:600},{text:r("deadlineList.1800"),value:1800},{text:r("deadlineList.3600"),value:3600},{text:r("deadlineList.43200"),value:43200},{text:r("deadlineList.86400"),value:86400}]),W=d(300),Z=M(()=>r("deadlineList."+W.value));function ye(e){W.value=e.value,E.value=!1}function we(e,t){console.log(e),_e(e)}function _e(e,t){let g=new FileReader;g.readAsDataURL(e),g.onloadend=function(p){let m=p.target.result,C=new Image;C.src=m,C.onload=function(){let A=Fe(C,e.name,e.type);console.log(A),x.value=A.base64Data,K.value=A.fileData}}}function be(){console.log(111),x.value="",K.value=null}async function oe(){await a.connectWallet()}function $e(){return P.cfg.allowChainList.map(t=>t.chainId).includes(a.chainId)?!0:(Y.value=!0,!1)}async function Ce(){_.value=!1,z.value="",$.value=1,_.value=!0;try{let e=await q.wallet.approveMaxAmount(a.token.address,a.redPacketContractAddress);console.log(e),z.value=e.hash,await e.wait(),V.value=!1,$.value=0}catch{$.value=-1,await Q(2e3)}finally{_.value=!1}}async function se(){await q.wallet.isAllowanceEnough(a.redPacketContractAddress,a.token.address,a.walletAddress)?V.value=!1:V.value=!0}async function Ae(){O.value=!0,await Ve(),O.value=!1}async function Ve(){if(console.log("createRedPacket"),_.value=!1,z.value="",R.value=!1,X.value="",!a.token){S.fail(r("pleaseSelectToken"));return}if(L.value==0){if(!B.value){S.fail(r("pleaseEnterTotalAmount"));return}}else if(!U.value){S.fail(r("pleaseEnterSingleAmount"));return}if(!T.value){S.fail(r("pleaseEnterQuantity"));return}let e;if(L.value==0?e=ne(Number(B.value)).toNumber():e=ne(Number(U.value)).multipliedBy(Number(T.value)).toNumber(),H.value||(H.value=r("bestWishes")),await a.connectWallet(),!$e())return;let g=P.cfg.allowChainList.find(m=>m.chain==a.token.chain);if(!g){S.fail(r("tokenChainNotSupport"));return}if(a.chainId!=g.chainId){S.fail(r("switchTokenChain"));return}if(e>a.token.amount){S.fail(r("blanceSlow"));return}if(await se(),V.value){S.fail(r("approveFirst"));return}$.value=1,_.value=!0;let p;try{let m=await q.wallet.sendRedPacket(a.redPacketContractAddress,a.token.address,L.value,e.toString(),T.value,W.value);console.dir(m),z.value=m.hash,p=await m.wait(),console.dir(p),z.value=p.transactionHash}catch(m){console.log(m),$.value=-1,await Q(1e3),_.value=!1;return}$.value=2;try{let m=p==null?void 0:p.events,C={};for(let k=m.length-1;k>=0;k--){let ee=m[k].topics.some(te=>te==="0x694af1cc8727cdd0afbdd53d9b87b69248bd490224e9dd090e788546506e076f");if(m[k].address==a.redPacketContractAddress&&ee){C=m[k];break}}let A=await q.redPacket.send(a.token.address,a.token.chain,C.topics[1],p.transactionHash,W.value,K.value,H.value,a.token.symbol,J.value);console.dir(A),$.value=0,await Q(500),_.value=!1;const b=A.data.uuid;R.value=!0,X.value=window.location.origin+"/#/redpacket/"+b}catch(m){console.log(m),$.value=-1,await Q(1e3),_.value=!1}}const ie=P.cfg.allowChainList.map(e=>e.chainShow);function ue(e){const t=P.cfg.allowChainList.find(p=>p.chainId==e);let g;return t?g=t.chain:g=null,g}function Se(){G.push("/selectToken")}function ce(e){return console.log(e),e&&e.replace("-","").replace(/^(.*\..{6}).*$/,"$1")}return Be(()=>{console.log("onMounted"),a.isConnectWallet&&a.token&&se()}),(e,t)=>{const g=f("van-icon"),p=f("van-radio"),m=f("van-radio-group"),C=f("van-image"),A=f("van-cell"),b=f("van-cell-group"),k=f("van-field"),ee=f("van-picker"),te=f("van-popup"),Ie=f("van-uploader"),j=f("van-button"),ae=f("van-dialog"),Le=f("van-action-sheet");return c(),h(le,null,[s("div",Ze,[s("div",et,[u(a).isConnectWallet?(c(),h("div",tt,[ue(u(a).chainId)?(c(),w(g,{key:0,class:"chain-icon",name:u(Ue)(ue(u(a).chainId))},null,8,["name"])):(c(),w(I,{key:1,class:"chain-icon",name:"wallet"})),s("div",at,l(u(ve)(u(a).walletAddress)),1)])):(c(),h("div",{key:1,class:"address",onClick:oe},[n(I,{name:"wallet"}),s("div",nt,l(e.$t("pleaseConnectWallet")),1)])),s("div",lt,[n(I,{name:"language",onClick:t[0]||(t[0]=o=>F.value=!0)}),n(I,{name:"help",onClick:t[1]||(t[1]=o=>N.value=!0)})])]),n(m,{modelValue:L.value,"onUpdate:modelValue":t[2]||(t[2]=o=>L.value=o),direction:"horizontal",class:"type form-item"},{default:i(()=>[n(p,{name:0,"checked-color":"#ED4A4A","icon-size":"16px"},{default:i(()=>[y(l(e.$t("randomAmount")),1)]),_:1}),n(p,{name:1,"checked-color":"#ED4A4A","icon-size":"16px"},{default:i(()=>[y(l(e.$t("identicalAmount")),1)]),_:1})]),_:1},8,["modelValue"]),n(b,{inset:"",class:"form-item form-normal"},{default:i(()=>[n(A,{title:e.$t("token"),"is-link":"",onClick:Se},re({_:2},[u(a).token?{name:"value",fn:i(()=>[s("div",ot,[u(a).token.icon?(c(),w(C,{key:0,class:"token-icon",round:"",src:u(a).token.icon,"error-icon":"/public/assets/images/default.png"},null,8,["src"])):D("",!0),y(" "+l(u(a).token.symbol),1)])]),key:"0"}:void 0]),1032,["title"])]),_:1}),L.value==0?(c(),w(b,{key:0,inset:"",class:"form-item form-normal"},{default:i(()=>[n(k,{label:e.$t("totalAmount"),"input-align":"right",formatter:ce,maxlength:"10",placeholder:e.$t("enterAmount"),type:"number",modelValue:B.value,"onUpdate:modelValue":t[3]||(t[3]=o=>B.value=o)},{"left-icon":i(()=>[n(I,{name:"pin"})]),_:1},8,["label","placeholder","modelValue"])]),_:1})):(c(),w(b,{key:1,inset:"",class:"form-item form-normal"},{default:i(()=>[n(k,{label:e.$t("singleAmount"),"input-align":"right",formatter:ce,maxlength:"10",placeholder:e.$t("enterAmount"),type:"number",modelValue:U.value,"onUpdate:modelValue":t[4]||(t[4]=o=>U.value=o)},{"left-icon":i(()=>[n(I,{name:"pu"})]),_:1},8,["label","placeholder","modelValue"])]),_:1})),u(a).token?(c(),h("div",st,[y(l(e.$t("availableBalance")),1),s("span",it,l(u(a).token.amount+" "+u(a).token.symbol),1)])):D("",!0),n(b,{inset:"",class:"form-item form-normal"},{default:i(()=>[n(k,{label:e.$t("quantity"),"input-align":"right",placeholder:e.$t("enterNumber"),type:"digit",maxlength:"4",modelValue:T.value,"onUpdate:modelValue":t[5]||(t[5]=o=>T.value=o)},re({"left-icon":i(()=>[ut]),_:2},[u(a).language=="zh-cn"?{name:"right-icon",fn:i(()=>[y("\u4E2A")]),key:"0"}:void 0]),1032,["label","placeholder","modelValue"])]),_:1}),n(b,{inset:"",class:"form-item form-normal"},{default:i(()=>[n(k,{modelValue:u(Z),"onUpdate:modelValue":t[6]||(t[6]=o=>fe(Z)?Z.value=o:null),"is-link":"",readonly:"",name:"picker",label:e.$t("deadline"),onClick:t[7]||(t[7]=o=>E.value=!0),"input-align":"right"},null,8,["modelValue","label"]),n(te,{show:E.value,"onUpdate:show":t[9]||(t[9]=o=>E.value=o),position:"bottom"},{default:i(()=>[n(ee,{columns:u(ke),onCancel:t[8]||(t[8]=o=>E.value=!1),onConfirm:ye,title:e.$t("settingDeadline"),"confirm-button-text":e.$t("confirm"),"cancel-button-text":e.$t("cancel")},null,8,["columns","title","confirm-button-text","cancel-button-text"])]),_:1},8,["show"])]),_:1}),n(b,{inset:"",class:"form-item form-normal form-uploader"},{default:i(()=>[x.value?(c(),h("div",ct,[n(C,{class:"image",fit:"contain",src:x.value},null,8,["src"]),n(g,{onClick:t[10]||(t[10]=ze(o=>be(),["stop"])),class:"close",name:"cross"})])):D("",!0),n(Ie,{class:"uploader-box","before-read":we,"max-size":1024*1024,"preview-image":!1,accept:"image/*"},{default:i(()=>[n(A,{class:"uploader-content","is-link":"",title:e.$t("redPacketCover")},{value:i(()=>[x.value?D("",!0):(c(),h("div",rt,l(e.$t("selectPicture")),1))]),_:1},8,["title"])]),_:1})]),_:1}),n(b,{inset:"",class:"form-item"},{default:i(()=>[n(k,{modelValue:H.value,"onUpdate:modelValue":t[11]||(t[11]=o=>H.value=o),rows:"1",autosize:"",type:"textarea",maxlength:"20",placeholder:e.$t("bestWishes"),"show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1}),n(b,{inset:"",class:"form-item"},{default:i(()=>[n(k,{modelValue:J.value,"onUpdate:modelValue":t[12]||(t[12]=o=>J.value=o),rows:"2",autosize:"",type:"textarea",maxlength:"500",placeholder:e.$t("ActivityDescription")},null,8,["modelValue","placeholder"])]),_:1}),s("div",dt,[y(l(e.$t("redPacketTotalAmount")),1),s("span",null,l(u(pe)),1),y(l(u(a).token?u(a).token.symbol:""),1)]),s("div",vt,[u(a).isConnectWallet?(c(),h(le,{key:0},[V.value?(c(),w(j,{key:0,class:"create-btn",type:"danger",onClick:Ce},{default:i(()=>[y(l(e.$t("approve")),1)]),_:1})):(c(),w(j,{key:1,class:"create-btn",type:"danger",onClick:Ae,loading:O.value},{default:i(()=>[y(l(e.$t("createRedPacketBtn")),1)]),_:1},8,["loading"]))],64)):(c(),w(j,{key:1,class:"create-btn",type:"primary",onClick:oe},{default:i(()=>[y(l(e.$t("connectWallet")),1)]),_:1}))]),s("div",{class:"form-item history",onClick:t[13]||(t[13]=o=>u(G).push("/history"))},l(e.$t("redPacketHistory")),1)]),n(ae,{class:"help-dialog",show:N.value,"onUpdate:show":t[14]||(t[14]=o=>N.value=o),title:e.$t("rulesDescription"),"confirm-button-text":e.$t("understand"),"close-on-click-overlay":""},{default:i(()=>[s("div",mt,[s("div",null,l(e.$t("rulesDescription1")),1),s("div",null,l(e.$t("rulesDescription2")),1),s("div",null,l(e.$t("rulesDescription3")),1),s("div",null,l(e.$t("rulesDescription4")),1),s("div",null,l(e.$t("rulesDescription5",{chains:u(ie).join("/")})),1)])]),_:1},8,["show","title","confirm-button-text"]),n(ae,{class:"create-success-dialog",show:R.value,"onUpdate:show":t[16]||(t[16]=o=>R.value=o),"close-on-click-overlay":""},{footer:i(()=>[s("div",kt,[n(j,{class:"copy-btn",type:"primary",onClick:t[15]||(t[15]=o=>u(me)(X.value))},{default:i(()=>[y(l(e.$t("copyLink")),1)]),_:1})])]),default:i(()=>[s("div",ft,[s("div",pt,[n(I,{name:"createSuccess"})]),s("div",ht,l(e.$t("createRedPacketSuccess")),1),s("div",gt,l(e.$t("shareLink")),1)])]),_:1},8,["show"]),n(Le,{show:F.value,"onUpdate:show":t[17]||(t[17]=o=>F.value=o),title:e.$t("switchLang"),actions:u(he),closeable:!1,"cancel-text":e.$t("cancel"),"close-on-click-action":"",onSelect:ge},null,8,["show","title","actions","cancel-text"]),n(Xe,{tradeVisable:_.value,"onUpdate:tradeVisable":t[18]||(t[18]=o=>_.value=o),status:$.value,tradeHash:z.value},null,8,["tradeVisable","status","tradeHash"]),n(ae,{class:"chain-err-dialog",confirmButtonText:e.$t("understand"),confirmButtonColor:"#3F80F7",show:Y.value,"onUpdate:show":t[19]||(t[19]=o=>Y.value=o)},{default:i(()=>[s("div",yt,[s("div",null,l(e.$t("notSupportedChain")),1),s("div",null,l(e.$t("pleaseSwitchTo",{chains:u(ie).join("\u3001")})),1)])]),_:1},8,["confirmButtonText","show"])],64)}}},$t=de(wt,[["__scopeId","data-v-533d815c"]]);export{$t as default};
