import{_ as re,j as de,k as ue,l as ve,m as pe,n as d,p as fe,r as p,o as s,c,w as a,u as l,T as M,v as O,g as r,a as n,t as i,b as y,J as q,C as G,K as Q,e as _,f as D,h as B,F as I,L as ge,H as _e,I as he}from"./index.85e97609.js";import{T as W}from"./TokenIcon.a0687b33.js";import{_ as u}from"./SvgIcon.ed6a2a27.js";import{d as X}from"./dayjs.min.ca26a367.js";const ke=x=>(_e("data-v-175e0a56"),x=x(),he(),x),ye={class:"text"},me={class:"item-left"},we={class:"left-content"},Ce={class:"bottom-text"},xe={class:"item-right"},$e={key:0,class:"bottom-text"},be=["onClick"],Le={key:1,class:"bottom-text"},Ie=["onClick"],He={class:"text"},Se={class:"item-left"},Ue={class:"left-content"},Ae={class:"bottom-text"},Te={class:"item-right"},Re={class:"status-icon"},Ve={class:"content"},Fe={class:"bottom-text"},Ne=ke(()=>n("span",null,"/",-1)),Pe={class:"content"},Ye={class:"success-icon"},Me={class:"text"},De={class:"btn"},Be={__name:"History",setup(x){const j=de(),v=ue(),{t:m}=ve(),Z=pe("global"),$=d(20),h=d([]),H=d(1),S=d(!1),U=d(!1),w=d([]),A=d(1),T=d(!1),R=d(!1),f=d(!1),g=d(!1),V=d(!1),F=d([]),N=d(!1),k=fe({creatorAddress:"",showLuckUrl:"",redPacketUrl:""});function ee(t){V.value=!0,t.refundTx==""&&t.unlockTx==""?F.value=[{name:m("continueShare"),value:"0",color:"#3F80F7"},{name:m("seeLuck"),value:"1"}]:F.value=[{name:m("seeLuck"),value:"1"}],k.creatorAddress=m("redPacketSend",{user:D(t.creatorAddress)}),k.showLuckUrl="/redpacket/"+t.uuid+"/showLuck",k.redPacketUrl=window.location.origin+"/#/redpacket/"+t.uuid}function te(t){t.value==0?N.value=!0:t.value==1&&j.push(k.showLuckUrl)}function oe(t,o){let C=Z.cfg.allowChainList.find(b=>b.chain==t);C?window.open(C.txNetwork+o,"_blank"):M(m("unsupportedNetwork"))}function ne(){se()}function E(){v.active==0?(H.value=1,h.value=[],U.value=!1,P()):v.active==1&&(A.value=1,w.value=[],R.value=!1,Y())}function se(){console.log(111),v.active==0?P():v.active==1&&Y()}async function P(){f.value=!0;let t=M.loading({message:"Loading...",forbidClick:!0,duration:0});try{const o=await O.redPacket.getReceiveHistory(v.walletAddress,$.value,H.value);console.log(o),o.status==1?(console.log(h),h.value=h.value.concat(o.data.list),o.data.list.length<$.value?U.value=!0:H.value++):(console.log("fail"),g.value=!0)}catch(o){console.log(o),g.value=!0}finally{t.clear(),S.value=!1,f.value=!1}}async function Y(){f.value=!0;let t=M.loading({message:"Loading...",forbidClick:!0,duration:0});try{const o=await O.redPacket.getSendHistory(v.walletAddress,$.value,A.value);console.log(o),o.status==1?(w.value=w.value.concat(o.data.list),o.data.list.length<$.value?R.value=!0:A.value++):(console.log("fail"),g.value=!0)}catch(o){console.log(o),g.value=!1}finally{t.clear(),T.value=!1,f.value=!1}}return(t,o)=>{const C=p("van-empty"),b=p("van-cell"),z=p("van-list"),J=p("van-pull-refresh"),K=p("van-tab"),ae=p("van-action-sheet"),le=p("van-button"),ie=p("van-dialog"),ce=p("van-tabs");return s(),c(ce,{class:"history",active:l(v).active,"onUpdate:active":o[9]||(o[9]=e=>l(v).active=e),onRendered:ne},{default:a(()=>[r(K,{class:"tab-top",title:t.$t("ireceived")},{default:a(()=>[r(J,{modelValue:S.value,"onUpdate:modelValue":o[2]||(o[2]=e=>S.value=e),"pulling-text":t.$t("pulling"),"loosing-text":t.$t("loosing"),"loading-text":t.$t("loading"),onRefresh:E},{default:a(()=>[h.value.length==0?(s(),c(C,{key:0,class:"empty-box"},{image:a(()=>[r(u,{class:"icon",name:"emptyHistory"}),n("div",ye,i(t.$t("noRecord")),1)]),_:1})):(s(),c(z,{key:1,loading:f.value,"onUpdate:loading":o[0]||(o[0]=e=>f.value=e),"loading-text":t.$t("loading"),finished:U.value,"finished-text":t.$t("noMore"),error:g.value,"onUpdate:error":o[1]||(o[1]=e=>g.value=e),"error-text":t.$t("errorText"),onLoad:P},{default:a(()=>[(s(!0),y(I,null,q(h.value,e=>(s(),c(b,{class:"receive-item item",key:e},{title:a(()=>[n("div",me,[r(W,{chainIcon:l(G)(e.contractChain),tokenIcon:l(Q)(e.contractChain.toLowerCase(),e.contractAddress.toLowerCase())},null,8,["chainIcon","tokenIcon"]),n("div",we,[n("div",null,[_(i(l(D)(e.userAddress)),1),r(u,{class:"copy-icon",name:"copy",onClick:L=>l(B)(e.userAddress)},null,8,["onClick"])]),n("div",Ce,[e.type==0?(s(),c(u,{key:0,class:"type-icon",name:"pin"})):(s(),c(u,{key:1,class:"type-icon",name:"pu"})),_(" "+i(l(X).unix(e.time).format("YYYY-MM-DD HH:mm")),1)])])])]),value:a(()=>[n("div",xe,[n("div",null,i(e.amount)+" "+i(e.symbol),1),e.tx?(s(),y("div",$e,[n("span",{onClick:L=>oe(e.contractChain,e.tx)},[_(i(t.$t("blockChainBrowser")),1),r(u,{class:"share-icon",name:"share"})],8,be)])):(s(),y("div",Le,[n("span",{onClick:L=>l(j).push(`/redpacket/${e.uuid}/showLuck`)},i(t.$t("seeLuck")),9,Ie)]))])]),_:2},1024))),128))]),_:1},8,["loading","loading-text","finished","finished-text","error","error-text"]))]),_:1},8,["modelValue","pulling-text","loosing-text","loading-text"])]),_:1},8,["title"]),r(K,{title:t.$t("isend")},{default:a(()=>[r(J,{modelValue:T.value,"onUpdate:modelValue":o[5]||(o[5]=e=>T.value=e),"pulling-text":t.$t("pulling"),"loosing-text":t.$t("loosing"),"loading-text":t.$t("loading"),onRefresh:E},{default:a(()=>[w.value.length==0?(s(),c(C,{key:0,class:"empty-box"},{image:a(()=>[r(u,{class:"icon",name:"emptyHistory"}),n("div",He,i(t.$t("noRecord")),1)]),_:1})):(s(),c(z,{key:1,loading:f.value,"onUpdate:loading":o[3]||(o[3]=e=>f.value=e),"loading-text":t.$t("loading"),finished:R.value,"finished-text":t.$t("noMore"),error:g.value,"onUpdate:error":o[4]||(o[4]=e=>g.value=e),"error-text":t.$t("errorText"),onLoad:Y},{default:a(()=>[(s(!0),y(I,null,q(w.value,e=>(s(),c(b,{class:"send-item item",key:e,onClick:L=>ee(e)},{title:a(()=>[n("div",Se,[r(W,{chainIcon:l(G)(e.contractChain),tokenIcon:l(Q)(e.contractChain.toLowerCase(),e.contractAddress.toLowerCase())},null,8,["chainIcon","tokenIcon"]),n("div",Ue,[n("div",null,[_(i(l(D)(e.creatorAddress)),1),r(u,{class:"copy-icon",name:"copy",onClick:ge(L=>l(B)(e.creatorAddress),["stop"])},null,8,["onClick"])]),n("div",Ae,[e.type==0?(s(),c(u,{key:0,class:"type-icon",name:"pin"})):(s(),c(u,{key:1,class:"type-icon",name:"pu"})),_(" "+i(l(X)(e.createTime).format("YYYY-MM-DD HH:mm")),1)])])])]),value:a(()=>[n("div",Te,[n("div",Re,[e.refundTx!=""||e.unlockTx!=""?(s(),y(I,{key:0},[l(v).language=="en"?(s(),c(u,{key:0,class:"type-icon",name:"endEn"})):(s(),c(u,{key:1,class:"type-icon",name:"endCn"}))],64)):(s(),y(I,{key:1},[l(v).language=="en"?(s(),c(u,{key:0,class:"type-icon",name:"goingEn"})):(s(),c(u,{key:1,class:"type-icon",name:"goingCn"}))],64))]),n("div",Ve,[n("div",null,i(e.totalAmount+" "+e.symbol),1),n("div",Fe,[_(i(t.$t("received"))+" "+i(e.receivedCount),1),Ne,_(i(e.count),1)])])])]),_:2},1032,["onClick"]))),128))]),_:1},8,["loading","loading-text","finished","finished-text","error","error-text"]))]),_:1},8,["modelValue","pulling-text","loosing-text","loading-text"])]),_:1},8,["title"]),r(ae,{show:V.value,"onUpdate:show":o[6]||(o[6]=e=>V.value=e),actions:F.value,"cancel-text":t.$t("cancel"),description:k.creatorAddress,"close-on-click-action":"",onSelect:te},null,8,["show","actions","cancel-text","description"]),r(ie,{class:"create-success-dialog",show:N.value,"onUpdate:show":o[8]||(o[8]=e=>N.value=e),"close-on-click-overlay":""},{footer:a(()=>[n("div",De,[r(le,{class:"copy-btn",type:"primary",onClick:o[7]||(o[7]=e=>l(B)(k.redPacketUrl))},{default:a(()=>[_(i(t.$t("copyLink")),1)]),_:1})])]),default:a(()=>[n("div",Pe,[n("div",Ye,[r(u,{name:"createSuccess"})]),n("div",Me,i(t.$t("shareLink")),1)])]),_:1},8,["show"])]),_:1},8,["active"])}}},Ke=re(Be,[["__scopeId","data-v-175e0a56"]]);export{Ke as default};
