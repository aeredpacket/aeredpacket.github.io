import{k as le,l as ce,q as c,v as z,r as p,o as s,c as n,w as l,T as E,x as q,g as i,b as L,z as O,F as G,a as t,u as r,C as J,D as K,e as f,t as u,f as S,h as Q,E as ie,p as re,j as de}from"./index.6b92f77c.js";import{T as W,d as X}from"./dayjs.min.c1b2c167.js";import{_ as d}from"./TokenIcon.vuevuetypestyleindex0scoped7bbb7138lang.cba22175.js";import{_ as ue}from"./plugin-vueexport-helper.2444895f.js";const T=m=>(re("data-v-8bd249e3"),m=m(),de(),m),ve=T(()=>t("div",{class:"text"},"\u6682\u65E0\u8BB0\u5F55",-1)),_e={class:"item-left"},pe={class:"left-content"},fe={class:"bottom-text"},he={class:"item-right"},ye={key:0,class:"bottom-text"},ke=["onClick"],ge={key:1,class:"bottom-text"},me=["onClick"],Ce=T(()=>t("div",{class:"text"},"\u6682\u65E0\u8BB0\u5F55",-1)),xe={class:"item-left"},be={class:"left-content"},we=["onClick"],Le={class:"bottom-text"},Ie={class:"item-right"},Ae={class:"status-icon"},He={class:"content"},Ue={class:"bottom-text"},Se=T(()=>t("span",null,"/",-1)),Te={__name:"History",setup(m){const I=le(),R=ce(),h=c(0),C=c(20),y=c([]),A=c(1),H=c(!1),k=c([]),V=c(1),x=c(!1),v=c(!1),b=c(!1),_=c(!1),U=c(!1),Z=z([{name:"\u7EE7\u7EED\u8F6C\u53D1",value:"0",color:"#3F80F7"},{name:"\u67E5\u770B\u624B\u6C14",value:"1"}]),g=z({creatorAddress:"",showLuckUrl:"",redPacketUrl:""});function ee(a){a.refundTx==""&&a.unlockTx==""&&(U.value=!0,g.creatorAddress=S(a.creatorAddress)+"\u53D1\u51FA\u7684\u7EA2\u5305",g.showLuckUrl="/redpacket/"+a.uuid+"/showLuck",g.redPacketUrl="/redpacket/"+a.uuid)}function oe(a){a.value==0?I.push(g.redPacketUrl):a.value==1&&I.push(g.showLuckUrl)}function te(a){window.open("https://testnet.bscscan.com/tx/"+a,"_blank")}function se(){P()}function Y(){h.value==0?(A.value=1,y.value=[],$()):h.value==1&&(x.value=!1,k.value=[],D())}function P(){h.value==0?$():h.value==1&&D()}async function $(){v.value=!0;let a=E.loading({message:"Loading...",forbidClick:!0,duration:0});try{const o=await q.redPacket.getReceiveHistory(R.walletAddress,C.value,A.value);console.log(o),o.status==1?(console.log(y),y.value=y.value.concat(o.data.list),o.data.list.length<C.value?b.value=!0:A.value++):(console.log("fail"),_.value=!0)}catch(o){console.log(o),_.value=!0}finally{console.log(_.value),a.clear(),H.value=!1,v.value=!1}}async function D(){v.value=!0;let a=E.loading({message:"Loading...",forbidClick:!0,duration:0});try{const o=await q.redPacket.getSendHistory(R.walletAddress,C.value,V.value);console.log(o),o.status==1?(console.log(k),k.value=k.value.concat(o.data.list),o.data.list.length<C.value?b.value=!0:V.value++):(console.log("fail"),_.value=!0)}catch(o){console.log(o),_.value=!1}finally{console.log(_.value),a.clear(),x.value=!1,v.value=!1}}return(a,o)=>{const F=p("van-empty"),N=p("van-cell"),M=p("van-list"),B=p("van-pull-refresh"),j=p("van-tab"),ae=p("van-action-sheet"),ne=p("van-tabs");return s(),n(ne,{class:"history",active:h.value,"onUpdate:active":o[6]||(o[6]=e=>h.value=e),onRendered:se},{default:l(()=>[i(j,{class:"tab-top",title:"\u6211\u9886\u5230\u7684"},{default:l(()=>[i(B,{modelValue:H.value,"onUpdate:modelValue":o[2]||(o[2]=e=>H.value=e),onRefresh:Y},{default:l(()=>[y.value.length==0?(s(),n(F,{key:0,class:"empty-box"},{image:l(()=>[i(d,{class:"icon",name:"emptyHistory"}),ve]),_:1})):(s(),n(M,{key:1,loading:v.value,"onUpdate:loading":o[0]||(o[0]=e=>v.value=e),finished:b.value,"finished-text":"\u6CA1\u6709\u66F4\u591A\u4E86",error:_.value,"onUpdate:error":o[1]||(o[1]=e=>_.value=e),"error-text":"\u8BF7\u6C42\u5931\u8D25\uFF0C\u70B9\u51FB\u91CD\u65B0\u52A0\u8F7D",onLoad:P},{default:l(()=>[(s(!0),L(G,null,O(y.value,e=>(s(),n(N,{class:"receive-item item",key:e},{title:l(()=>[t("div",_e,[i(W,{chainIcon:r(J)(e.contractChain),tokenIcon:r(K)(e.contractChain.toLowerCase(),e.contractAddress.toLowerCase())},null,8,["chainIcon","tokenIcon"]),t("div",pe,[t("div",null,[f(u(r(S)(e.userAddress)),1),i(d,{class:"copy-icon",name:"copy",onClick:w=>r(Q)(e.userAddress)},null,8,["onClick"])]),t("div",fe,[e.type==0?(s(),n(d,{key:0,class:"type-icon",name:"pin"})):(s(),n(d,{key:1,class:"type-icon",name:"pu"})),f(" "+u(r(X).unix(e.time).format("YYYY-MM-DD HH:mm")),1)])])])]),value:l(()=>[t("div",he,[t("div",null,u(e.amount)+" "+u(e.symbol),1),e.tx?(s(),L("div",ye,[t("span",{onClick:w=>te(e.tx)},[f("\u533A\u5757\u6D4F\u89C8\u5668"),i(d,{class:"share-icon",name:"share"})],8,ke)])):(s(),L("div",ge,[t("span",{onClick:w=>r(I).push(`/redpacket/${e.uuid}/showLuck`)},"\u67E5\u770B\u624B\u6C14",8,me)]))])]),_:2},1024))),128))]),_:1},8,["loading","finished","error"]))]),_:1},8,["modelValue"])]),_:1}),i(j,{title:"\u6211\u53D1\u51FA\u7684"},{default:l(()=>[i(B,{modelValue:x.value,"onUpdate:modelValue":o[4]||(o[4]=e=>x.value=e),onRefresh:Y},{default:l(()=>[k.value.length==0?(s(),n(F,{key:0,class:"empty-box"},{image:l(()=>[i(d,{class:"icon",name:"emptyHistory"}),Ce]),_:1})):(s(),n(M,{key:1,loading:v.value,"onUpdate:loading":o[3]||(o[3]=e=>v.value=e),finished:b.value,"finished-text":"\u6CA1\u6709\u66F4\u591A\u4E86",onLoad:a.onLoad},{default:l(()=>[(s(!0),L(G,null,O(k.value,e=>(s(),n(N,{class:"send-item item",key:e,onClick:w=>ee(e)},{title:l(()=>[t("div",xe,[i(W,{chainIcon:r(J)(e.contractChain),tokenIcon:r(K)(e.contractChain.toLowerCase(),e.contractAddress.toLowerCase())},null,8,["chainIcon","tokenIcon"]),t("div",be,[t("div",{onClick:ie(w=>r(Q)(e.creatorAddress),["stop"])},[f(u(r(S)(e.creatorAddress)),1),i(d,{class:"copy-icon",name:"copy"})],8,we),t("div",Le,[e.type==0?(s(),n(d,{key:0,class:"type-icon",name:"pin"})):(s(),n(d,{key:1,class:"type-icon",name:"pu"})),f(" "+u(r(X)(e.createTime).format("YYYY-MM-DD HH:mm")),1)])])])]),value:l(()=>[t("div",Ie,[t("div",Ae,[e.refundTx!=""||e.unlockTx!=""?(s(),n(d,{key:0,class:"type-icon",name:"endCn"})):(s(),n(d,{key:1,class:"type-icon",name:"goingCn"}))]),t("div",He,[t("div",null,u(e.totalAmount+" "+e.symbol),1),t("div",Ue,[f(" \u5DF2\u9886 "+u(e.receivedCount),1),Se,f(u(e.count),1)])])])]),_:2},1032,["onClick"]))),128))]),_:1},8,["loading","finished","onLoad"]))]),_:1},8,["modelValue"])]),_:1}),i(ae,{show:U.value,"onUpdate:show":o[5]||(o[5]=e=>U.value=e),actions:Z,"cancel-text":"\u53D6\u6D88",description:g.creatorAddress,"close-on-click-action":"",onSelect:oe},null,8,["show","actions","description"])]),_:1},8,["active"])}}},$e=ue(Te,[["__scopeId","data-v-8bd249e3"]]);export{$e as default};
