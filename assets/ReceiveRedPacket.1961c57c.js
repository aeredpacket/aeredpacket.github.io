import{T as B}from"./TokenIcon.904c21dd.js";import{d as I,_ as V}from"./dayjs.min.886975a3.js";import{_ as G,k as K,p as X,j as q,l as u,v as W,U as J,x as Q,R as ee,V as te,r as P,o as i,b as d,a,u as s,n as R,t as o,d as c,c as D,g as m,e as $,F as se,m as ae,w as oe,W as ie,H as L,X as de,T as g,y as le,O as N,Y as ne,f as ce,K as re,L as ve}from"./index.36ed8169.js";import{u as ue}from"./redPacketStore.e8a73158.js";const ye=k=>(re("data-v-4d608781"),k=k(),ve(),k),fe={class:"body"},pe={class:"top"},_e=ie('<div class="background" data-v-4d608781><div style="--i:1;" data-v-4d608781></div><div style="--i:2;" data-v-4d608781></div><div style="--i:3;" data-v-4d608781></div><div style="--i:4;" data-v-4d608781></div><div style="--i:5;" data-v-4d608781></div><div style="--i:6;" data-v-4d608781></div><div style="--i:7;" data-v-4d608781></div><div style="--i:8;" data-v-4d608781></div><div style="--i:9;" data-v-4d608781></div><div style="--i:10;" data-v-4d608781></div><div style="--i:11;" data-v-4d608781></div><div style="--i:12;" data-v-4d608781></div><div style="--i:13;" data-v-4d608781></div><div style="--i:14;" data-v-4d608781></div><div style="--i:15;" data-v-4d608781></div><div style="--i:16;" data-v-4d608781></div><div style="--i:17;" data-v-4d608781></div><div style="--i:18;" data-v-4d608781></div><div style="--i:19;" data-v-4d608781></div><div style="--i:20;" data-v-4d608781></div><div style="--i:21;" data-v-4d608781></div><div style="--i:22;" data-v-4d608781></div><div style="--i:23;" data-v-4d608781></div><div style="--i:24;" data-v-4d608781></div><div style="--i:25;" data-v-4d608781></div><div style="--i:26;" data-v-4d608781></div><div style="--i:27;" data-v-4d608781></div><div style="--i:28;" data-v-4d608781></div><div style="--i:29;" data-v-4d608781></div><div style="--i:30;" data-v-4d608781></div><div style="--i:31;" data-v-4d608781></div><div style="--i:32;" data-v-4d608781></div><div style="--i:33;" data-v-4d608781></div><div style="--i:34;" data-v-4d608781></div><div style="--i:35;" data-v-4d608781></div><div style="--i:36;" data-v-4d608781></div></div>',1),he={key:0,class:"info-box"},me={key:0,class:"fold-operate-fixed"},ke=ye(()=>a("span",{class:"dot"},"...",-1)),ge={class:"fold-text"},we={class:"red-packet"},Ce={class:"circle-big"},be={class:"circle-small"},Ie={key:0,class:"card"},Pe={class:"from"},Re={class:"amount"},$e={class:"congratulation"},Le={class:"text"},Ae={key:0,class:"logo"},He={key:1},Se={class:"text-top"},Te={class:"from"},xe={class:"congratulation"},Me={key:0,class:"front-cover"},Be={class:"packer-btn packer-btn-behind",style:{transform:"translateZ(-4px)"}},Ve={class:"packer-btn packer-btn-front"},We={class:"text-middle"},De={key:0},Ne={key:1},Ye={class:"text-bottom"},Oe={key:0,class:"award-time"},ze={key:1,class:"award-time"},Ee={class:"bottom"},Fe={class:"logo"},je={__name:"ReceiveRedPacket",setup(k){const e=ue(),v=K(),A=X(),{t:y}=q(),H=u(!1),f=u(!0),p=u(null),_=u(null),h=u(!1),l=u(0),w=u("--"),C=u(0),r=W(()=>C.value?e.startTime-C.value:0);J(()=>e.title,async(t,n)=>{S()});async function S(){if(!e.title)return;await L();let t=_.value.scrollHeight,n=_.value.offsetHeight;console.log(_.value.scrollHeight),console.log(_.value.offsetHeight),t>n&&(H.value=!0),document.body.style.setProperty("--top-height",p.value.scrollHeight-10+"px"),window.onresize=()=>(console.log("\u9AD8\u5EA6"),(()=>{document.body.style.setProperty("--top-height",p.value.scrollHeight-10+"px")})())}async function Y(){f.value=!1,await L(),document.body.style.setProperty("--top-height",p.value.scrollHeight-10+"px")}async function O(){f.value=!0,await L(),document.body.style.setProperty("--top-height",p.value.scrollHeight-10+"px")}async function z(){de([e.coverImage])}async function E(){console.log("openClick");let t;if(v.walletAddress?t=g.loading():t=g.fail(y("connectWalletWarn")),!h.value){h.value=!0;try{await F()}catch(n){console.log(n)}finally{t.clear(),h.value=!1}}}async function F(){if(!v.isConnectWallet){if(await v.connectWallet(),!v.isConnectWallet)return;await e.getRedPacketDetail(e.uuid,v.walletAddress)}if(e.isReceived){const t=e.receiveList.find(n=>n.userAddress.toLowerCase()==v.walletAddress.toLowerCase());w.value=t.amount,l.value=1;return}if(e.whiteList.length>0&&!e.whiteList.includes(v.walletAddress.toLowerCase())){g({message:y("exclusiveRedPacket"),position:"top"});return}if(console.log(e.status),e.status==3||e.status==2){if(e.status==2&&r.value>0){let t="";r.value<60?t=y("unlockSecondsPlease",{seconds:r.value}):t=y("unlockHoursPlease",{hours:Math.floor(r.value/3600),minutes:Math.floor((r.value-Math.floor(r.value/3600)*3600)/60)}),g({message:t,position:"top"});return}try{const t=await le.redPacket.receive(v.walletAddress,e.uuid);console.log(t),t.status==1&&t.data.status==3&&(e.isReceived=!0,w.value=t.data.receiveResult.amount,l.value=1,e.receiveList.push({transferTime:I().unix(),amount:t.data.receiveResult.amount,userAddress:t.data.receiveResult.userAddress}))}catch(t){console.log(t),l.value=2}}else e.count==e.receiveList.length?l.value=2:l.value=3}const T=W(()=>e.creatorAddress?e.creatorAddress.substr(-4).toLowerCase():"--");let b=null;return Q(()=>{const n=ee().params.uuid;e.uuid=n,e.getRedPacketDetail(),b=setInterval(()=>{C.value=I().unix()},1e3),S()}),te(()=>{b&&clearInterval(b)}),(t,n)=>{const j=P("van-image"),U=P("van-icon"),Z=P("van-button");return i(),d("div",fe,[a("div",pe,[_e,a("div",{class:"content",ref_key:"content",ref:p},[s(e).title?(i(),d("div",he,[a("div",{class:R(["info",{fold:f.value}]),ref_key:"info",ref:_},[H.value&&f.value?(i(),d("div",me,[ke,a("span",{class:"fold-operate",onClick:Y},o(t.$t("expand")),1)])):c("",!0),a("span",ge,o(s(e).title),1),f.value?c("",!0):(i(),d("span",{key:1,class:"fold-operate",onClick:O},o(t.$t("putAway")),1))],2)])):c("",!0),a("div",we,[a("div",Ce,[a("div",be,[l.value==1?(i(),d("div",Ie,[a("div",Pe,[s(e).contractChain?(i(),D(B,{key:0,class:"token-icon",tokenIcon:s(N)(s(e).contractChain.toLowerCase(),s(e).contractAddress.toLowerCase())},null,8,["tokenIcon"])):c("",!0),a("span",null,o(t.$t("redPacketBelong",{user:s(T)})),1)]),a("div",Re,o(w.value+" "+s(e).symbol),1),a("div",$e,o(s(e).remark),1)])):c("",!0)])]),a("div",Le,[l.value!=1?(i(),d("div",Ae,[m(V,{class:"icon",name:"logo"})])):c("",!0),l.value!=1?(i(),d("div",He,[a("div",Se,[a("div",Te,[s(e).contractChain?(i(),D(B,{key:0,class:"token-icon",tokenIcon:s(N)(s(e).contractChain.toLowerCase(),s(e).contractAddress.toLowerCase())},null,8,["tokenIcon"])):c("",!0),$(o()+" ",1),a("span",null,"*"+o(t.$t("redPacketBelong",{user:s(T)})),1)]),a("div",xe,o(s(e).remark),1)]),l.value==0&&s(e).coverImage?(i(),d("div",Me,[m(j,{class:"img",fit:"contain",src:s(e).coverImage,onClick:z},null,8,["src"])])):c("",!0),l.value==0&&!h.value?(i(),d("div",{key:1,class:R(["open",s(v).language=="en"?"open-en":""]),onClick:E},o(t.$t("open")),3)):l.value==0&&h.value?(i(),d("div",{key:2,class:R(["anim-rotate packer-btn-pos",s(v).language=="en"?"open-en":""])},[a("div",Be,o(t.$t("open")),1),(i(),d(se,null,ae(7,(x,M)=>a("div",{class:"packer-btn-middle",key:M,style:ne({transform:`translateZ(${M-3}px)`})},null,4)),64)),a("div",Ve,o(t.$t("open")),1)],2)):c("",!0),a("div",We,[l.value==2?(i(),d("div",De,[a("div",null,o(t.$t("handSlow")),1),a("div",null,o(t.$t("redPackIsGone")),1)])):c("",!0),l.value==3?(i(),d("div",Ne,[a("div",null,o(t.$t("handSlow")),1),a("div",null,o(t.$t("redPackIsExpired")),1)])):c("",!0)])])):c("",!0),a("div",Ye,[l.value==1?(i(),d("div",Oe,o(t.$t("distributeTime",{date:s(I).unix(s(e).sendTime+s(e).endTime).format("YYYY-MM-DD HH:mm"),address:s(ce)(s(v).walletAddress)})),1)):s(e).status==2&&s(r)>0?(i(),d("div",ze,o(s(r)<60?s(y)("unlockSeconds",{seconds:s(r)}):s(y)("unlockHours",{hours:Math.floor(s(r)/3600),minutes:Math.floor((s(r)-Math.floor(s(r)/3600)*3600)/60)})),1)):c("",!0),a("div",{class:"show-luck",onClick:n[0]||(n[0]=x=>s(A).push(`/redpacket/${s(e).uuid}/showLuck`))},[$(o(t.$t("seeLuckEveryone"))+" ",1),m(U,{name:"arrow"})])])])])],512)]),a("div",Ee,[m(Z,{class:"send-red-packet",onClick:n[1]||(n[1]=x=>s(A).push("/"))},{default:oe(()=>[$(o(t.$t("giveOutRedPacket")),1)]),_:1}),a("div",Fe,[m(V,{class:"icon",name:"logo"})])])])}}},Xe=G(je,[["__scopeId","data-v-4d608781"]]);export{Xe as default};
