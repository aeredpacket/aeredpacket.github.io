import{j as ae,k as le,n as l,q as ie,r as f,o as n,c as a,w as c,T as q,s as z,g as u,a as s,t as i,b as k,y as G,u as r,D as O,E as J,e as g,f as V,h as K,F as b,G as ce,A as re,C as de}from"./index.2c82b210.js";import{T as Q,d as W}from"./dayjs.min.438ccc51.js";import{_ as d}from"./SvgIcon.37599aa6.js";import{_ as ue}from"./plugin-vueexport-helper.2444895f.js";const ve=x=>(re("data-v-caafdd70"),x=x(),de(),x),pe={class:"text"},fe={class:"item-left"},ge={class:"left-content"},ye={class:"bottom-text"},he={class:"item-right"},_e={key:0,class:"bottom-text"},ke=["onClick"],me={key:1,class:"bottom-text"},xe=["onClick"],Ce={class:"text"},$e={class:"item-left"},we={class:"left-content"},be={class:"bottom-text"},Le={class:"item-right"},Ie={class:"status-icon"},Ae={class:"content"},He={class:"bottom-text"},Te=ve(()=>s("span",null,"/",-1)),Ue={__name:"History",setup(x){const L=ae(),C=le(),y=l(0),$=l(6),h=l([]),I=l(1),A=l(!1),Y=l(!1),m=l([]),H=l(1),T=l(!1),M=l(!1),p=l(!1),v=l(!1),U=l(!1),S=l([{name:"\u7EE7\u7EED\u8F6C\u53D1",value:"0",color:"#3F80F7"},{name:"\u67E5\u770B\u624B\u6C14",value:"1"}]),_=ie({creatorAddress:"",showLuckUrl:"",redPacketUrl:""});function X(t){U.value=!0,t.refundTx==""&&t.unlockTx==""?S.value=[{name:"\u7EE7\u7EED\u8F6C\u53D1",value:"0",color:"#3F80F7"},{name:"\u67E5\u770B\u624B\u6C14",value:"1"}]:S.value=[{name:"\u67E5\u770B\u624B\u6C14",value:"1"}],_.creatorAddress=V(t.creatorAddress)+"\u53D1\u51FA\u7684\u7EA2\u5305",_.showLuckUrl="/redpacket/"+t.uuid+"/showLuck",_.redPacketUrl="/redpacket/"+t.uuid}function Z(t){t.value==0?L.push(_.redPacketUrl):t.value==1&&L.push(_.showLuckUrl)}function ee(t){window.open("https://testnet.bscscan.com/tx/"+t,"_blank")}function te(){oe()}function P(){y.value==0?(I.value=1,h.value=[],R()):y.value==1&&(H.value=1,m.value=[],F())}function oe(){console.log(111),y.value==0?R():y.value==1&&F()}async function R(){p.value=!0;let t=q.loading({message:"Loading...",forbidClick:!0,duration:0});try{const o=await z.redPacket.getReceiveHistory(C.walletAddress,$.value,I.value);console.log(o),o.status==1?(console.log(h),h.value=h.value.concat(o.data.list),o.data.list.length<$.value?Y.value=!0:I.value++):(console.log("fail"),v.value=!0)}catch(o){console.log(o),v.value=!0}finally{console.log(v.value),t.clear(),A.value=!1,p.value=!1}}async function F(){p.value=!0;let t=q.loading({message:"Loading...",forbidClick:!0,duration:0});try{const o=await z.redPacket.getSendHistory(C.walletAddress,$.value,H.value);console.log(o),o.status==1?(m.value=m.value.concat(o.data.list),o.data.list.length<$.value?M.value=!0:(console.log(111111),H.value++)):(console.log("fail"),v.value=!0)}catch(o){console.log(o),v.value=!1}finally{console.log(v.value),t.clear(),T.value=!1,p.value=!1}}return(t,o)=>{const D=f("van-empty"),N=f("van-cell"),B=f("van-list"),E=f("van-pull-refresh"),j=f("van-tab"),ne=f("van-action-sheet"),se=f("van-tabs");return n(),a(se,{class:"history",active:y.value,"onUpdate:active":o[7]||(o[7]=e=>y.value=e),onRendered:te},{default:c(()=>[u(j,{class:"tab-top",title:t.$t("ireceived")},{default:c(()=>[u(E,{modelValue:A.value,"onUpdate:modelValue":o[2]||(o[2]=e=>A.value=e),"pulling-text":t.$t("pulling"),"loosing-text":t.$t("loosing"),"loading-text":t.$t("loading"),onRefresh:P},{default:c(()=>[h.value.length==0?(n(),a(D,{key:0,class:"empty-box"},{image:c(()=>[u(d,{class:"icon",name:"emptyHistory"}),s("div",pe,i(t.$t("noRecord")),1)]),_:1})):(n(),a(B,{key:1,loading:p.value,"onUpdate:loading":o[0]||(o[0]=e=>p.value=e),"loading-text":t.$t("loading"),finished:Y.value,"finished-text":t.$t("noMore"),error:v.value,"onUpdate:error":o[1]||(o[1]=e=>v.value=e),"error-text":t.$t("errorText"),onLoad:R},{default:c(()=>[(n(!0),k(b,null,G(h.value,e=>(n(),a(N,{class:"receive-item item",key:e},{title:c(()=>[s("div",fe,[u(Q,{chainIcon:r(O)(e.contractChain),tokenIcon:r(J)(e.contractChain.toLowerCase(),e.contractAddress.toLowerCase())},null,8,["chainIcon","tokenIcon"]),s("div",ge,[s("div",null,[g(i(r(V)(e.userAddress)),1),u(d,{class:"copy-icon",name:"copy",onClick:w=>r(K)(e.userAddress)},null,8,["onClick"])]),s("div",ye,[e.type==0?(n(),a(d,{key:0,class:"type-icon",name:"pin"})):(n(),a(d,{key:1,class:"type-icon",name:"pu"})),g(" "+i(r(W).unix(e.time).format("YYYY-MM-DD HH:mm")),1)])])])]),value:c(()=>[s("div",he,[s("div",null,i(e.amount)+" "+i(e.symbol),1),e.tx?(n(),k("div",_e,[s("span",{onClick:w=>ee(e.tx)},[g(i(t.$t("blockChainBrowser")),1),u(d,{class:"share-icon",name:"share"})],8,ke)])):(n(),k("div",me,[s("span",{onClick:w=>r(L).push(`/redpacket/${e.uuid}/showLuck`)},i(t.$t("seeLuck")),9,xe)]))])]),_:2},1024))),128))]),_:1},8,["loading","loading-text","finished","finished-text","error","error-text"]))]),_:1},8,["modelValue","pulling-text","loosing-text","loading-text"])]),_:1},8,["title"]),u(j,{title:t.$t("isend")},{default:c(()=>[u(E,{modelValue:T.value,"onUpdate:modelValue":o[5]||(o[5]=e=>T.value=e),"pulling-text":t.$t("pulling"),"loosing-text":t.$t("loosing"),"loading-text":t.$t("loading"),onRefresh:P},{default:c(()=>[m.value.length==0?(n(),a(D,{key:0,class:"empty-box"},{image:c(()=>[u(d,{class:"icon",name:"emptyHistory"}),s("div",Ce,i(t.$t("noRecord")),1)]),_:1})):(n(),a(B,{key:1,loading:p.value,"onUpdate:loading":o[3]||(o[3]=e=>p.value=e),"loading-text":t.$t("loading"),finished:M.value,"finished-text":t.$t("noMore"),error:v.value,"onUpdate:error":o[4]||(o[4]=e=>v.value=e),"error-text":t.$t("errorText"),onLoad:F},{default:c(()=>[(n(!0),k(b,null,G(m.value,e=>(n(),a(N,{class:"send-item item",key:e,onClick:w=>X(e)},{title:c(()=>[s("div",$e,[u(Q,{chainIcon:r(O)(e.contractChain),tokenIcon:r(J)(e.contractChain.toLowerCase(),e.contractAddress.toLowerCase())},null,8,["chainIcon","tokenIcon"]),s("div",we,[s("div",null,[g(i(r(V)(e.creatorAddress)),1),u(d,{class:"copy-icon",name:"copy",onClick:ce(w=>r(K)(e.creatorAddress),["stop"])},null,8,["onClick"])]),s("div",be,[e.type==0?(n(),a(d,{key:0,class:"type-icon",name:"pin"})):(n(),a(d,{key:1,class:"type-icon",name:"pu"})),g(" "+i(r(W)(e.createTime).format("YYYY-MM-DD HH:mm")),1)])])])]),value:c(()=>[s("div",Le,[s("div",Ie,[e.refundTx!=""||e.unlockTx!=""?(n(),k(b,{key:0},[r(C).language=="en"?(n(),a(d,{key:0,class:"type-icon",name:"endEn"})):(n(),a(d,{key:1,class:"type-icon",name:"endCn"}))],64)):(n(),k(b,{key:1},[r(C).language=="en"?(n(),a(d,{key:0,class:"type-icon",name:"goingEn"})):(n(),a(d,{key:1,class:"type-icon",name:"goingCn"}))],64))]),s("div",Ae,[s("div",null,i(e.totalAmount+" "+e.symbol),1),s("div",He,[g(i(t.$t("received"))+" "+i(e.receivedCount),1),Te,g(i(e.count),1)])])])]),_:2},1032,["onClick"]))),128))]),_:1},8,["loading","loading-text","finished","finished-text","error","error-text"]))]),_:1},8,["modelValue","pulling-text","loosing-text","loading-text"])]),_:1},8,["title"]),u(ne,{show:U.value,"onUpdate:show":o[6]||(o[6]=e=>U.value=e),actions:S.value,"cancel-text":"\u53D6\u6D88",description:_.creatorAddress,"close-on-click-action":"",onSelect:Z},null,8,["show","actions","description"])]),_:1},8,["active"])}}},Ye=ue(Ue,[["__scopeId","data-v-caafdd70"]]);export{Ye as default};
