import{r as h,o as u,c as y,w as o,a as l,t as s,b as k,d as te,F as Q,e as b,u as p,f as me,g as n,h as fe,i as pe,j as Ne,k as Be,l as Ue,m as ze,n as c,p as J,q as Fe,s as R,v as M,T,B as ne,x as He,y as ve,z as Ee,A as Re,C as We,D as xe}from"./index.c421df51.js";import{_ as S}from"./SvgIcon.a948d13e.js";import{_ as he}from"./plugin-vueexport-helper.2444895f.js";const je={class:"title"},qe={class:"body"},Je={class:"status-text"},Me={key:0},Qe={key:1},Ge={key:2},Ke={key:3},Oe={class:"status-icon"},Xe={class:"tx"},Ye={key:1,class:"trade-hash"},Ze={__name:"ChainTrade",props:{tradeVisable:{type:Boolean,default:!1},status:{type:Number,default:0},tradeHash:{type:String,default:""}},emits:["update:tradeVisable"],setup(m,{emit:le}){return(i,v)=>{const z=h("van-loading"),D=h("van-icon"),F=h("van-popup");return u(),y(F,{class:"dialog",show:m.tradeVisable,"onUpdate:show":v[1]||(v[1]=C=>pe(tradeVisable)?tradeVisable.value=C:null),round:"","close-on-click-overlay":!1},{default:o(()=>[l("div",je,s(i.$t("transactionDetails")),1),l("div",qe,[l("div",Je,[m.status!=0?(u(),k(Q,{key:0},[m.status==1?(u(),k("div",Me,s(i.$t("sendingTransactionToBlockchain")),1)):m.status==2?(u(),k("div",Qe,s(i.$t("waitingForServiceSyncronizing")),1)):m.status==-1?(u(),k("div",Ge,s(i.$t("sendTransactionToBlockchainFailed")),1)):m.status==-2?(u(),k("div",Ke,s(i.$t("servicesyncronizingTimeout")),1)):te("",!0)],64)):te("",!0)]),l("div",Oe,[m.status==1||m.status==2?(u(),y(z,{key:0,type:"spinner",size:"48px"})):m.status==0?(u(),y(D,{key:1,color:"#07c160",size:"40px",name:"checked"})):m.status==-1||m.status==-2?(u(),y(D,{key:2,color:"#FA5151",size:"40px",name:"clear"})):te("",!0)]),m.tradeHash?(u(),k("div",{key:0,class:"trade-hash",onClick:v[0]||(v[0]=C=>p(fe)(m.tradeHash))},[b(s(i.$t("txHash"))+": ",1),l("span",Xe,s(p(me)(m.tradeHash)),1),n(S,{name:"copy"})])):(u(),k("div",Ye,s(i.$t("txHash"))+": N/A",1))])]),_:1},8,["show"])}}},ea=he(Ze,[["__scopeId","data-v-1c06e15b"]]);const aa=m=>(We("data-v-be841121"),m=m(),xe(),m),ta={class:"body"},na={class:"tools-bar"},la={key:0,class:"address"},sa={class:"address-text"},oa={class:"tools"},ia={class:"token"},ua={class:"token-symbol"},ca={class:"amount"},da={style:{"margin-left":"4px"}},ra=aa(()=>l("svg",{class:"icon","aria-hidden":"true"},[l("use",{"xlink:href":"#icon-redPacket"})],-1)),va={key:0},ma={key:1,class:"image-box"},fa={class:"form-item total-amount"},pa={class:"form-item create"},ha={class:"content"},ga={class:"content"},ka={class:"success-icon"},ba={class:"title"},ya={class:"text"},wa={class:"btn"},_a={class:"content"},$a={__name:"Index",setup(m){const le=Ne(),i=Be(),{t:v}=Ue(),z=ze("global"),D=c(!1),F=c(!1),C=c(!1),W=c(!1),I=c(0),P=c(""),N=c(""),L=c("");c("");const G=c(""),K=c(""),se=c(null),H=c("");console.log(i.chainId);const ge=J(()=>I.value==0?P.value?P.value:"0.00":N.value&&L.value?ne(Number(N.value)).multipliedBy(Number(L.value)).toNumber().toString():"0.00"),w=c(!1),$=c(0),B=c(""),O=c(!1),x=c(!1),X=c(""),Y=c(!1),ke=J(()=>[{name:v("languages.zh-cn"),value:"zh-cn",color:i.language==="zh-cn"?"#9505F9":"#323233"},{name:v("languages.en"),value:"en",color:i.language==="en"?"#9505F9":"#323233"}]);function be(e){i.setLanguage(e.value)}const oe=c([]),d=Fe({symbol:"",icon:"",amount:0,address:"",chain:"",chainId:-1}),E=c(!1),ye=J(()=>[{text:v("deadlineList.300"),value:300},{text:v("deadlineList.600"),value:600},{text:v("deadlineList.1800"),value:1800},{text:v("deadlineList.3600"),value:3600},{text:v("deadlineList.43200"),value:43200},{text:v("deadlineList.86400"),value:86400}]),j=c(300),Z=J(()=>v("deadlineList."+j.value));function we(e){j.value=e.value,E.value=!1}function _e(e,a){console.log(e),$e(e)}function $e(e,a){let f=new FileReader;f.readAsDataURL(e),f.onloadend=function(r){let U=r.target.result,_=new Image;_.src=U,_.onload=function(){let g=Re(_,e.name,e.type);console.log(g),K.value=g.base64Data,se.value=g.fileData}}}async function Ce(){i.chainId;{oe.value=[{symbol:"JF",icon:"https://static.debank.com/image/bsc_token/logo_url/0x5fac926bf1e638944bb16fb5b787b5ba4bc85b0a/74d0d0f5a5fcf76ab35b89b29cb9c95e.png",amount:9999999,address:"0x227A05695F10B591731Fd925396b548a45067798",chain:"bsc",chainId:97}];return}}function Ae(e){d.symbol=e.symbol,d.icon=e.icon,d.amount=e.amount,d.address=e.address,d.chain=e.chain,d.chainId=e.chainId,W.value=!1}async function ie(){await i.connectWallet(),await ce()}function ue(){return z.cfg.allowChainList.map(a=>a.chainId).includes(i.chainId)?!0:(Y.value=!0,!1)}async function Ve(){w.value=!1,B.value="",$.value=1,w.value=!0;try{let e=await R.wallet.approveMaxAmount(d.address,i.redPacketContractAddress);console.log(e),C.value=!1,B.value=e.hash,$.value=0}catch{$.value=-1,await M(2e3)}finally{w.value=!1}}async function ce(){await R.wallet.isAllowanceEnough(i.redPacketContractAddress,d.address,i.walletAddress)?C.value=!1:C.value=!0}async function Se(){O.value=!0,await Ie(),O.value=!1}async function Ie(){if(console.log("createRedPacket"),w.value=!1,B.value="",x.value=!1,X.value="",!d.address){T.fail(v("pleaseSelectToken"));return}if(I.value==0){if(!P.value){T.fail(v("pleaseEnterTotalAmount"));return}}else if(!N.value){T.fail(v("pleaseEnterSingleAmount"));return}if(!L.value){T.fail(v("pleaseEnterQuantity"));return}let e;if(I.value==0?e=ne(Number(P.value)).toNumber():e=ne(Number(N.value)).multipliedBy(Number(L.value)).toNumber(),H.value||(H.value=v("bestWishes")),await i.connectWallet(),!ue())return;if(i.chainId!=d.chainId){T("\u7F51\u7EDC\u9519\u8BEF,\u8BF7\u5207\u6362\u81F3\u5E01\u79CD\u7684\u7F51\u7EDC");try{await R.wallet.switchNetwork(d.chainId)}catch(r){console.log(r);return}return}if(await ce(),C.value){T.fail("\u8BF7\u5148Approve");return}$.value=1,w.value=!0;let f;try{let r=await R.wallet.sendRedPacket(i.redPacketContractAddress,d.address,I.value,e.toString(),L.value,j.value);console.dir(r),B.value=r.hash,f=await r.wait(),console.dir(f),B.value=f.transactionHash}catch(r){console.log(r),$.value=-1,await M(1e3),w.value=!1;return}$.value=2;try{let r=f==null?void 0:f.events,U={};for(let A=r.length-1;A>=0;A--){let V=r[A].topics.some(ee=>ee==="0x694af1cc8727cdd0afbdd53d9b87b69248bd490224e9dd090e788546506e076f");if(r[A].address==i.redPacketContractAddress&&V){U=r[A];break}}let _=await R.redPacket.send(d.address,d.chain,U.topics[1],f.transactionHash,j.value,se.value,H.value,d.symbol,G.value);console.dir(_),$.value=0,await M(500),w.value=!1;const g=_.data.uuid;x.value=!0,X.value=window.location.origin+"/redpacket/"+g}catch(r){console.log(r),$.value=-1,await M(1e3),w.value=!1}}async function Le(){i.isConnectWallet?ue()&&(await Ce(),W.value=!0):T.fail(v("pleaseConnectWallet"))}const de=z.cfg.allowChainList.map(e=>e.chainShow);function re(e){const a=z.cfg.allowChainList.find(r=>r.chainId==e);let f;return a?f=a.chain:f=null,f}return(e,a)=>{const f=h("van-icon"),r=h("van-radio"),U=h("van-radio-group"),_=h("van-cell"),g=h("van-cell-group"),A=h("van-action-sheet"),V=h("van-field"),ee=h("van-picker"),Te=h("van-popup"),De=h("van-image"),Pe=h("van-uploader"),q=h("van-button"),ae=h("van-dialog");return u(),k(Q,null,[l("div",ta,[l("div",na,[p(i).isConnectWallet?(u(),k("div",la,[re(p(i).chainId)?(u(),y(f,{key:0,class:"chain-icon",name:p(He)(re(p(i).chainId))},null,8,["name"])):(u(),y(S,{key:1,class:"chain-icon",name:"wallet"})),l("div",sa,s(p(me)(p(i).walletAddress)),1)])):(u(),k("div",{key:1,class:"address",onClick:ie},[n(S,{name:"wallet"}),l("div",null,s(e.$t("pleaseConnectWallet")),1)])),l("div",oa,[n(S,{name:"language",onClick:a[0]||(a[0]=t=>F.value=!0)}),n(S,{name:"help",onClick:a[1]||(a[1]=t=>D.value=!0)})])]),n(U,{modelValue:I.value,"onUpdate:modelValue":a[2]||(a[2]=t=>I.value=t),direction:"horizontal",class:"type form-item"},{default:o(()=>[n(r,{name:0,"checked-color":"#ED4A4A","icon-size":"16px"},{default:o(()=>[b(s(e.$t("randomAmount")),1)]),_:1}),n(r,{name:1,"checked-color":"#ED4A4A","icon-size":"16px"},{default:o(()=>[b(s(e.$t("identicalAmount")),1)]),_:1})]),_:1},8,["modelValue"]),n(g,{inset:"",class:"form-item form-normal"},{default:o(()=>[n(_,{title:e.$t("token"),"is-link":"",onClick:Le},ve({_:2},[d.address?{name:"value",fn:o(()=>[l("div",null,[n(f,{name:d.icon},null,8,["name"]),b(" "+s(d.symbol),1)])]),key:"0"}:void 0]),1032,["title"]),n(A,{show:W.value,"onUpdate:show":a[3]||(a[3]=t=>W.value=t),title:e.$t("settingToken")},{default:o(()=>[l("div",ia,[n(g,{inset:""},{default:o(()=>[(u(!0),k(Q,null,Ee(oe.value,t=>(u(),y(_,{key:t.address,clickable:"",onClick:Ca=>Ae(t)},{title:o(()=>[l("div",ua,[n(f,{class:"symbol-icon",name:d.icon},null,8,["name"]),l("span",null,s(t.symbol),1)])]),value:o(()=>[l("div",null,[l("span",null,s(e.$t("balance"))+": "+s(t.amount),1),b("\xA0\xA0 ")])]),_:2},1032,["onClick"]))),128))]),_:1})])]),_:1},8,["show","title"])]),_:1}),I.value==0?(u(),y(g,{key:0,inset:"",class:"form-item form-normal"},{default:o(()=>[n(V,{label:e.$t("totalAmount"),"input-align":"right",placeholder:e.$t("enterAmount"),type:"number",modelValue:P.value,"onUpdate:modelValue":a[4]||(a[4]=t=>P.value=t)},{"left-icon":o(()=>[n(S,{name:"pin"})]),_:1},8,["label","placeholder","modelValue"])]),_:1})):(u(),y(g,{key:1,inset:"",class:"form-item form-normal"},{default:o(()=>[n(V,{label:e.$t("singleAmount"),"input-align":"right",placeholder:e.$t("enterAmount"),type:"number",modelValue:N.value,"onUpdate:modelValue":a[5]||(a[5]=t=>N.value=t)},{"left-icon":o(()=>[n(S,{name:"pu"})]),_:1},8,["label","placeholder","modelValue"])]),_:1})),l("div",ca,[b(s(e.$t("availableBalance")),1),l("span",da,s(d.amount+" "+d.symbol),1)]),n(g,{inset:"",class:"form-item form-normal"},{default:o(()=>[n(V,{label:e.$t("quantity"),"input-align":"right",placeholder:e.$t("enterNumber"),type:"digit",modelValue:L.value,"onUpdate:modelValue":a[6]||(a[6]=t=>L.value=t)},ve({"left-icon":o(()=>[ra]),_:2},[p(i).language=="zh-cn"?{name:"right-icon",fn:o(()=>[b("\u4E2A")]),key:"0"}:void 0]),1032,["label","placeholder","modelValue"])]),_:1}),n(g,{inset:"",class:"form-item form-normal"},{default:o(()=>[n(V,{modelValue:p(Z),"onUpdate:modelValue":a[7]||(a[7]=t=>pe(Z)?Z.value=t:null),"is-link":"",readonly:"",name:"picker",label:e.$t("deadline"),onClick:a[8]||(a[8]=t=>E.value=!0),"input-align":"right"},null,8,["modelValue","label"]),n(Te,{show:E.value,"onUpdate:show":a[10]||(a[10]=t=>E.value=t),position:"bottom"},{default:o(()=>[n(ee,{columns:p(ye),onCancel:a[9]||(a[9]=t=>E.value=!1),onConfirm:we,title:e.$t("settingDeadline"),"confirm-button-text":e.$t("confirm"),"cancel-button-text":e.$t("cancel")},null,8,["columns","title","confirm-button-text","cancel-button-text"])]),_:1},8,["show"])]),_:1}),n(g,{inset:"",class:"form-item form-normal"},{default:o(()=>[n(Pe,{class:"uploader-box","before-read":_e,"max-size":1024*1024,"preview-image":!1,accept:"image/*"},{default:o(()=>[n(_,{class:"uploader-content","is-link":"",title:e.$t("redPacketCover")},{value:o(()=>[K.value?(u(),k("div",ma,[n(De,{class:"image",fit:"contain",src:K.value},null,8,["src"])])):(u(),k("div",va,s(e.$t("selectPicture")),1))]),_:1},8,["title"])]),_:1})]),_:1}),n(g,{inset:"",class:"form-item"},{default:o(()=>[n(V,{modelValue:H.value,"onUpdate:modelValue":a[11]||(a[11]=t=>H.value=t),rows:"1",autosize:"",type:"textarea",maxlength:"20",placeholder:e.$t("bestWishes"),"show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1}),n(g,{inset:"",class:"form-item"},{default:o(()=>[n(V,{modelValue:G.value,"onUpdate:modelValue":a[12]||(a[12]=t=>G.value=t),rows:"2",autosize:"",type:"textarea",maxlength:"500",placeholder:e.$t("ActivityDescription")},null,8,["modelValue","placeholder"])]),_:1}),l("div",fa,[b(s(e.$t("redPacketTotalAmount")),1),l("span",null,s(p(ge)),1),b(s(d.symbol),1)]),l("div",pa,[p(i).isConnectWallet?(u(),k(Q,{key:0},[C.value?(u(),y(q,{key:0,class:"create-btn",type:"danger",onClick:Ve},{default:o(()=>[b(s(e.$t("approve")),1)]),_:1})):(u(),y(q,{key:1,class:"create-btn",type:"danger",onClick:Se,loading:O.value},{default:o(()=>[b(s(e.$t("createRedPacketBtn")),1)]),_:1},8,["loading"]))],64)):(u(),y(q,{key:1,class:"create-btn",type:"primary",onClick:ie},{default:o(()=>[b(s(e.$t("connectWallet")),1)]),_:1}))]),l("div",{class:"form-item history",onClick:a[13]||(a[13]=t=>p(le).push("/history"))},s(e.$t("redPacketHistory")),1)]),n(ae,{class:"help-dialog",show:D.value,"onUpdate:show":a[14]||(a[14]=t=>D.value=t),title:e.$t("rulesDescription"),"confirm-button-text":e.$t("understand"),"close-on-click-overlay":""},{default:o(()=>[l("div",ha,[l("div",null,s(e.$t("rulesDescription1")),1),l("div",null,s(e.$t("rulesDescription2")),1),l("div",null,s(e.$t("rulesDescription3")),1),l("div",null,s(e.$t("rulesDescription4")),1),l("div",null,s(e.$t("rulesDescription5",{chains:p(de).join("/")})),1)])]),_:1},8,["show","title","confirm-button-text"]),n(ae,{class:"create-success-dialog",show:x.value,"onUpdate:show":a[16]||(a[16]=t=>x.value=t),"close-on-click-overlay":""},{footer:o(()=>[l("div",wa,[n(q,{class:"copy-btn",type:"primary",onClick:a[15]||(a[15]=t=>p(fe)(X.value))},{default:o(()=>[b(s(e.$t("copyLink")),1)]),_:1})])]),default:o(()=>[l("div",ga,[l("div",ka,[n(S,{name:"createSuccess"})]),l("div",ba,s(e.$t("createRedPacketSuccess")),1),l("div",ya,s(e.$t("shareLink")),1)])]),_:1},8,["show"]),n(A,{show:F.value,"onUpdate:show":a[17]||(a[17]=t=>F.value=t),title:e.$t("switchLang"),actions:p(ke),closeable:!1,"cancel-text":e.$t("cancel"),"close-on-click-action":"",onSelect:be},null,8,["show","title","actions","cancel-text"]),n(ea,{tradeVisable:w.value,"onUpdate:tradeVisable":a[18]||(a[18]=t=>w.value=t),status:$.value,tradeHash:B.value},null,8,["tradeVisable","status","tradeHash"]),n(ae,{class:"chain-err-dialog",confirmButtonText:e.$t("understand"),confirmButtonColor:"#3F80F7",show:Y.value,"onUpdate:show":a[19]||(a[19]=t=>Y.value=t)},{default:o(()=>[l("div",_a,[l("div",null,s(e.$t("notSupportedChain")),1),l("div",null,s(e.$t("pleaseSwitchTo",{chains:p(de).join("\u3001")})),1)])]),_:1},8,["confirmButtonText","show"])],64)}}},Ia=he($a,[["__scopeId","data-v-be841121"]]);export{Ia as default};
