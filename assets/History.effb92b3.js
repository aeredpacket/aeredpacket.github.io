import{j as ie,k as ce,l as re,m as de,n as l,D as ue,r as f,o as n,c as a,w as c,T as Y,s as O,g as u,a as s,t as i,b as _,E as q,u as r,x as J,G as K,e as g,f as M,h as Q,F as A,H as ve,A as pe,C as fe}from"./index.981c5519.js";import{T as W}from"./TokenIcon.4af09b87.js";import{_ as d}from"./SvgIcon.9973517c.js";import{d as X}from"./dayjs.min.e32777ad.js";import{_ as ge}from"./plugin-vueexport-helper.2444895f.js";const he=w=>(pe("data-v-3450ef99"),w=w(),fe(),w),ke={class:"text"},ye={class:"item-left"},_e={class:"left-content"},me={class:"bottom-text"},xe={class:"item-right"},Ce={key:0,class:"bottom-text"},we=["onClick"],$e={key:1,class:"bottom-text"},be=["onClick"],Le={class:"text"},Ie={class:"item-left"},Ae={class:"left-content"},He={class:"bottom-text"},Se={class:"item-right"},Te={class:"status-icon"},Ue={class:"content"},Re={class:"bottom-text"},Ve=he(()=>s("span",null,"/",-1)),Fe={__name:"History",setup(w){const H=ie(),$=ce(),{t:m}=re(),Z=de("global"),h=l(0),b=l(20),k=l([]),S=l(1),T=l(!1),D=l(!1),x=l([]),U=l(1),R=l(!1),B=l(!1),v=l(!1),p=l(!1),V=l(!1),F=l([]),y=ue({creatorAddress:"",showLuckUrl:"",redPacketUrl:""});function ee(t){V.value=!0,t.refundTx==""&&t.unlockTx==""?F.value=[{name:m("continueShare"),value:"0",color:"#3F80F7"},{name:m("seeLuck"),value:"1"}]:F.value=[{name:m("seeLuck"),value:"1"}],y.creatorAddress=m("redPacketSend",{user:M(t.creatorAddress)}),y.showLuckUrl="/redpacket/"+t.uuid+"/showLuck",y.redPacketUrl="/redpacket/"+t.uuid}function te(t){t.value==0?H.push(y.redPacketUrl):t.value==1&&H.push(y.showLuckUrl)}function oe(t,o){let C=Z.cfg.allowChainList.find(L=>L.chain==t);C?window.open(C.txNetwork+o,"_blank"):Y(m("unsupportedNetwork"))}function ne(){se()}function E(){h.value==0?(S.value=1,k.value=[],N()):h.value==1&&(U.value=1,x.value=[],P())}function se(){console.log(111),h.value==0?N():h.value==1&&P()}async function N(){v.value=!0;let t=Y.loading({message:"Loading...",forbidClick:!0,duration:0});try{const o=await O.redPacket.getReceiveHistory($.walletAddress,b.value,S.value);console.log(o),o.status==1?(console.log(k),k.value=k.value.concat(o.data.list),o.data.list.length<b.value?D.value=!0:S.value++):(console.log("fail"),p.value=!0)}catch(o){console.log(o),p.value=!0}finally{t.clear(),T.value=!1,v.value=!1}}async function P(){v.value=!0;let t=Y.loading({message:"Loading...",forbidClick:!0,duration:0});try{const o=await O.redPacket.getSendHistory($.walletAddress,b.value,U.value);console.log(o),o.status==1?(x.value=x.value.concat(o.data.list),o.data.list.length<b.value?B.value=!0:U.value++):(console.log("fail"),p.value=!0)}catch(o){console.log(o),p.value=!1}finally{t.clear(),R.value=!1,v.value=!1}}return(t,o)=>{const C=f("van-empty"),L=f("van-cell"),j=f("van-list"),z=f("van-pull-refresh"),G=f("van-tab"),ae=f("van-action-sheet"),le=f("van-tabs");return n(),a(le,{class:"history",active:h.value,"onUpdate:active":o[7]||(o[7]=e=>h.value=e),onRendered:ne},{default:c(()=>[u(G,{class:"tab-top",title:t.$t("ireceived")},{default:c(()=>[u(z,{modelValue:T.value,"onUpdate:modelValue":o[2]||(o[2]=e=>T.value=e),"pulling-text":t.$t("pulling"),"loosing-text":t.$t("loosing"),"loading-text":t.$t("loading"),onRefresh:E},{default:c(()=>[k.value.length==0?(n(),a(C,{key:0,class:"empty-box"},{image:c(()=>[u(d,{class:"icon",name:"emptyHistory"}),s("div",ke,i(t.$t("noRecord")),1)]),_:1})):(n(),a(j,{key:1,loading:v.value,"onUpdate:loading":o[0]||(o[0]=e=>v.value=e),"loading-text":t.$t("loading"),finished:D.value,"finished-text":t.$t("noMore"),error:p.value,"onUpdate:error":o[1]||(o[1]=e=>p.value=e),"error-text":t.$t("errorText"),onLoad:N},{default:c(()=>[(n(!0),_(A,null,q(k.value,e=>(n(),a(L,{class:"receive-item item",key:e},{title:c(()=>[s("div",ye,[u(W,{chainIcon:r(J)(e.contractChain),tokenIcon:r(K)(e.contractChain.toLowerCase(),e.contractAddress.toLowerCase())},null,8,["chainIcon","tokenIcon"]),s("div",_e,[s("div",null,[g(i(r(M)(e.userAddress)),1),u(d,{class:"copy-icon",name:"copy",onClick:I=>r(Q)(e.userAddress)},null,8,["onClick"])]),s("div",me,[e.type==0?(n(),a(d,{key:0,class:"type-icon",name:"pin"})):(n(),a(d,{key:1,class:"type-icon",name:"pu"})),g(" "+i(r(X).unix(e.time).format("YYYY-MM-DD HH:mm")),1)])])])]),value:c(()=>[s("div",xe,[s("div",null,i(e.amount)+" "+i(e.symbol),1),e.tx?(n(),_("div",Ce,[s("span",{onClick:I=>oe(e.contractChain,e.tx)},[g(i(t.$t("blockChainBrowser")),1),u(d,{class:"share-icon",name:"share"})],8,we)])):(n(),_("div",$e,[s("span",{onClick:I=>r(H).push(`/redpacket/${e.uuid}/showLuck`)},i(t.$t("seeLuck")),9,be)]))])]),_:2},1024))),128))]),_:1},8,["loading","loading-text","finished","finished-text","error","error-text"]))]),_:1},8,["modelValue","pulling-text","loosing-text","loading-text"])]),_:1},8,["title"]),u(G,{title:t.$t("isend")},{default:c(()=>[u(z,{modelValue:R.value,"onUpdate:modelValue":o[5]||(o[5]=e=>R.value=e),"pulling-text":t.$t("pulling"),"loosing-text":t.$t("loosing"),"loading-text":t.$t("loading"),onRefresh:E},{default:c(()=>[x.value.length==0?(n(),a(C,{key:0,class:"empty-box"},{image:c(()=>[u(d,{class:"icon",name:"emptyHistory"}),s("div",Le,i(t.$t("noRecord")),1)]),_:1})):(n(),a(j,{key:1,loading:v.value,"onUpdate:loading":o[3]||(o[3]=e=>v.value=e),"loading-text":t.$t("loading"),finished:B.value,"finished-text":t.$t("noMore"),error:p.value,"onUpdate:error":o[4]||(o[4]=e=>p.value=e),"error-text":t.$t("errorText"),onLoad:P},{default:c(()=>[(n(!0),_(A,null,q(x.value,e=>(n(),a(L,{class:"send-item item",key:e,onClick:I=>ee(e)},{title:c(()=>[s("div",Ie,[u(W,{chainIcon:r(J)(e.contractChain),tokenIcon:r(K)(e.contractChain.toLowerCase(),e.contractAddress.toLowerCase())},null,8,["chainIcon","tokenIcon"]),s("div",Ae,[s("div",null,[g(i(r(M)(e.creatorAddress)),1),u(d,{class:"copy-icon",name:"copy",onClick:ve(I=>r(Q)(e.creatorAddress),["stop"])},null,8,["onClick"])]),s("div",He,[e.type==0?(n(),a(d,{key:0,class:"type-icon",name:"pin"})):(n(),a(d,{key:1,class:"type-icon",name:"pu"})),g(" "+i(r(X)(e.createTime).format("YYYY-MM-DD HH:mm")),1)])])])]),value:c(()=>[s("div",Se,[s("div",Te,[e.refundTx!=""||e.unlockTx!=""?(n(),_(A,{key:0},[r($).language=="en"?(n(),a(d,{key:0,class:"type-icon",name:"endEn"})):(n(),a(d,{key:1,class:"type-icon",name:"endCn"}))],64)):(n(),_(A,{key:1},[r($).language=="en"?(n(),a(d,{key:0,class:"type-icon",name:"goingEn"})):(n(),a(d,{key:1,class:"type-icon",name:"goingCn"}))],64))]),s("div",Ue,[s("div",null,i(e.totalAmount+" "+e.symbol),1),s("div",Re,[g(i(t.$t("received"))+" "+i(e.receivedCount),1),Ve,g(i(e.count),1)])])])]),_:2},1032,["onClick"]))),128))]),_:1},8,["loading","loading-text","finished","finished-text","error","error-text"]))]),_:1},8,["modelValue","pulling-text","loosing-text","loading-text"])]),_:1},8,["title"]),u(ae,{show:V.value,"onUpdate:show":o[6]||(o[6]=e=>V.value=e),actions:F.value,"cancel-text":t.$t("cancel"),description:y.creatorAddress,"close-on-click-action":"",onSelect:te},null,8,["show","actions","cancel-text","description"])]),_:1},8,["active"])}}},Be=ge(Fe,[["__scopeId","data-v-3450ef99"]]);export{Be as default};
