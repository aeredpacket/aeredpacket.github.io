import{j as ie,k as ce,l as re,m as de,n as l,q as ue,E as ve,r as f,o as n,c as a,w as c,T as Y,s as O,g as u,a as s,t as i,b as _,z as J,u as r,x as K,G as Q,e as g,f as M,h as W,F as A,H as pe,C as fe,D as ge}from"./index.8cb2acc9.js";import{T as X,d as Z}from"./dayjs.min.2b00bb98.js";import{_ as d}from"./SvgIcon.fa87aee0.js";import{_ as he}from"./plugin-vueexport-helper.2444895f.js";const ke=b=>(fe("data-v-17bc3dff"),b=b(),ge(),b),ye={class:"text"},_e={class:"item-left"},me={class:"left-content"},xe={class:"bottom-text"},Ce={class:"item-right"},we={key:0,class:"bottom-text"},be=["onClick"],$e={key:1,class:"bottom-text"},Le=["onClick"],Ie={class:"text"},Ae={class:"item-left"},He={class:"left-content"},Se={class:"bottom-text"},Te={class:"item-right"},Ue={class:"status-icon"},Re={class:"content"},Ve={class:"bottom-text"},Fe=ke(()=>s("span",null,"/",-1)),Ne={__name:"History",setup(b){const H=ie(),m=ce(),{t:x}=re(),ee=de("global"),h=l(0),$=l(20),k=l([]),S=l(1),T=l(!1),D=l(!1),C=l([]),U=l(1),R=l(!1),B=l(!1),v=l(!1),p=l(!1),V=l(!1),F=l([]),y=ue({creatorAddress:"",showLuckUrl:"",redPacketUrl:""});ve(()=>m.walletAddress,async(t,o)=>{console.log("newVal:"+t),j()});function te(t){V.value=!0,t.refundTx==""&&t.unlockTx==""?F.value=[{name:x("continueShare"),value:"0",color:"#3F80F7"},{name:x("seeLuck"),value:"1"}]:F.value=[{name:x("seeLuck"),value:"1"}],y.creatorAddress=x("redPacketSend",{user:M(t.creatorAddress)}),y.showLuckUrl="/redpacket/"+t.uuid+"/showLuck",y.redPacketUrl="/redpacket/"+t.uuid}function oe(t){t.value==0?H.push(y.redPacketUrl):t.value==1&&H.push(y.showLuckUrl)}function ne(t,o){let w=ee.cfg.allowChainList.find(L=>L.chain==t);w?window.open(w.txNetwork+o,"_blank"):Y(x("unsupportedNetwork"))}function se(){j()}function E(){h.value==0?(S.value=1,k.value=[],N()):h.value==1&&(U.value=1,C.value=[],P())}function j(){console.log(111),h.value==0?N():h.value==1&&P()}async function N(){v.value=!0;let t=Y.loading({message:"Loading...",forbidClick:!0,duration:0});try{const o=await O.redPacket.getReceiveHistory(m.walletAddress,$.value,S.value);console.log(o),o.status==1?(console.log(k),k.value=k.value.concat(o.data.list),o.data.list.length<$.value?D.value=!0:S.value++):(console.log("fail"),p.value=!0)}catch(o){console.log(o),p.value=!0}finally{t.clear(),T.value=!1,v.value=!1}}async function P(){v.value=!0;let t=Y.loading({message:"Loading...",forbidClick:!0,duration:0});try{const o=await O.redPacket.getSendHistory(m.walletAddress,$.value,U.value);console.log(o),o.status==1?(C.value=C.value.concat(o.data.list),o.data.list.length<$.value?B.value=!0:U.value++):(console.log("fail"),p.value=!0)}catch(o){console.log(o),p.value=!1}finally{t.clear(),R.value=!1,v.value=!1}}return(t,o)=>{const w=f("van-empty"),L=f("van-cell"),z=f("van-list"),q=f("van-pull-refresh"),G=f("van-tab"),ae=f("van-action-sheet"),le=f("van-tabs");return n(),a(le,{class:"history",active:h.value,"onUpdate:active":o[7]||(o[7]=e=>h.value=e),onRendered:se},{default:c(()=>[u(G,{class:"tab-top",title:t.$t("ireceived")},{default:c(()=>[u(q,{modelValue:T.value,"onUpdate:modelValue":o[2]||(o[2]=e=>T.value=e),"pulling-text":t.$t("pulling"),"loosing-text":t.$t("loosing"),"loading-text":t.$t("loading"),onRefresh:E},{default:c(()=>[k.value.length==0?(n(),a(w,{key:0,class:"empty-box"},{image:c(()=>[u(d,{class:"icon",name:"emptyHistory"}),s("div",ye,i(t.$t("noRecord")),1)]),_:1})):(n(),a(z,{key:1,loading:v.value,"onUpdate:loading":o[0]||(o[0]=e=>v.value=e),"loading-text":t.$t("loading"),finished:D.value,"finished-text":t.$t("noMore"),error:p.value,"onUpdate:error":o[1]||(o[1]=e=>p.value=e),"error-text":t.$t("errorText"),onLoad:N},{default:c(()=>[(n(!0),_(A,null,J(k.value,e=>(n(),a(L,{class:"receive-item item",key:e},{title:c(()=>[s("div",_e,[u(X,{chainIcon:r(K)(e.contractChain),tokenIcon:r(Q)(e.contractChain.toLowerCase(),e.contractAddress.toLowerCase())},null,8,["chainIcon","tokenIcon"]),s("div",me,[s("div",null,[g(i(r(M)(e.userAddress)),1),u(d,{class:"copy-icon",name:"copy",onClick:I=>r(W)(e.userAddress)},null,8,["onClick"])]),s("div",xe,[e.type==0?(n(),a(d,{key:0,class:"type-icon",name:"pin"})):(n(),a(d,{key:1,class:"type-icon",name:"pu"})),g(" "+i(r(Z).unix(e.time).format("YYYY-MM-DD HH:mm")),1)])])])]),value:c(()=>[s("div",Ce,[s("div",null,i(e.amount)+" "+i(e.symbol),1),e.tx?(n(),_("div",we,[s("span",{onClick:I=>ne(e.contractChain,e.tx)},[g(i(t.$t("blockChainBrowser")),1),u(d,{class:"share-icon",name:"share"})],8,be)])):(n(),_("div",$e,[s("span",{onClick:I=>r(H).push(`/redpacket/${e.uuid}/showLuck`)},i(t.$t("seeLuck")),9,Le)]))])]),_:2},1024))),128))]),_:1},8,["loading","loading-text","finished","finished-text","error","error-text"]))]),_:1},8,["modelValue","pulling-text","loosing-text","loading-text"])]),_:1},8,["title"]),u(G,{title:t.$t("isend")},{default:c(()=>[u(q,{modelValue:R.value,"onUpdate:modelValue":o[5]||(o[5]=e=>R.value=e),"pulling-text":t.$t("pulling"),"loosing-text":t.$t("loosing"),"loading-text":t.$t("loading"),onRefresh:E},{default:c(()=>[C.value.length==0?(n(),a(w,{key:0,class:"empty-box"},{image:c(()=>[u(d,{class:"icon",name:"emptyHistory"}),s("div",Ie,i(t.$t("noRecord")),1)]),_:1})):(n(),a(z,{key:1,loading:v.value,"onUpdate:loading":o[3]||(o[3]=e=>v.value=e),"loading-text":t.$t("loading"),finished:B.value,"finished-text":t.$t("noMore"),error:p.value,"onUpdate:error":o[4]||(o[4]=e=>p.value=e),"error-text":t.$t("errorText"),onLoad:P},{default:c(()=>[(n(!0),_(A,null,J(C.value,e=>(n(),a(L,{class:"send-item item",key:e,onClick:I=>te(e)},{title:c(()=>[s("div",Ae,[u(X,{chainIcon:r(K)(e.contractChain),tokenIcon:r(Q)(e.contractChain.toLowerCase(),e.contractAddress.toLowerCase())},null,8,["chainIcon","tokenIcon"]),s("div",He,[s("div",null,[g(i(r(M)(e.creatorAddress)),1),u(d,{class:"copy-icon",name:"copy",onClick:pe(I=>r(W)(e.creatorAddress),["stop"])},null,8,["onClick"])]),s("div",Se,[e.type==0?(n(),a(d,{key:0,class:"type-icon",name:"pin"})):(n(),a(d,{key:1,class:"type-icon",name:"pu"})),g(" "+i(r(Z)(e.createTime).format("YYYY-MM-DD HH:mm")),1)])])])]),value:c(()=>[s("div",Te,[s("div",Ue,[e.refundTx!=""||e.unlockTx!=""?(n(),_(A,{key:0},[r(m).language=="en"?(n(),a(d,{key:0,class:"type-icon",name:"endEn"})):(n(),a(d,{key:1,class:"type-icon",name:"endCn"}))],64)):(n(),_(A,{key:1},[r(m).language=="en"?(n(),a(d,{key:0,class:"type-icon",name:"goingEn"})):(n(),a(d,{key:1,class:"type-icon",name:"goingCn"}))],64))]),s("div",Re,[s("div",null,i(e.totalAmount+" "+e.symbol),1),s("div",Ve,[g(i(t.$t("received"))+" "+i(e.receivedCount),1),Fe,g(i(e.count),1)])])])]),_:2},1032,["onClick"]))),128))]),_:1},8,["loading","loading-text","finished","finished-text","error","error-text"]))]),_:1},8,["modelValue","pulling-text","loosing-text","loading-text"])]),_:1},8,["title"]),u(ae,{show:V.value,"onUpdate:show":o[6]||(o[6]=e=>V.value=e),actions:F.value,"cancel-text":t.$t("cancel"),description:y.creatorAddress,"close-on-click-action":"",onSelect:oe},null,8,["show","actions","cancel-text","description"])]),_:1},8,["active"])}}},Be=he(Ne,[["__scopeId","data-v-17bc3dff"]]);export{Be as default};
