import{_ as ue,r as h,o as r,c as _,w as m,a as o,t as l,b as w,d as j,F as O,e as g,u as d,f as ge,g as i,h as ye,i as _e,j as Ue,k as Ee,l as qe,m as Ge,n as v,p as ze,B as f,q as ae,s as He,v as x,x as ne,T as S,y as We,z as F,E as Re,A as xe,D as je,C as Me,G as pe,H as Qe,I as Je}from"./index.5cdcfecd.js";import{_ as P}from"./SvgIcon.adb8ff6f.js";const Ke={class:"title"},Oe={class:"body"},Xe={class:"status-text"},Ye={key:0},Ze={key:1},et={key:2},tt={key:3},at={class:"status-icon"},nt={class:"tx"},ot={key:1,class:"trade-hash"},lt={__name:"ChainTrade",props:{tradeVisable:{type:Boolean,default:!1},status:{type:Number,default:0},tradeHash:{type:String,default:""},message:{type:String,default:""}},emits:["update:tradeVisable"],setup(u,{emit:q}){return(n,c)=>{const k=h("van-loading"),N=h("van-icon"),D=h("van-popup");return r(),_(D,{class:"dialog",show:u.tradeVisable,"onUpdate:show":c[1]||(c[1]=$=>_e(tradeVisable)?tradeVisable.value=$:null),round:"","close-on-click-overlay":!1},{default:m(()=>[o("div",Ke,l(n.$t("transactionDetails")),1),o("div",Oe,[o("div",Xe,[u.status!=0?(r(),w(O,{key:0},[u.status==1?(r(),w("div",Ye,l(n.$t("sendingTransactionToBlockchain")),1)):u.status==2?(r(),w("div",Ze,l(n.$t("waitingForServiceSyncronizing")),1)):u.status==-1?(r(),w("div",et,l(u.message?u.message:n.$t("sendTransactionToBlockchainFailed")),1)):u.status==-2?(r(),w("div",tt,l(n.$t("servicesyncronizingTimeout")),1)):j("",!0)],64)):j("",!0)]),o("div",at,[u.status==1||u.status==2?(r(),_(k,{key:0,type:"spinner",size:"48px"})):u.status==0?(r(),_(N,{key:1,color:"#07c160",size:"40px",name:"checked"})):u.status==-1||u.status==-2?(r(),_(N,{key:2,color:"#FA5151",size:"40px",name:"clear"})):j("",!0)]),u.tradeHash?(r(),w("div",{key:0,class:"trade-hash",onClick:c[0]||(c[0]=$=>d(ye)(u.tradeHash))},[g(l(n.$t("txHash"))+": ",1),o("span",nt,l(d(ge)(u.tradeHash)),1),i(P,{name:"copy"})])):(r(),w("div",ot,l(n.$t("txHash"))+": N/A",1))])]),_:1},8,["show"])}}},st=ue(lt,[["__scopeId","data-v-043773a9"]]);const it={class:"confirm-main"},ct={class:"title"},ut={class:"content"},rt={class:"content-item"},dt={class:"item-title"},mt={class:"item-content"},vt={class:"content-item"},ft={class:"item-title"},ht={class:"item-content"},kt={class:"content-item"},pt={class:"item-title"},gt={class:"item-content"},yt={class:"content-item"},_t={class:"item-title"},wt={class:"item-content"},bt={class:"content-item"},$t={class:"item-title"},Ct={class:"item-content"},At={__name:"CreateConfirm",props:{close:{type:Function,default:()=>{}},visable:{type:Boolean,default:!1},kind:{type:Number,default:0},gas:{type:String,default:""},serviceFee:{type:String,default:""},quantity:{type:Number,default:0},totalAmount:{type:Number,default:0},symbol:{type:String,default:""},tokenIcon:{type:String,default:""}},emits:["update:visable","confirm"],setup(u,{emit:q}){function n(){q("confirm")}function c(){q("update:visable",!1)}return(k,N)=>{const D=h("van-icon"),$=h("van-button"),I=h("van-popup");return r(),_(I,{show:u.visable,round:"","close-on-click-overlay":!1,closeable:"",onClose:c},{default:m(()=>[o("div",it,[o("div",ct,l(k.$t("redPacketConfirm")),1),o("ul",ut,[o("li",rt,[o("div",dt,l(k.$t("redPacketKind")),1),o("div",mt,[u.kind==0?(r(),w(O,{key:0},[i(P,{name:"pin"}),g(" "+l(k.$t("randomAmount")),1)],64)):(r(),w(O,{key:1},[i(P,{name:"pu"}),g(" "+l(k.$t("identicalAmount")),1)],64))])]),o("li",vt,[o("div",ft,l(k.$t("redPacketQuantity")),1),o("div",ht,l(u.quantity),1)]),o("li",kt,[o("div",pt,l(k.$t("tokenQuantity")),1),o("div",gt,[u.tokenIcon?(r(),_(D,{key:0,class:"chain-icon",name:u.tokenIcon},null,8,["name"])):j("",!0),g(" "+l(u.totalAmount+" "+u.symbol),1)])]),o("li",yt,[o("div",_t,l(k.$t("estimateGas")),1),o("div",wt,l(u.gas)+" BNB",1)]),o("li",bt,[o("div",$t,l(k.$t("serviceFee")),1),o("div",Ct,l(u.serviceFee)+" BNB",1)])]),i($,{class:"confirm",onClick:n},{default:m(()=>[g(l(k.$t("confirmAndSubmit")),1)]),_:1})])]),_:1},8,["show"])}}},St=ue(At,[["__scopeId","data-v-04129138"]]);const Ft=u=>(Qe("data-v-f0bee6ff"),u=u(),Je(),u),Pt={class:"body"},It={class:"tools-bar"},Vt={class:"address-text"},Lt={style:{"margin-left":"4px"}},Bt={class:"tools"},Tt={class:"token-box"},Nt={key:2,class:"amount"},Dt={style:{"margin-left":"4px"}},Ut=Ft(()=>o("svg",{class:"icon","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-redPacket"})],-1)),Et={class:"form-item total-amount"},qt={class:"form-item create"},Gt={class:"content"},zt={class:"content"},Ht={class:"success-icon"},Wt={class:"title"},Rt={class:"text"},xt={class:"btn"},jt={class:"content"},Mt={__name:"Index",setup(u){const q=Ue(),n=Ee(),{t:c}=qe(),k=Ge("global"),N=v(!1),D=v(!1),$=v(!1),I=v(0),U=v(""),G=v(""),B=v(""),X=v(""),we=v(""),re=v(null),z=v(""),Y=v(600);v(0),v(0);const t=ze({kind:0,totalAmount:0,quantity:0,deadline:0,profilePicture:null,title:"",remark:"",tokenChain:"",tokenAddress:"",tokenSymbol:"",tokenIcon:"",amount:f(0),minFee:f(0),baseFee:f(0),gasPrice:f(0),serviceFee:f(0),lockGasLimit:f(0),showGas:"",lockGasAmount:f(0),showServiceFee:"",allFee:f(0),walletAddress:"",redPacketContractAddress:"",redPacketContract:null}),M=v(!1);console.log(n.chainId);function oe(){return I.value==0?U.value?f(Number(U.value)).toNumber():0:G.value&&B.value?f(Number(G.value)).multipliedBy(Number(B.value)).toNumber():0}const be=ae(()=>{let e=oe();return e||"0.00"}),C=v(!1),V=v(0),H=v(""),le=v(""),Q=v(!1),Z=v(!1),se=v(""),ie=v(!1),$e=ae(()=>[{name:c("languages.zh-cn"),value:"zh-cn",color:n.language==="zh-cn"?"#3F80F7":"#323233"},{name:c("languages.en"),value:"en",color:n.language==="en"?"#3F80F7":"#323233"}]);function Ce(e){n.setLanguage(e.value)}const J=v(!1),Ae=ae(()=>[{text:c("deadlineList.300"),value:300},{text:c("deadlineList.600"),value:600},{text:c("deadlineList.1800"),value:1800},{text:c("deadlineList.3600"),value:3600},{text:c("deadlineList.43200"),value:43200},{text:c("deadlineList.86400"),value:86400}]),ce=ae(()=>c("deadlineList."+Y.value));function Se(e){Y.value=e.value,J.value=!1}async function de(){await n.connectWallet()}function me(){return k.cfg.allowChainList.map(a=>a.chainId).includes(n.chainId)?!0:(ie.value=!0,!1)}async function Fe(){C.value=!1,H.value="",V.value=1,C.value=!0;try{let e=await x.wallet.approveMaxAmount(n.token.address,n.redPacketContractAddress);console.log(e),H.value=e.hash,await e.wait(),$.value=!1,V.value=0}catch(e){console.log(e),V.value=-1,await ne(2e3)}finally{C.value=!1}}async function ve(){await x.wallet.isAllowanceEnough(n.redPacketContractAddress,n.token.address,n.walletAddress)?$.value=!1:$.value=!0}async function Pe(){Q.value=!0,C.value=!1,H.value="",Z.value=!1,se.value="",M.value=!1;try{if(!n.token){S.fail(c("pleaseSelectToken"));return}if(I.value==0){if(!U.value){S.fail(c("pleaseEnterTotalAmount"));return}if(1e-6*Number(B.value)>Number(U.value)){S.fail(c("pleaseEnsure"));return}}else if(!G.value){S.fail(c("pleaseEnterSingleAmount"));return}if(!B.value){S.fail(c("pleaseEnterQuantity"));return}let e=oe();if(z.value||(z.value=c("bestWishes")),await n.connectWallet(),!me())return;let p=k.cfg.allowChainList.find(y=>y.chain==n.token.chain);if(!p){S.fail(c("tokenChainNotSupport"));return}if(n.chainId!=p.chainId){S.fail(c("switchTokenChain"));return}if(e>n.token.amount){S.fail(c("blanceSlow"));return}if(await ve(),$.value){S.fail(c("approveFirst"));return}await Ie()}catch(e){console.dir(e)}finally{Q.value=!1}}async function Ie(){console.log("createRedPacket"),t.kind=I.value,t.totalAmount=oe(),t.quantity=Number(B.value),t.deadline=Y.value,t.profilePicture=re.value,t.title=X.value,t.remark=z.value,t.tokenChain=n.token.chain,t.tokenAddress=n.token.address,t.tokenSymbol=n.token.symbol,t.tokenIcon=n.token.icon,t.amount=f(0),t.minFee=f(0),t.baseFee=f(0),t.gasPrice=f(0),t.serviceFee=f(0),t.showGas="",t.showServiceFee="",t.lockGasLimit=f(0),t.lockGasAmount=f(0),t.allFee=f(0),t.walletAddress=n.walletAddress,t.redPacketContractAddress=n.redPacketContractAddress,t.redPacketContract=null;const e=x.wallet.getEthersProvider(),a=x.wallet.contractByProvider(e,t.redPacketContractAddress,We);t.redPacketContract=a;const p=await a.minFee();console.log("minFee"),console.log(F(p)),t.minFee=p;const y=await a.baseFee();console.log("baseFee"),console.log(F(y)),t.baseFee=y;const A=await x.wallet.contractByProvider(e,t.tokenAddress,Re).decimals();console.log("decimals"),console.log(A),t.amount=xe(t.totalAmount.toString(),A),console.log(F(t.amount));let W=[],b=[],L=0;for(let s=0;s<t.quantity;s++)W.push("0x60f5D34F9D419fC274C84d477Ea2E6051bA7cd16"),t.kind==0&&b.push(t.amount.div(t.quantity).toString());t.kind==1&&(L=t.amount.div(t.quantity).toString());const te=await a.estimateGas.estimateUnlock(0,W,b,L,t.tokenAddress,t.amount.toString(),t.kind);console.log("estimateUnlockGas"),console.log(F(te));const K=await e.getGasPrice();console.log("gasPrice"),console.log(F(K));const E=te.mul(K),T=E.mul(2).add(y).gt(p)?E.mul(2).add(y):p;t.showServiceFee=F(T).toString(),console.log("serviceFee"),console.log(F(T)),t.serviceFee=T;let R;try{R=(await a.estimateGas.lock(t.walletAddress,t.tokenAddress,t.amount.toString(),t.deadline,t.quantity,t.kind,{value:T.toString()})).mul(2)}catch(s){if(s.data.code==-32e3){const De=s.data.message.match(/(\d+) want (\d+)/)[2];S.fail(c("balanceSlow",{chainMianCoin:"BNB",amount:F(De)}))}throw console.dir(s),s}console.log("gasLimit"),console.log(F(R)),t.gasLimit=R,t.showGas=F(R.mul(K)).toString(),M.value=!0}async function Ve(){M.value=!1,V.value=1,C.value=!0;let e;try{let a=await t.redPacketContract.lock(t.walletAddress,t.tokenAddress,t.amount.toString(),t.deadline,t.quantity,t.kind,{value:t.serviceFee.toString(),gasLimit:t.gasLimit.toString()});console.dir(a),H.value=a.hash,e=await a.wait(),console.dir(e),H.value=e.transactionHash}catch(a){console.dir(a),a.code=="ACTION_REJECTED"&&(le.value=c("actionRejected")),V.value=-1,await ne(1e3),C.value=!1,le.value="",Q.value=!1;return}V.value=2;try{let a=e==null?void 0:e.events,p={};for(let A=a.length-1;A>=0;A--){let W=a[A].topics.some(b=>b==="0x694af1cc8727cdd0afbdd53d9b87b69248bd490224e9dd090e788546506e076f");if(a[A].address==n.redPacketContractAddress&&W){p=a[A];break}}let y=await x.redPacket.send(t.tokenAddress,t.tokenChain,p.topics[1],e.transactionHash,t.deadline,t.profilePicture,t.remark,t.tokenSymbol,t.title);console.dir(y),V.value=0,await ne(500),C.value=!1;const ee=y.data.uuid;Z.value=!0,se.value=window.location.origin+"/#/redpacket/"+ee}catch(a){console.dir(a),V.value=-1,await ne(1e3),C.value=!1,Q.value=!1}}function Le(){I.value=0,U.value="",G.value="",B.value="",X.value="",we.value="",re.value=null,z.value="",Y.value=600,n.token=null}const fe=k.cfg.allowChainList.map(e=>e.chainShow);function he(e){const a=k.cfg.allowChainList.find(y=>y.chainId==e);let p;return a?p=a.chain:p=null,p}function Be(){q.push("/selectToken")}function ke(e){return console.log(e),e&&e.replace("-","").replace(/^(.*\..{6}).*$/,"$1")}function Te(){je.confirm({title:c("tips"),message:c("disonnectWallet"),confirmButtonText:c("confirm"),cancelButtonText:c("cancel")}).then(()=>{n.disconnectWallet()}).catch(()=>{})}function Ne(e){return e&&(Number(e)>=1e3?"1000":e)}return He(()=>{console.log("onMounted"),n.chainId>0&&(me(),n.isConnectWallet&&n.token&&ve())}),(e,a)=>{const p=h("van-icon"),y=h("van-radio"),ee=h("van-radio-group"),A=h("van-image"),W=h("van-cell"),b=h("van-cell-group"),L=h("van-field"),te=h("van-picker"),K=h("van-popup"),E=h("van-button"),T=h("van-dialog"),R=h("van-action-sheet");return r(),w(O,null,[o("div",Pt,[o("div",It,[d(n).isConnectWallet?(r(),w("div",{key:0,class:"address",onClick:Te},[he(d(n).chainId)?(r(),_(p,{key:0,class:"chain-icon",name:d(Me)(he(d(n).chainId))},null,8,["name"])):(r(),_(P,{key:1,class:"chain-icon",name:"wallet"})),o("div",Vt,l(d(ge)(d(n).walletAddress)),1)])):(r(),w("div",{key:1,class:"address",onClick:de},[i(P,{name:"wallet"}),o("div",Lt,l(e.$t("pleaseConnectWallet")),1)])),o("div",Bt,[i(P,{name:"language",onClick:a[0]||(a[0]=s=>D.value=!0)}),i(P,{name:"help",onClick:a[1]||(a[1]=s=>N.value=!0)})])]),i(ee,{modelValue:I.value,"onUpdate:modelValue":a[2]||(a[2]=s=>I.value=s),direction:"horizontal",class:"type form-item"},{default:m(()=>[i(y,{name:0,"checked-color":"#ED4A4A","icon-size":"16px"},{default:m(()=>[g(l(e.$t("randomAmount")),1)]),_:1}),i(y,{name:1,"checked-color":"#ED4A4A","icon-size":"16px"},{default:m(()=>[g(l(e.$t("identicalAmount")),1)]),_:1})]),_:1},8,["modelValue"]),i(b,{inset:"",class:"form-item form-normal"},{default:m(()=>[i(W,{title:e.$t("token"),"is-link":"",onClick:Be},pe({_:2},[d(n).token?{name:"value",fn:m(()=>[o("div",Tt,[d(n).token.icon?(r(),_(A,{key:0,class:"token-icon",round:"",src:d(n).token.icon,"error-icon":"/assets/images/default.png"},null,8,["src"])):j("",!0),g(" "+l(d(n).token.symbol),1)])]),key:"0"}:void 0]),1032,["title"])]),_:1}),I.value==0?(r(),_(b,{key:0,inset:"",class:"form-item form-normal"},{default:m(()=>[i(L,{label:e.$t("totalAmount"),"input-align":"right",formatter:ke,maxlength:"10",placeholder:e.$t("enterAmount"),type:"number",modelValue:U.value,"onUpdate:modelValue":a[3]||(a[3]=s=>U.value=s)},{"left-icon":m(()=>[i(P,{name:"pin"})]),_:1},8,["label","placeholder","modelValue"])]),_:1})):(r(),_(b,{key:1,inset:"",class:"form-item form-normal"},{default:m(()=>[i(L,{label:e.$t("singleAmount"),"label-width":"7em","input-align":"right",formatter:ke,maxlength:"10",placeholder:e.$t("enterAmount"),type:"number",modelValue:G.value,"onUpdate:modelValue":a[4]||(a[4]=s=>G.value=s)},{"left-icon":m(()=>[i(P,{name:"pu"})]),_:1},8,["label","placeholder","modelValue"])]),_:1})),d(n).token?(r(),w("div",Nt,[g(l(e.$t("availableBalance")),1),o("span",Dt,l(d(n).token.amount+" "+d(n).token.symbol),1)])):j("",!0),i(b,{inset:"",class:"form-item form-normal"},{default:m(()=>[i(L,{label:e.$t("quantity"),"input-align":"right",placeholder:e.$t("enterNumber"),type:"digit",maxlength:"4",formatter:Ne,modelValue:B.value,"onUpdate:modelValue":a[5]||(a[5]=s=>B.value=s)},pe({"left-icon":m(()=>[Ut]),_:2},[d(n).language=="zh-cn"?{name:"right-icon",fn:m(()=>[g("\u4E2A")]),key:"0"}:void 0]),1032,["label","placeholder","modelValue"])]),_:1}),i(b,{inset:"",class:"form-item form-normal"},{default:m(()=>[i(L,{modelValue:d(ce),"onUpdate:modelValue":a[6]||(a[6]=s=>_e(ce)?ce.value=s:null),"is-link":"",readonly:"",name:"picker",label:e.$t("deadline"),onClick:a[7]||(a[7]=s=>J.value=!0),"input-align":"right"},null,8,["modelValue","label"]),i(K,{show:J.value,"onUpdate:show":a[9]||(a[9]=s=>J.value=s),position:"bottom"},{default:m(()=>[i(te,{columns:d(Ae),onCancel:a[8]||(a[8]=s=>J.value=!1),onConfirm:Se,title:e.$t("settingDeadline"),"confirm-button-text":e.$t("confirm"),"cancel-button-text":e.$t("cancel")},null,8,["columns","title","confirm-button-text","cancel-button-text"])]),_:1},8,["show"])]),_:1}),i(b,{inset:"",class:"form-item"},{default:m(()=>[i(L,{modelValue:z.value,"onUpdate:modelValue":a[10]||(a[10]=s=>z.value=s),rows:"1",autosize:"",type:"textarea",maxlength:"20",placeholder:e.$t("bestWishes"),"show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1}),i(b,{inset:"",class:"form-item"},{default:m(()=>[i(L,{modelValue:X.value,"onUpdate:modelValue":a[11]||(a[11]=s=>X.value=s),rows:"2",autosize:"",type:"textarea",maxlength:"500",placeholder:e.$t("ActivityDescription")},null,8,["modelValue","placeholder"])]),_:1}),o("div",Et,[g(l(e.$t("redPacketTotalAmount")),1),o("span",null,l(d(be)),1),g(l(d(n).token?d(n).token.symbol:""),1)]),o("div",qt,[d(n).isConnectWallet?(r(),w(O,{key:0},[$.value?(r(),_(E,{key:0,class:"create-btn",type:"danger",onClick:Fe},{default:m(()=>[g(l(e.$t("approve")),1)]),_:1})):(r(),_(E,{key:1,class:"create-btn",type:"danger",onClick:Pe,loading:Q.value},{default:m(()=>[g(l(e.$t("createRedPacketBtn")),1)]),_:1},8,["loading"]))],64)):(r(),_(E,{key:1,class:"create-btn",type:"primary",onClick:de},{default:m(()=>[g(l(e.$t("connectWallet")),1)]),_:1}))]),o("div",{class:"form-item history",onClick:a[12]||(a[12]=s=>d(q).push("/history"))},l(e.$t("redPacketHistory")),1)]),i(T,{class:"help-dialog",show:N.value,"onUpdate:show":a[13]||(a[13]=s=>N.value=s),title:e.$t("rulesDescription"),"confirm-button-text":e.$t("understand"),"close-on-click-overlay":""},{default:m(()=>[o("div",Gt,[o("div",null,l(e.$t("rulesDescription1")),1),o("div",null,l(e.$t("rulesDescription2")),1),o("div",null,l(e.$t("rulesDescription3")),1),o("div",null,l(e.$t("rulesDescription4")),1),o("div",null,l(e.$t("rulesDescription5",{chains:d(fe).join("/")})),1),o("div",null,l(e.$t("rulesDescription6")),1)])]),_:1},8,["show","title","confirm-button-text"]),i(T,{class:"create-success-dialog",show:Z.value,"onUpdate:show":a[15]||(a[15]=s=>Z.value=s),onClose:Le,"close-on-click-overlay":""},{footer:m(()=>[o("div",xt,[i(E,{class:"copy-btn",type:"primary",onClick:a[14]||(a[14]=s=>d(ye)(se.value))},{default:m(()=>[g(l(e.$t("copyLink")),1)]),_:1})])]),default:m(()=>[o("div",zt,[o("div",Ht,[i(P,{name:"createSuccess"})]),o("div",Wt,l(e.$t("createRedPacketSuccess")),1),o("div",Rt,l(e.$t("shareLink")),1)])]),_:1},8,["show"]),i(R,{show:D.value,"onUpdate:show":a[16]||(a[16]=s=>D.value=s),title:e.$t("switchLang"),actions:d($e),closeable:!1,"cancel-text":e.$t("cancel"),"close-on-click-action":"",onSelect:Ce},null,8,["show","title","actions","cancel-text"]),i(st,{tradeVisable:C.value,"onUpdate:tradeVisable":a[17]||(a[17]=s=>C.value=s),status:V.value,tradeHash:H.value,message:le.value},null,8,["tradeVisable","status","tradeHash","message"]),i(T,{class:"chain-err-dialog",confirmButtonText:e.$t("understand"),confirmButtonColor:"#3F80F7",show:ie.value,"onUpdate:show":a[18]||(a[18]=s=>ie.value=s)},{default:m(()=>[o("div",jt,[o("div",null,l(e.$t("notSupportedChain")),1),o("div",null,l(e.$t("pleaseSwitchTo",{chains:d(fe).join("\u3001")})),1)])]),_:1},8,["confirmButtonText","show"]),i(St,{visable:M.value,"onUpdate:visable":a[19]||(a[19]=s=>M.value=s),kind:t.kind,quantity:t.quantity,totalAmount:t.totalAmount,symbol:t.tokenSymbol,tokenIcon:t.tokenIcon,gas:t.showGas,serviceFee:t.showServiceFee,onConfirm:Ve},null,8,["visable","kind","quantity","totalAmount","symbol","tokenIcon","gas","serviceFee"])],64)}}},Kt=ue(Mt,[["__scopeId","data-v-f0bee6ff"]]);export{Kt as default};
